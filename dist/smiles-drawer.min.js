(()=>{var Zl=Object.create;var Yn=Object.defineProperty;var Kl=Object.getOwnPropertyDescriptor;var Jl=Object.getOwnPropertyNames;var Ql=Object.getPrototypeOf,eo=Object.prototype.hasOwnProperty;var to=(k,e)=>()=>(e||k((e={exports:{}}).exports,e),e.exports);var ro=(k,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Jl(e))!eo.call(k,i)&&i!==r&&Yn(k,i,{get:()=>e[i],enumerable:!(t=Kl(e,i))||t.enumerable});return k};var io=(k,e,r)=>(r=k!=null?Zl(Ql(k)):{},ro(e||!k||!k.__esModule?Yn(r,"default",{value:k,enumerable:!0}):r,k));var qn=to((Oi,Fi)=>{(function(k,e){typeof Oi=="object"&&typeof Fi<"u"?Fi.exports=e():typeof define=="function"&&define.amd?define(e):(k=typeof globalThis<"u"?globalThis:k||self,k.chroma=e())})(Oi,function(){"use strict";for(var k=function(a,o,u){return o===void 0&&(o=0),u===void 0&&(u=1),a<o?o:a>u?u:a},e=k,r=function(a){a._clipped=!1,a._unclipped=a.slice(0);for(var o=0;o<=3;o++)o<3?((a[o]<0||a[o]>255)&&(a._clipped=!0),a[o]=e(a[o],0,255)):o===3&&(a[o]=e(a[o],0,1));return a},t={},i=0,s=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];i<s.length;i+=1){var l=s[i];t["[object "+l+"]"]=l.toLowerCase()}var n=function(a){return t[Object.prototype.toString.call(a)]||"object"},h=n,f=function(a,o){return o===void 0&&(o=null),a.length>=3?Array.prototype.slice.call(a):h(a[0])=="object"&&o?o.split("").filter(function(u){return a[0][u]!==void 0}).map(function(u){return a[0][u]}):a[0]},c=n,d=function(a){if(a.length<2)return null;var o=a.length-1;return c(a[o])=="string"?a[o].toLowerCase():null},b=Math.PI,g={clip_rgb:r,limit:k,type:n,unpack:f,last:d,PI:b,TWOPI:b*2,PITHIRD:b/3,DEG2RAD:b/180,RAD2DEG:180/b},S={format:{},autodetect:[]},L=g.last,E=g.clip_rgb,I=g.type,F=S,B=function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];var p=this;if(I(o[0])==="object"&&o[0].constructor&&o[0].constructor===this.constructor)return o[0];var y=L(o),C=!1;if(!y){C=!0,F.sorted||(F.autodetect=F.autodetect.sort(function(D,X){return X.p-D.p}),F.sorted=!0);for(var w=0,N=F.autodetect;w<N.length;w+=1){var $=N[w];if(y=$.test.apply($,o),y)break}}if(F.format[y]){var M=F.format[y].apply(null,C?o:o.slice(0,-1));p._rgb=E(M)}else throw new Error("unknown format: "+o);p._rgb.length===3&&p._rgb.push(1)};B.prototype.toString=function(){return I(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var A=B,O=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(O.Color,[null].concat(a)))};O.Color=A,O.version="2.4.2";var W=O,J=g.unpack,le=Math.max,ne=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=J(a,"rgb"),p=u[0],y=u[1],C=u[2];p=p/255,y=y/255,C=C/255;var w=1-le(p,le(y,C)),N=w<1?1/(1-w):0,$=(1-p-w)*N,M=(1-y-w)*N,D=(1-C-w)*N;return[$,M,D,w]},Se=ne,Ke=g.unpack,st=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=Ke(a,"cmyk");var u=a[0],p=a[1],y=a[2],C=a[3],w=a.length>4?a[4]:1;return C===1?[0,0,0,w]:[u>=1?0:255*(1-u)*(1-C),p>=1?0:255*(1-p)*(1-C),y>=1?0:255*(1-y)*(1-C),w]},Te=st,Ae=W,Ye=A,He=S,at=g.unpack,je=g.type,U=Se;Ye.prototype.cmyk=function(){return U(this._rgb)},Ae.cmyk=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Ye,[null].concat(a,["cmyk"])))},He.format.cmyk=Te,He.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=at(a,"cmyk"),je(a)==="array"&&a.length===4)return"cmyk"}});var se=g.unpack,ve=g.last,Re=function(a){return Math.round(a*100)/100},we=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=se(a,"hsla"),p=ve(a)||"lsa";return u[0]=Re(u[0]||0),u[1]=Re(u[1]*100)+"%",u[2]=Re(u[2]*100)+"%",p==="hsla"||u.length>3&&u[3]<1?(u[3]=u.length>3?u[3]:1,p="hsla"):u.length=3,p+"("+u.join(",")+")"},$e=we,xe=g.unpack,Le=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=xe(a,"rgba");var u=a[0],p=a[1],y=a[2];u/=255,p/=255,y/=255;var C=Math.min(u,p,y),w=Math.max(u,p,y),N=(w+C)/2,$,M;return w===C?($=0,M=Number.NaN):$=N<.5?(w-C)/(w+C):(w-C)/(2-w-C),u==w?M=(p-y)/(w-C):p==w?M=2+(y-u)/(w-C):y==w&&(M=4+(u-p)/(w-C)),M*=60,M<0&&(M+=360),a.length>3&&a[3]!==void 0?[M,$,N,a[3]]:[M,$,N]},vt=Le,xt=g.unpack,Je=g.last,ot=$e,Nt=vt,Pe=Math.round,De=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=xt(a,"rgba"),p=Je(a)||"rgb";return p.substr(0,3)=="hsl"?ot(Nt(u),p):(u[0]=Pe(u[0]),u[1]=Pe(u[1]),u[2]=Pe(u[2]),(p==="rgba"||u.length>3&&u[3]<1)&&(u[3]=u.length>3?u[3]:1,p="rgba"),p+"("+u.slice(0,p==="rgb"?3:4).join(",")+")")},ht=De,ft=g.unpack,Me=Math.round,_e=function(){for(var a,o=[],u=arguments.length;u--;)o[u]=arguments[u];o=ft(o,"hsl");var p=o[0],y=o[1],C=o[2],w,N,$;if(y===0)w=N=$=C*255;else{var M=[0,0,0],D=[0,0,0],X=C<.5?C*(1+y):C+y-C*y,z=2*C-X,j=p/360;M[0]=j+1/3,M[1]=j,M[2]=j-1/3;for(var Y=0;Y<3;Y++)M[Y]<0&&(M[Y]+=1),M[Y]>1&&(M[Y]-=1),6*M[Y]<1?D[Y]=z+(X-z)*6*M[Y]:2*M[Y]<1?D[Y]=X:3*M[Y]<2?D[Y]=z+(X-z)*(2/3-M[Y])*6:D[Y]=z;a=[Me(D[0]*255),Me(D[1]*255),Me(D[2]*255)],w=a[0],N=a[1],$=a[2]}return o.length>3?[w,N,$,o[3]]:[w,N,$,1]},Oe=_e,Fe=Oe,gr=S,qt=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,Gt=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,Ut=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,cr=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Zt=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Kt=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Jt=Math.round,dr=function(a){a=a.toLowerCase().trim();var o;if(gr.format.named)try{return gr.format.named(a)}catch(Y){}if(o=a.match(qt)){for(var u=o.slice(1,4),p=0;p<3;p++)u[p]=+u[p];return u[3]=1,u}if(o=a.match(Gt)){for(var y=o.slice(1,5),C=0;C<4;C++)y[C]=+y[C];return y}if(o=a.match(Ut)){for(var w=o.slice(1,4),N=0;N<3;N++)w[N]=Jt(w[N]*2.55);return w[3]=1,w}if(o=a.match(cr)){for(var $=o.slice(1,5),M=0;M<3;M++)$[M]=Jt($[M]*2.55);return $[3]=+$[3],$}if(o=a.match(Zt)){var D=o.slice(1,4);D[1]*=.01,D[2]*=.01;var X=Fe(D);return X[3]=1,X}if(o=a.match(Kt)){var z=o.slice(1,4);z[1]*=.01,z[2]*=.01;var j=Fe(z);return j[3]=+o[4],j}};dr.test=function(a){return qt.test(a)||Gt.test(a)||Ut.test(a)||cr.test(a)||Zt.test(a)||Kt.test(a)};var pr=dr,Wr=W,vr=A,mr=S,br=g.type,Xr=ht,Qt=pr;vr.prototype.css=function(a){return Xr(this._rgb,a)},Wr.css=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(vr,[null].concat(a,["css"])))},mr.format.css=Qt,mr.autodetect.push({p:5,test:function(a){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];if(!o.length&&br(a)==="string"&&Qt.test(a))return"css"}});var wr=A,Vr=W,Yr=S,yr=g.unpack;Yr.format.gl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=yr(a,"rgba");return u[0]*=255,u[1]*=255,u[2]*=255,u},Vr.gl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(wr,[null].concat(a,["gl"])))},wr.prototype.gl=function(){var a=this._rgb;return[a[0]/255,a[1]/255,a[2]/255,a[3]]};var Sr=g.unpack,jr=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=Sr(a,"rgb"),p=u[0],y=u[1],C=u[2],w=Math.min(p,y,C),N=Math.max(p,y,C),$=N-w,M=$*100/255,D=w/(255-$)*100,X;return $===0?X=Number.NaN:(p===N&&(X=(y-C)/$),y===N&&(X=2+(C-p)/$),C===N&&(X=4+(p-y)/$),X*=60,X<0&&(X+=360)),[X,M,D]},Cr=jr,Ar=g.unpack,qr=Math.floor,Gr=function(){for(var a,o,u,p,y,C,w=[],N=arguments.length;N--;)w[N]=arguments[N];w=Ar(w,"hcg");var $=w[0],M=w[1],D=w[2],X,z,j;D=D*255;var Y=M*255;if(M===0)X=z=j=D;else{$===360&&($=0),$>360&&($-=360),$<0&&($+=360),$/=60;var ee=qr($),ae=$-ee,he=D*(1-M),ue=he+Y*(1-ae),Be=he+Y*ae,Ee=he+Y;switch(ee){case 0:a=[Ee,Be,he],X=a[0],z=a[1],j=a[2];break;case 1:o=[ue,Ee,he],X=o[0],z=o[1],j=o[2];break;case 2:u=[he,Ee,Be],X=u[0],z=u[1],j=u[2];break;case 3:p=[he,ue,Ee],X=p[0],z=p[1],j=p[2];break;case 4:y=[Be,he,Ee],X=y[0],z=y[1],j=y[2];break;case 5:C=[Ee,he,ue],X=C[0],z=C[1],j=C[2];break}}return[X,z,j,w.length>3?w[3]:1]},Ur=Gr,Zr=g.unpack,Kr=g.type,Jr=W,xr=A,Nr=S,Qr=Cr;xr.prototype.hcg=function(){return Qr(this._rgb)},Jr.hcg=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(xr,[null].concat(a,["hcg"])))},Nr.format.hcg=Ur,Nr.autodetect.push({p:1,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=Zr(a,"hcg"),Kr(a)==="array"&&a.length===3)return"hcg"}});var ei=g.unpack,m=g.last,me=Math.round,It=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=ei(a,"rgba"),p=u[0],y=u[1],C=u[2],w=u[3],N=m(a)||"auto";w===void 0&&(w=1),N==="auto"&&(N=w<1?"rgba":"rgb"),p=me(p),y=me(y),C=me(C);var $=p<<16|y<<8|C,M="000000"+$.toString(16);M=M.substr(M.length-6);var D="0"+me(w*255).toString(16);switch(D=D.substr(D.length-2),N.toLowerCase()){case"rgba":return"#"+M+D;case"argb":return"#"+D+M;default:return"#"+M}},We=It,er=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,q=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,Pt=function(a){if(a.match(er)){(a.length===4||a.length===7)&&(a=a.substr(1)),a.length===3&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var o=parseInt(a,16),u=o>>16,p=o>>8&255,y=o&255;return[u,p,y,1]}if(a.match(q)){(a.length===5||a.length===9)&&(a=a.substr(1)),a.length===4&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]);var C=parseInt(a,16),w=C>>24&255,N=C>>16&255,$=C>>8&255,M=Math.round((C&255)/255*100)/100;return[w,N,$,M]}throw new Error("unknown hex color: "+a)},ti=Pt,Hi=W,ri=A,_i=g.type,ye=S,qe=We;ri.prototype.hex=function(a){return qe(this._rgb,a)},Hi.hex=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(ri,[null].concat(a,["hex"])))},ye.format.hex=ti,ye.autodetect.push({p:4,test:function(a){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];if(!o.length&&_i(a)==="string"&&[3,4,5,6,7,8,9].indexOf(a.length)>=0)return"hex"}});var Wi=g.unpack,Rr=g.TWOPI,ii=Math.min,$r=Math.sqrt,Rt=Math.acos,G=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=Wi(a,"rgb"),p=u[0],y=u[1],C=u[2];p/=255,y/=255,C/=255;var w,N=ii(p,y,C),$=(p+y+C)/3,M=$>0?1-N/$:0;return M===0?w=NaN:(w=(p-y+(p-C))/2,w/=$r((p-y)*(p-y)+(p-C)*(y-C)),w=Rt(w),C>y&&(w=Rr-w),w/=Rr),[w*360,M,$]},tr=G,kr=g.unpack,mt=g.limit,Xe=g.TWOPI,rr=g.PITHIRD,Qe=Math.cos,ni=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=kr(a,"hsi");var u=a[0],p=a[1],y=a[2],C,w,N;return isNaN(u)&&(u=0),isNaN(p)&&(p=0),u>360&&(u-=360),u<0&&(u+=360),u/=360,u<1/3?(N=(1-p)/3,C=(1+p*Qe(Xe*u)/Qe(rr-Xe*u))/3,w=1-(N+C)):u<2/3?(u-=1/3,C=(1-p)/3,w=(1+p*Qe(Xe*u)/Qe(rr-Xe*u))/3,N=1-(C+w)):(u-=2/3,w=(1-p)/3,N=(1+p*Qe(Xe*u)/Qe(rr-Xe*u))/3,C=1-(w+N)),C=mt(y*C*3),w=mt(y*w*3),N=mt(y*N*3),[C*255,w*255,N*255,a.length>3?a[3]:1]},si=ni,Er=g.unpack,Tr=g.type,ai=W,ir=A,Lr=S,li=tr;ir.prototype.hsi=function(){return li(this._rgb)},ai.hsi=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(ir,[null].concat(a,["hsi"])))},Lr.format.hsi=si,Lr.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=Er(a,"hsi"),Tr(a)==="array"&&a.length===3)return"hsi"}});var oi=g.unpack,hi=g.type,fi=W,Mr=A,Br=S,x=vt;Mr.prototype.hsl=function(){return x(this._rgb)},fi.hsl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Mr,[null].concat(a,["hsl"])))},Br.format.hsl=Oe,Br.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=oi(a,"hsl"),hi(a)==="array"&&a.length===3)return"hsl"}});var v=g.unpack,P=Math.min,R=Math.max,H=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=v(a,"rgb");var u=a[0],p=a[1],y=a[2],C=P(u,p,y),w=R(u,p,y),N=w-C,$,M,D;return D=w/255,w===0?($=Number.NaN,M=0):(M=N/w,u===w&&($=(p-y)/N),p===w&&($=2+(y-u)/N),y===w&&($=4+(u-p)/N),$*=60,$<0&&($+=360)),[$,M,D]},V=H,Z=g.unpack,Ne=Math.floor,Ge=function(){for(var a,o,u,p,y,C,w=[],N=arguments.length;N--;)w[N]=arguments[N];w=Z(w,"hsv");var $=w[0],M=w[1],D=w[2],X,z,j;if(D*=255,M===0)X=z=j=D;else{$===360&&($=0),$>360&&($-=360),$<0&&($+=360),$/=60;var Y=Ne($),ee=$-Y,ae=D*(1-M),he=D*(1-M*ee),ue=D*(1-M*(1-ee));switch(Y){case 0:a=[D,ue,ae],X=a[0],z=a[1],j=a[2];break;case 1:o=[he,D,ae],X=o[0],z=o[1],j=o[2];break;case 2:u=[ae,D,ue],X=u[0],z=u[1],j=u[2];break;case 3:p=[ae,he,D],X=p[0],z=p[1],j=p[2];break;case 4:y=[ue,ae,D],X=y[0],z=y[1],j=y[2];break;case 5:C=[D,ae,he],X=C[0],z=C[1],j=C[2];break}}return[X,z,j,w.length>3?w[3]:1]},et=Ge,Un=g.unpack,Zn=g.type,Kn=W,Xi=A,Vi=S,Jn=V;Xi.prototype.hsv=function(){return Jn(this._rgb)},Kn.hsv=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Xi,[null].concat(a,["hsv"])))},Vi.format.hsv=et,Vi.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=Un(a,"hsv"),Zn(a)==="array"&&a.length===3)return"hsv"}});var Ir={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Dt=Ir,Qn=g.unpack,Yi=Math.pow,es=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=Qn(a,"rgb"),p=u[0],y=u[1],C=u[2],w=ts(p,y,C),N=w[0],$=w[1],M=w[2],D=116*$-16;return[D<0?0:D,500*(N-$),200*($-M)]},ui=function(a){return(a/=255)<=.04045?a/12.92:Yi((a+.055)/1.055,2.4)},gi=function(a){return a>Dt.t3?Yi(a,1/3):a/Dt.t2+Dt.t0},ts=function(a,o,u){a=ui(a),o=ui(o),u=ui(u);var p=gi((.4124564*a+.3575761*o+.1804375*u)/Dt.Xn),y=gi((.2126729*a+.7151522*o+.072175*u)/Dt.Yn),C=gi((.0193339*a+.119192*o+.9503041*u)/Dt.Zn);return[p,y,C]},ji=es,Ot=Ir,rs=g.unpack,is=Math.pow,ns=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=rs(a,"lab");var u=a[0],p=a[1],y=a[2],C,w,N,$,M,D;return w=(u+16)/116,C=isNaN(p)?w:w+p/500,N=isNaN(y)?w:w-y/200,w=Ot.Yn*di(w),C=Ot.Xn*di(C),N=Ot.Zn*di(N),$=ci(3.2404542*C-1.5371385*w-.4985314*N),M=ci(-.969266*C+1.8760108*w+.041556*N),D=ci(.0556434*C-.2040259*w+1.0572252*N),[$,M,D,a.length>3?a[3]:1]},ci=function(a){return 255*(a<=.00304?12.92*a:1.055*is(a,1/2.4)-.055)},di=function(a){return a>Ot.t1?a*a*a:Ot.t2*(a-Ot.t0)},qi=ns,ss=g.unpack,as=g.type,ls=W,Gi=A,Ui=S,os=ji;Gi.prototype.lab=function(){return os(this._rgb)},ls.lab=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Gi,[null].concat(a,["lab"])))},Ui.format.lab=qi,Ui.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=ss(a,"lab"),as(a)==="array"&&a.length===3)return"lab"}});var hs=g.unpack,fs=g.RAD2DEG,us=Math.sqrt,gs=Math.atan2,cs=Math.round,ds=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=hs(a,"lab"),p=u[0],y=u[1],C=u[2],w=us(y*y+C*C),N=(gs(C,y)*fs+360)%360;return cs(w*1e4)===0&&(N=Number.NaN),[p,w,N]},Zi=ds,ps=g.unpack,vs=ji,ms=Zi,bs=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=ps(a,"rgb"),p=u[0],y=u[1],C=u[2],w=vs(p,y,C),N=w[0],$=w[1],M=w[2];return ms(N,$,M)},ws=bs,ys=g.unpack,Ss=g.DEG2RAD,Cs=Math.sin,As=Math.cos,xs=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=ys(a,"lch"),p=u[0],y=u[1],C=u[2];return isNaN(C)&&(C=0),C=C*Ss,[p,As(C)*y,Cs(C)*y]},Ki=xs,Ns=g.unpack,Rs=Ki,$s=qi,ks=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=Ns(a,"lch");var u=a[0],p=a[1],y=a[2],C=Rs(u,p,y),w=C[0],N=C[1],$=C[2],M=$s(w,N,$),D=M[0],X=M[1],z=M[2];return[D,X,z,a.length>3?a[3]:1]},Ji=ks,Es=g.unpack,Ts=Ji,Ls=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=Es(a,"hcl").reverse();return Ts.apply(void 0,u)},Ms=Ls,Bs=g.unpack,Is=g.type,Qi=W,Pr=A,pi=S,en=ws;Pr.prototype.lch=function(){return en(this._rgb)},Pr.prototype.hcl=function(){return en(this._rgb).reverse()},Qi.lch=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Pr,[null].concat(a,["lch"])))},Qi.hcl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Pr,[null].concat(a,["hcl"])))},pi.format.lch=Ji,pi.format.hcl=Ms,["lch","hcl"].forEach(function(a){return pi.autodetect.push({p:2,test:function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(o=Bs(o,a),Is(o)==="array"&&o.length===3)return a}})});var Ps={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},tn=Ps,Ds=A,rn=S,Os=g.type,nr=tn,Fs=ti,zs=We;Ds.prototype.name=function(){for(var a=zs(this._rgb,"rgb"),o=0,u=Object.keys(nr);o<u.length;o+=1){var p=u[o];if(nr[p]===a)return p.toLowerCase()}return a},rn.format.named=function(a){if(a=a.toLowerCase(),nr[a])return Fs(nr[a]);throw new Error("unknown color name: "+a)},rn.autodetect.push({p:5,test:function(a){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];if(!o.length&&Os(a)==="string"&&nr[a.toLowerCase()])return"named"}});var Hs=g.unpack,_s=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=Hs(a,"rgb"),p=u[0],y=u[1],C=u[2];return(p<<16)+(y<<8)+C},Ws=_s,Xs=g.type,Vs=function(a){if(Xs(a)=="number"&&a>=0&&a<=16777215){var o=a>>16,u=a>>8&255,p=a&255;return[o,u,p,1]}throw new Error("unknown num color: "+a)},Ys=Vs,js=W,nn=A,sn=S,qs=g.type,Gs=Ws;nn.prototype.num=function(){return Gs(this._rgb)},js.num=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(nn,[null].concat(a,["num"])))},sn.format.num=Ys,sn.autodetect.push({p:5,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a.length===1&&qs(a[0])==="number"&&a[0]>=0&&a[0]<=16777215)return"num"}});var Us=W,vi=A,an=S,ln=g.unpack,on=g.type,hn=Math.round;vi.prototype.rgb=function(a){return a===void 0&&(a=!0),a===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(hn)},vi.prototype.rgba=function(a){return a===void 0&&(a=!0),this._rgb.slice(0,4).map(function(o,u){return u<3?a===!1?o:hn(o):o})},Us.rgb=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(vi,[null].concat(a,["rgb"])))},an.format.rgb=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=ln(a,"rgba");return u[3]===void 0&&(u[3]=1),u},an.autodetect.push({p:3,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=ln(a,"rgba"),on(a)==="array"&&(a.length===3||a.length===4&&on(a[3])=="number"&&a[3]>=0&&a[3]<=1))return"rgb"}});var Dr=Math.log,Zs=function(a){var o=a/100,u,p,y;return o<66?(u=255,p=o<6?0:-155.25485562709179-.44596950469579133*(p=o-2)+104.49216199393888*Dr(p),y=o<20?0:-254.76935184120902+.8274096064007395*(y=o-10)+115.67994401066147*Dr(y)):(u=351.97690566805693+.114206453784165*(u=o-55)-40.25366309332127*Dr(u),p=325.4494125711974+.07943456536662342*(p=o-50)-28.0852963507957*Dr(p),y=255),[u,p,y,1]},fn=Zs,Ks=fn,Js=g.unpack,Qs=Math.round,ea=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];for(var u=Js(a,"rgb"),p=u[0],y=u[2],C=1e3,w=4e4,N=.4,$;w-C>N;){$=(w+C)*.5;var M=Ks($);M[2]/M[0]>=y/p?w=$:C=$}return Qs($)},ta=ea,mi=W,Or=A,bi=S,ra=ta;Or.prototype.temp=Or.prototype.kelvin=Or.prototype.temperature=function(){return ra(this._rgb)},mi.temp=mi.kelvin=mi.temperature=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Or,[null].concat(a,["temp"])))},bi.format.temp=bi.format.kelvin=bi.format.temperature=fn;var ia=g.unpack,wi=Math.cbrt,na=Math.pow,sa=Math.sign,aa=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=ia(a,"rgb"),p=u[0],y=u[1],C=u[2],w=[yi(p/255),yi(y/255),yi(C/255)],N=w[0],$=w[1],M=w[2],D=wi(.4122214708*N+.5363325363*$+.0514459929*M),X=wi(.2119034982*N+.6806995451*$+.1073969566*M),z=wi(.0883024619*N+.2817188376*$+.6299787005*M);return[.2104542553*D+.793617785*X-.0040720468*z,1.9779984951*D-2.428592205*X+.4505937099*z,.0259040371*D+.7827717662*X-.808675766*z]},un=aa;function yi(a){var o=Math.abs(a);return o<.04045?a/12.92:(sa(a)||1)*na((o+.055)/1.055,2.4)}var la=g.unpack,Fr=Math.pow,oa=Math.sign,ha=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=la(a,"lab");var u=a[0],p=a[1],y=a[2],C=Fr(u+.3963377774*p+.2158037573*y,3),w=Fr(u-.1055613458*p-.0638541728*y,3),N=Fr(u-.0894841775*p-1.291485548*y,3);return[255*Si(4.0767416621*C-3.3077115913*w+.2309699292*N),255*Si(-1.2684380046*C+2.6097574011*w-.3413193965*N),255*Si(-.0041960863*C-.7034186147*w+1.707614701*N),a.length>3?a[3]:1]},gn=ha;function Si(a){var o=Math.abs(a);return o>.0031308?(oa(a)||1)*(1.055*Fr(o,1/2.4)-.055):a*12.92}var fa=g.unpack,ua=g.type,ga=W,cn=A,dn=S,ca=un;cn.prototype.oklab=function(){return ca(this._rgb)},ga.oklab=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(cn,[null].concat(a,["oklab"])))},dn.format.oklab=gn,dn.autodetect.push({p:3,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=fa(a,"oklab"),ua(a)==="array"&&a.length===3)return"oklab"}});var da=g.unpack,pa=un,va=Zi,ma=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=da(a,"rgb"),p=u[0],y=u[1],C=u[2],w=pa(p,y,C),N=w[0],$=w[1],M=w[2];return va(N,$,M)},ba=ma,wa=g.unpack,ya=Ki,Sa=gn,Ca=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=wa(a,"lch");var u=a[0],p=a[1],y=a[2],C=ya(u,p,y),w=C[0],N=C[1],$=C[2],M=Sa(w,N,$),D=M[0],X=M[1],z=M[2];return[D,X,z,a.length>3?a[3]:1]},Aa=Ca,xa=g.unpack,Na=g.type,Ra=W,pn=A,vn=S,$a=ba;pn.prototype.oklch=function(){return $a(this._rgb)},Ra.oklch=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(pn,[null].concat(a,["oklch"])))},vn.format.oklch=Aa,vn.autodetect.push({p:3,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=xa(a,"oklch"),Na(a)==="array"&&a.length===3)return"oklch"}});var mn=A,ka=g.type;mn.prototype.alpha=function(a,o){return o===void 0&&(o=!1),a!==void 0&&ka(a)==="number"?o?(this._rgb[3]=a,this):new mn([this._rgb[0],this._rgb[1],this._rgb[2],a],"rgb"):this._rgb[3]};var Ea=A;Ea.prototype.clipped=function(){return this._rgb._clipped||!1};var $t=A,Ta=Ir;$t.prototype.darken=function(a){a===void 0&&(a=1);var o=this,u=o.lab();return u[0]-=Ta.Kn*a,new $t(u,"lab").alpha(o.alpha(),!0)},$t.prototype.brighten=function(a){return a===void 0&&(a=1),this.darken(-a)},$t.prototype.darker=$t.prototype.darken,$t.prototype.brighter=$t.prototype.brighten;var La=A;La.prototype.get=function(a){var o=a.split("."),u=o[0],p=o[1],y=this[u]();if(p){var C=u.indexOf(p)-(u.substr(0,2)==="ok"?2:0);if(C>-1)return y[C];throw new Error("unknown channel "+p+" in mode "+u)}else return y};var Ft=A,Ma=g.type,Ba=Math.pow,Ia=1e-7,Pa=20;Ft.prototype.luminance=function(a){if(a!==void 0&&Ma(a)==="number"){if(a===0)return new Ft([0,0,0,this._rgb[3]],"rgb");if(a===1)return new Ft([255,255,255,this._rgb[3]],"rgb");var o=this.luminance(),u="rgb",p=Pa,y=function(w,N){var $=w.interpolate(N,.5,u),M=$.luminance();return Math.abs(a-M)<Ia||!p--?$:M>a?y(w,$):y($,N)},C=(o>a?y(new Ft([0,0,0]),this):y(this,new Ft([255,255,255]))).rgb();return new Ft(C.concat([this._rgb[3]]))}return Da.apply(void 0,this._rgb.slice(0,3))};var Da=function(a,o,u){return a=Ci(a),o=Ci(o),u=Ci(u),.2126*a+.7152*o+.0722*u},Ci=function(a){return a/=255,a<=.03928?a/12.92:Ba((a+.055)/1.055,2.4)},Ve={},bn=A,wn=g.type,zr=Ve,yn=function(a,o,u){u===void 0&&(u=.5);for(var p=[],y=arguments.length-3;y-- >0;)p[y]=arguments[y+3];var C=p[0]||"lrgb";if(!zr[C]&&!p.length&&(C=Object.keys(zr)[0]),!zr[C])throw new Error("interpolation mode "+C+" is not defined");return wn(a)!=="object"&&(a=new bn(a)),wn(o)!=="object"&&(o=new bn(o)),zr[C](a,o,u).alpha(a.alpha()+u*(o.alpha()-a.alpha()))},Sn=A,Oa=yn;Sn.prototype.mix=Sn.prototype.interpolate=function(a,o){o===void 0&&(o=.5);for(var u=[],p=arguments.length-2;p-- >0;)u[p]=arguments[p+2];return Oa.apply(void 0,[this,a,o].concat(u))};var Cn=A;Cn.prototype.premultiply=function(a){a===void 0&&(a=!1);var o=this._rgb,u=o[3];return a?(this._rgb=[o[0]*u,o[1]*u,o[2]*u,u],this):new Cn([o[0]*u,o[1]*u,o[2]*u,u],"rgb")};var Ai=A,Fa=Ir;Ai.prototype.saturate=function(a){a===void 0&&(a=1);var o=this,u=o.lch();return u[1]+=Fa.Kn*a,u[1]<0&&(u[1]=0),new Ai(u,"lch").alpha(o.alpha(),!0)},Ai.prototype.desaturate=function(a){return a===void 0&&(a=1),this.saturate(-a)};var An=A,xn=g.type;An.prototype.set=function(a,o,u){u===void 0&&(u=!1);var p=a.split("."),y=p[0],C=p[1],w=this[y]();if(C){var N=y.indexOf(C)-(y.substr(0,2)==="ok"?2:0);if(N>-1){if(xn(o)=="string")switch(o.charAt(0)){case"+":w[N]+=+o;break;case"-":w[N]+=+o;break;case"*":w[N]*=+o.substr(1);break;case"/":w[N]/=+o.substr(1);break;default:w[N]=+o}else if(xn(o)==="number")w[N]=o;else throw new Error("unsupported value for Color.set");var $=new An(w,y);return u?(this._rgb=$._rgb,this):$}throw new Error("unknown channel "+C+" in mode "+y)}else return w};var za=A,Ha=function(a,o,u){var p=a._rgb,y=o._rgb;return new za(p[0]+u*(y[0]-p[0]),p[1]+u*(y[1]-p[1]),p[2]+u*(y[2]-p[2]),"rgb")};Ve.rgb=Ha;var _a=A,xi=Math.sqrt,zt=Math.pow,Wa=function(a,o,u){var p=a._rgb,y=p[0],C=p[1],w=p[2],N=o._rgb,$=N[0],M=N[1],D=N[2];return new _a(xi(zt(y,2)*(1-u)+zt($,2)*u),xi(zt(C,2)*(1-u)+zt(M,2)*u),xi(zt(w,2)*(1-u)+zt(D,2)*u),"rgb")};Ve.lrgb=Wa;var Xa=A,Va=function(a,o,u){var p=a.lab(),y=o.lab();return new Xa(p[0]+u*(y[0]-p[0]),p[1]+u*(y[1]-p[1]),p[2]+u*(y[2]-p[2]),"lab")};Ve.lab=Va;var Nn=A,Ht=function(a,o,u,p){var y,C,w,N;p==="hsl"?(w=a.hsl(),N=o.hsl()):p==="hsv"?(w=a.hsv(),N=o.hsv()):p==="hcg"?(w=a.hcg(),N=o.hcg()):p==="hsi"?(w=a.hsi(),N=o.hsi()):p==="lch"||p==="hcl"?(p="hcl",w=a.hcl(),N=o.hcl()):p==="oklch"&&(w=a.oklch().reverse(),N=o.oklch().reverse());var $,M,D,X,z,j;(p.substr(0,1)==="h"||p==="oklch")&&(y=w,$=y[0],D=y[1],z=y[2],C=N,M=C[0],X=C[1],j=C[2]);var Y,ee,ae,he;return!isNaN($)&&!isNaN(M)?(M>$&&M-$>180?he=M-($+360):M<$&&$-M>180?he=M+360-$:he=M-$,ee=$+u*he):isNaN($)?isNaN(M)?ee=Number.NaN:(ee=M,(z==1||z==0)&&p!="hsv"&&(Y=X)):(ee=$,(j==1||j==0)&&p!="hsv"&&(Y=D)),Y===void 0&&(Y=D+u*(X-D)),ae=z+u*(j-z),p==="oklch"?new Nn([ae,Y,ee],p):new Nn([ee,Y,ae],p)},Ya=Ht,Rn=function(a,o,u){return Ya(a,o,u,"lch")};Ve.lch=Rn,Ve.hcl=Rn;var ja=A,qa=function(a,o,u){var p=a.num(),y=o.num();return new ja(p+u*(y-p),"num")};Ve.num=qa;var Ga=Ht,Ua=function(a,o,u){return Ga(a,o,u,"hcg")};Ve.hcg=Ua;var Za=Ht,Ka=function(a,o,u){return Za(a,o,u,"hsi")};Ve.hsi=Ka;var Ja=Ht,Qa=function(a,o,u){return Ja(a,o,u,"hsl")};Ve.hsl=Qa;var el=Ht,tl=function(a,o,u){return el(a,o,u,"hsv")};Ve.hsv=tl;var rl=A,il=function(a,o,u){var p=a.oklab(),y=o.oklab();return new rl(p[0]+u*(y[0]-p[0]),p[1]+u*(y[1]-p[1]),p[2]+u*(y[2]-p[2]),"oklab")};Ve.oklab=il;var nl=Ht,sl=function(a,o,u){return nl(a,o,u,"oklch")};Ve.oklch=sl;var Ni=A,al=g.clip_rgb,Ri=Math.pow,$i=Math.sqrt,ki=Math.PI,$n=Math.cos,kn=Math.sin,ll=Math.atan2,ol=function(a,o,u){o===void 0&&(o="lrgb"),u===void 0&&(u=null);var p=a.length;u||(u=Array.from(new Array(p)).map(function(){return 1}));var y=p/u.reduce(function(ee,ae){return ee+ae});if(u.forEach(function(ee,ae){u[ae]*=y}),a=a.map(function(ee){return new Ni(ee)}),o==="lrgb")return hl(a,u);for(var C=a.shift(),w=C.get(o),N=[],$=0,M=0,D=0;D<w.length;D++)if(w[D]=(w[D]||0)*u[0],N.push(isNaN(w[D])?0:u[0]),o.charAt(D)==="h"&&!isNaN(w[D])){var X=w[D]/180*ki;$+=$n(X)*u[0],M+=kn(X)*u[0]}var z=C.alpha()*u[0];a.forEach(function(ee,ae){var he=ee.get(o);z+=ee.alpha()*u[ae+1];for(var ue=0;ue<w.length;ue++)if(!isNaN(he[ue]))if(N[ue]+=u[ae+1],o.charAt(ue)==="h"){var Be=he[ue]/180*ki;$+=$n(Be)*u[ae+1],M+=kn(Be)*u[ae+1]}else w[ue]+=he[ue]*u[ae+1]});for(var j=0;j<w.length;j++)if(o.charAt(j)==="h"){for(var Y=ll(M/N[j],$/N[j])/ki*180;Y<0;)Y+=360;for(;Y>=360;)Y-=360;w[j]=Y}else w[j]=w[j]/N[j];return z/=p,new Ni(w,o).alpha(z>.99999?1:z,!0)},hl=function(a,o){for(var u=a.length,p=[0,0,0,0],y=0;y<a.length;y++){var C=a[y],w=o[y]/u,N=C._rgb;p[0]+=Ri(N[0],2)*w,p[1]+=Ri(N[1],2)*w,p[2]+=Ri(N[2],2)*w,p[3]+=N[3]*w}return p[0]=$i(p[0]),p[1]=$i(p[1]),p[2]=$i(p[2]),p[3]>.9999999&&(p[3]=1),new Ni(al(p))},tt=W,_t=g.type,fl=Math.pow,Ei=function(a){var o="rgb",u=tt("#ccc"),p=0,y=[0,1],C=[],w=[0,0],N=!1,$=[],M=!1,D=0,X=1,z=!1,j={},Y=!0,ee=1,ae=function(_){if(_=_||["#fff","#000"],_&&_t(_)==="string"&&tt.brewer&&tt.brewer[_.toLowerCase()]&&(_=tt.brewer[_.toLowerCase()]),_t(_)==="array"){_.length===1&&(_=[_[0],_[0]]),_=_.slice(0);for(var K=0;K<_.length;K++)_[K]=tt(_[K]);C.length=0;for(var ie=0;ie<_.length;ie++)C.push(ie/(_.length-1))}return ze(),$=_},he=function(_){if(N!=null){for(var K=N.length-1,ie=0;ie<K&&_>=N[ie];)ie++;return ie-1}return 0},ue=function(_){return _},Be=function(_){return _},Ee=function(_,K){var ie,te;if(K==null&&(K=!1),isNaN(_)||_===null)return u;if(K)te=_;else if(N&&N.length>2){var Ie=he(_);te=Ie/(N.length-2)}else X!==D?te=(_-D)/(X-D):te=1;te=Be(te),K||(te=ue(te)),ee!==1&&(te=fl(te,ee)),te=w[0]+te*(1-w[0]-w[1]),te=Math.min(1,Math.max(0,te));var be=Math.floor(te*1e4);if(Y&&j[be])ie=j[be];else{if(_t($)==="array")for(var fe=0;fe<C.length;fe++){var ge=C[fe];if(te<=ge){ie=$[fe];break}if(te>=ge&&fe===C.length-1){ie=$[fe];break}if(te>ge&&te<C[fe+1]){te=(te-ge)/(C[fe+1]-ge),ie=tt.interpolate($[fe],$[fe+1],te,o);break}}else _t($)==="function"&&(ie=$(te));Y&&(j[be]=ie)}return ie},ze=function(){return j={}};ae(a);var oe=function(_){var K=tt(Ee(_));return M&&K[M]?K[M]():K};return oe.classes=function(_){if(_!=null){if(_t(_)==="array")N=_,y=[_[0],_[_.length-1]];else{var K=tt.analyze(y);_===0?N=[K.min,K.max]:N=tt.limits(K,"e",_)}return oe}return N},oe.domain=function(_){if(!arguments.length)return y;D=_[0],X=_[_.length-1],C=[];var K=$.length;if(_.length===K&&D!==X)for(var ie=0,te=Array.from(_);ie<te.length;ie+=1){var Ie=te[ie];C.push((Ie-D)/(X-D))}else{for(var be=0;be<K;be++)C.push(be/(K-1));if(_.length>2){var fe=_.map(function(ce,de){return de/(_.length-1)}),ge=_.map(function(ce){return(ce-D)/(X-D)});ge.every(function(ce,de){return fe[de]===ce})||(Be=function(ce){if(ce<=0||ce>=1)return ce;for(var de=0;ce>=ge[de+1];)de++;var it=(ce-ge[de])/(ge[de+1]-ge[de]),yt=fe[de]+it*(fe[de+1]-fe[de]);return yt})}}return y=[D,X],oe},oe.mode=function(_){return arguments.length?(o=_,ze(),oe):o},oe.range=function(_,K){return ae(_),oe},oe.out=function(_){return M=_,oe},oe.spread=function(_){return arguments.length?(p=_,oe):p},oe.correctLightness=function(_){return _==null&&(_=!0),z=_,ze(),z?ue=function(K){for(var ie=Ee(0,!0).lab()[0],te=Ee(1,!0).lab()[0],Ie=ie>te,be=Ee(K,!0).lab()[0],fe=ie+(te-ie)*K,ge=be-fe,ce=0,de=1,it=20;Math.abs(ge)>.01&&it-- >0;)(function(){return Ie&&(ge*=-1),ge<0?(ce=K,K+=(de-K)*.5):(de=K,K+=(ce-K)*.5),be=Ee(K,!0).lab()[0],ge=be-fe})();return K}:ue=function(K){return K},oe},oe.padding=function(_){return _!=null?(_t(_)==="number"&&(_=[_,_]),w=_,oe):w},oe.colors=function(_,K){arguments.length<2&&(K="hex");var ie=[];if(arguments.length===0)ie=$.slice(0);else if(_===1)ie=[oe(.5)];else if(_>1){var te=y[0],Ie=y[1]-te;ie=ul(0,_,!1).map(function(de){return oe(te+de/(_-1)*Ie)})}else{a=[];var be=[];if(N&&N.length>2)for(var fe=1,ge=N.length,ce=1<=ge;ce?fe<ge:fe>ge;ce?fe++:fe--)be.push((N[fe-1]+N[fe])*.5);else be=y;ie=be.map(function(de){return oe(de)})}return tt[K]&&(ie=ie.map(function(de){return de[K]()})),ie},oe.cache=function(_){return _!=null?(Y=_,oe):Y},oe.gamma=function(_){return _!=null?(ee=_,oe):ee},oe.nodata=function(_){return _!=null?(u=tt(_),oe):u},oe};function ul(a,o,u){for(var p=[],y=a<o,C=u?y?o+1:o-1:o,w=a;y?w<C:w>C;y?w++:w--)p.push(w);return p}var sr=A,gl=Ei,cl=function(a){for(var o=[1,1],u=1;u<a;u++){for(var p=[1],y=1;y<=o.length;y++)p[y]=(o[y]||0)+o[y-1];o=p}return o},dl=function(a){var o,u,p,y,C,w,N;if(a=a.map(function(z){return new sr(z)}),a.length===2)o=a.map(function(z){return z.lab()}),C=o[0],w=o[1],y=function(z){var j=[0,1,2].map(function(Y){return C[Y]+z*(w[Y]-C[Y])});return new sr(j,"lab")};else if(a.length===3)u=a.map(function(z){return z.lab()}),C=u[0],w=u[1],N=u[2],y=function(z){var j=[0,1,2].map(function(Y){return(1-z)*(1-z)*C[Y]+2*(1-z)*z*w[Y]+z*z*N[Y]});return new sr(j,"lab")};else if(a.length===4){var $;p=a.map(function(z){return z.lab()}),C=p[0],w=p[1],N=p[2],$=p[3],y=function(z){var j=[0,1,2].map(function(Y){return(1-z)*(1-z)*(1-z)*C[Y]+3*(1-z)*(1-z)*z*w[Y]+3*(1-z)*z*z*N[Y]+z*z*z*$[Y]});return new sr(j,"lab")}}else if(a.length>=5){var M,D,X;M=a.map(function(z){return z.lab()}),X=a.length-1,D=cl(X),y=function(z){var j=1-z,Y=[0,1,2].map(function(ee){return M.reduce(function(ae,he,ue){return ae+D[ue]*Math.pow(j,X-ue)*Math.pow(z,ue)*he[ee]},0)});return new sr(Y,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return y},pl=function(a){var o=dl(a);return o.scale=function(){return gl(o)},o},Ti=W,rt=function(a,o,u){if(!rt[u])throw new Error("unknown blend mode "+u);return rt[u](a,o)},bt=function(a){return function(o,u){var p=Ti(u).rgb(),y=Ti(o).rgb();return Ti.rgb(a(p,y))}},wt=function(a){return function(o,u){var p=[];return p[0]=a(o[0],u[0]),p[1]=a(o[1],u[1]),p[2]=a(o[2],u[2]),p}},vl=function(a){return a},ml=function(a,o){return a*o/255},bl=function(a,o){return a>o?o:a},wl=function(a,o){return a>o?a:o},yl=function(a,o){return 255*(1-(1-a/255)*(1-o/255))},Sl=function(a,o){return o<128?2*a*o/255:255*(1-2*(1-a/255)*(1-o/255))},Cl=function(a,o){return 255*(1-(1-o/255)/(a/255))},Al=function(a,o){return a===255?255:(a=255*(o/255)/(1-a/255),a>255?255:a)};rt.normal=bt(wt(vl)),rt.multiply=bt(wt(ml)),rt.screen=bt(wt(yl)),rt.overlay=bt(wt(Sl)),rt.darken=bt(wt(bl)),rt.lighten=bt(wt(wl)),rt.dodge=bt(wt(Al)),rt.burn=bt(wt(Cl));for(var xl=rt,Li=g.type,Nl=g.clip_rgb,Rl=g.TWOPI,$l=Math.pow,kl=Math.sin,El=Math.cos,En=W,Tl=function(a,o,u,p,y){a===void 0&&(a=300),o===void 0&&(o=-1.5),u===void 0&&(u=1),p===void 0&&(p=1),y===void 0&&(y=[0,1]);var C=0,w;Li(y)==="array"?w=y[1]-y[0]:(w=0,y=[y,y]);var N=function($){var M=Rl*((a+120)/360+o*$),D=$l(y[0]+w*$,p),X=C!==0?u[0]+$*C:u,z=X*D*(1-D)/2,j=El(M),Y=kl(M),ee=D+z*(-.14861*j+1.78277*Y),ae=D+z*(-.29227*j-.90649*Y),he=D+z*(1.97294*j);return En(Nl([ee*255,ae*255,he*255,1]))};return N.start=function($){return $==null?a:(a=$,N)},N.rotations=function($){return $==null?o:(o=$,N)},N.gamma=function($){return $==null?p:(p=$,N)},N.hue=function($){return $==null?u:(u=$,Li(u)==="array"?(C=u[1]-u[0],C===0&&(u=u[1])):C=0,N)},N.lightness=function($){return $==null?y:(Li($)==="array"?(y=$,w=$[1]-$[0]):(y=[$,$],w=0),N)},N.scale=function(){return En.scale(N)},N.hue(u),N},Ll=A,Ml="0123456789abcdef",Bl=Math.floor,Il=Math.random,Pl=function(){for(var a="#",o=0;o<6;o++)a+=Ml.charAt(Bl(Il()*16));return new Ll(a,"hex")},Mi=n,Tn=Math.log,Dl=Math.pow,Ol=Math.floor,Fl=Math.abs,Ln=function(a,o){o===void 0&&(o=null);var u={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return Mi(a)==="object"&&(a=Object.values(a)),a.forEach(function(p){o&&Mi(p)==="object"&&(p=p[o]),p!=null&&!isNaN(p)&&(u.values.push(p),u.sum+=p,p<u.min&&(u.min=p),p>u.max&&(u.max=p),u.count+=1)}),u.domain=[u.min,u.max],u.limits=function(p,y){return Mn(u,p,y)},u},Mn=function(a,o,u){o===void 0&&(o="equal"),u===void 0&&(u=7),Mi(a)=="array"&&(a=Ln(a));var p=a.min,y=a.max,C=a.values.sort(function(Ii,Pi){return Ii-Pi});if(u===1)return[p,y];var w=[];if(o.substr(0,1)==="c"&&(w.push(p),w.push(y)),o.substr(0,1)==="e"){w.push(p);for(var N=1;N<u;N++)w.push(p+N/u*(y-p));w.push(y)}else if(o.substr(0,1)==="l"){if(p<=0)throw new Error("Logarithmic scales are only possible for values > 0");var $=Math.LOG10E*Tn(p),M=Math.LOG10E*Tn(y);w.push(p);for(var D=1;D<u;D++)w.push(Dl(10,$+D/u*(M-$)));w.push(y)}else if(o.substr(0,1)==="q"){w.push(p);for(var X=1;X<u;X++){var z=(C.length-1)*X/u,j=Ol(z);if(j===z)w.push(C[j]);else{var Y=z-j;w.push(C[j]*(1-Y)+C[j+1]*Y)}}w.push(y)}else if(o.substr(0,1)==="k"){var ee,ae=C.length,he=new Array(ae),ue=new Array(u),Be=!0,Ee=0,ze=null;ze=[],ze.push(p);for(var oe=1;oe<u;oe++)ze.push(p+oe/u*(y-p));for(ze.push(y);Be;){for(var _=0;_<u;_++)ue[_]=0;for(var K=0;K<ae;K++)for(var ie=C[K],te=Number.MAX_VALUE,Ie=void 0,be=0;be<u;be++){var fe=Fl(ze[be]-ie);fe<te&&(te=fe,Ie=be),ue[Ie]++,he[K]=Ie}for(var ge=new Array(u),ce=0;ce<u;ce++)ge[ce]=null;for(var de=0;de<ae;de++)ee=he[de],ge[ee]===null?ge[ee]=C[de]:ge[ee]+=C[de];for(var it=0;it<u;it++)ge[it]*=1/ue[it];Be=!1;for(var yt=0;yt<u;yt++)if(ge[yt]!==ze[yt]){Be=!0;break}ze=ge,Ee++,Ee>200&&(Be=!1)}for(var St={},Wt=0;Wt<u;Wt++)St[Wt]=[];for(var Xt=0;Xt<ae;Xt++)ee=he[Xt],St[ee].push(C[Xt]);for(var gt=[],kt=0;kt<u;kt++)gt.push(St[kt][0]),gt.push(St[kt][St[kt].length-1]);gt=gt.sort(function(Ii,Pi){return Ii-Pi}),w.push(gt[0]);for(var ar=1;ar<gt.length;ar+=2){var Et=gt[ar];!isNaN(Et)&&w.indexOf(Et)===-1&&w.push(Et)}}return w},Bn={analyze:Ln,limits:Mn},In=A,zl=function(a,o){a=new In(a),o=new In(o);var u=a.luminance(),p=o.luminance();return u>p?(u+.05)/(p+.05):(p+.05)/(u+.05)},Pn=A,ut=Math.sqrt,Ce=Math.pow,Hl=Math.min,_l=Math.max,Dn=Math.atan2,On=Math.abs,Hr=Math.cos,Fn=Math.sin,Wl=Math.exp,zn=Math.PI,Xl=function(a,o,u,p,y){u===void 0&&(u=1),p===void 0&&(p=1),y===void 0&&(y=1);var C=function(Et){return 360*Et/(2*zn)},w=function(Et){return 2*zn*Et/360};a=new Pn(a),o=new Pn(o);var N=Array.from(a.lab()),$=N[0],M=N[1],D=N[2],X=Array.from(o.lab()),z=X[0],j=X[1],Y=X[2],ee=($+z)/2,ae=ut(Ce(M,2)+Ce(D,2)),he=ut(Ce(j,2)+Ce(Y,2)),ue=(ae+he)/2,Be=.5*(1-ut(Ce(ue,7)/(Ce(ue,7)+Ce(25,7)))),Ee=M*(1+Be),ze=j*(1+Be),oe=ut(Ce(Ee,2)+Ce(D,2)),_=ut(Ce(ze,2)+Ce(Y,2)),K=(oe+_)/2,ie=C(Dn(D,Ee)),te=C(Dn(Y,ze)),Ie=ie>=0?ie:ie+360,be=te>=0?te:te+360,fe=On(Ie-be)>180?(Ie+be+360)/2:(Ie+be)/2,ge=1-.17*Hr(w(fe-30))+.24*Hr(w(2*fe))+.32*Hr(w(3*fe+6))-.2*Hr(w(4*fe-63)),ce=be-Ie;ce=On(ce)<=180?ce:be<=Ie?ce+360:ce-360,ce=2*ut(oe*_)*Fn(w(ce)/2);var de=z-$,it=_-oe,yt=1+.015*Ce(ee-50,2)/ut(20+Ce(ee-50,2)),St=1+.045*K,Wt=1+.015*K*ge,Xt=30*Wl(-Ce((fe-275)/25,2)),gt=2*ut(Ce(K,7)/(Ce(K,7)+Ce(25,7))),kt=-gt*Fn(2*w(Xt)),ar=ut(Ce(de/(u*yt),2)+Ce(it/(p*St),2)+Ce(ce/(y*Wt),2)+kt*(it/(p*St))*(ce/(y*Wt)));return _l(0,Hl(100,ar))},Hn=A,Vl=function(a,o,u){u===void 0&&(u="lab"),a=new Hn(a),o=new Hn(o);var p=a.get(u),y=o.get(u),C=0;for(var w in p){var N=(p[w]||0)-(y[w]||0);C+=N*N}return Math.sqrt(C)},Yl=A,jl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];try{return new(Function.prototype.bind.apply(Yl,[null].concat(a))),!0}catch(u){return!1}},_n=W,Wn=Ei,ql={cool:function(){return Wn([_n.hsl(180,1,.9),_n.hsl(250,.7,.4)])},hot:function(){return Wn(["#000","#f00","#ff0","#fff"]).mode("rgb")}},_r={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Bi=0,Xn=Object.keys(_r);Bi<Xn.length;Bi+=1){var Vn=Xn[Bi];_r[Vn.toLowerCase()]=_r[Vn]}var Gl=_r,ke=W;ke.average=ol,ke.bezier=pl,ke.blend=xl,ke.cubehelix=Tl,ke.mix=ke.interpolate=yn,ke.random=Pl,ke.scale=Ei,ke.analyze=Bn.analyze,ke.contrast=zl,ke.deltaE=Xl,ke.distance=Vl,ke.limits=Bn.limits,ke.valid=jl,ke.scales=ql,ke.colors=tn,ke.brewer=Gl;var Ul=ke;return Ul})});var pe=class k{static clone(e){let r=Array.isArray(e)?[]:{};for(let t in e){let i=e[t];typeof i.clone=="function"?r[t]=i.clone():r[t]=typeof i=="object"?k.clone(i):i}return r}static equals(e,r){if(e.length!==r.length)return!1;let t=e.slice().sort(),i=r.slice().sort();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}static print(e){if(e.length==0)return"";let r="(";for(let t=0;t<e.length;t++)r+=e[t].id?e[t].id+", ":e[t]+", ";return r=r.substring(0,r.length-2),r+")"}static each(e,r){for(let t=0;t<e.length;t++)r(e[t])}static get(e,r,t){for(let i=0;i<e.length;i++)if(e[i][r]==t)return e[i]}static contains(e,r){if(!r.property&&!r.func){for(let t=0;t<e.length;t++)if(e[t]==r.value)return!0}else if(r.func){for(let t=0;t<e.length;t++)if(r.func(e[t]))return!0}else for(let t=0;t<e.length;t++)if(e[t][r.property]==r.value)return!0;return!1}static intersection(e,r){let t=[];for(let i=0;i<e.length;i++)for(let s=0;s<r.length;s++)e[i]===r[s]&&t.push(e[i]);return t}static unique(e){let r={};return e.filter(function(t){return r[t]!==void 0?!1:r[t]=!0})}static count(e,r){let t=0;for(let i=0;i<e.length;i++)e[i]===r&&t++;return t}static toggle(e,r){let t=[],i=!1;for(let s=0;s<e.length;s++)e[s]!==r?t.push(e[s]):i=!0;return i||t.push(r),t}static remove(e,r){let t=[];for(let i=0;i<e.length;i++)e[i]!==r&&t.push(e[i]);return t}static removeUnique(e,r){let t=e.indexOf(r);return t>-1&&e.splice(t,1),e}static removeAll(e,r){return e.filter(function(t){return r.indexOf(t)===-1})}static merge(e,r){let t=new Array(e.length+r.length);for(let i=0;i<e.length;i++)t[i]=e[i];for(let i=0;i<r.length;i++)t[e.length+i]=r[i];return t}static containsAll(e,r){let t=0;for(let i=0;i<e.length;i++)for(let s=0;s<r.length;s++)e[i]===r[s]&&t++;return t===r.length}static sortByAtomicNumberDesc(e){let r=e.map(function(t,i){return{index:i,value:t.atomicNumber.split(".").map(Number)}});return r.sort(function(t,i){let s=Math.min(i.value.length,t.value.length),l=0;for(;l<s&&i.value[l]===t.value[l];)l++;return l===s?i.value.length-t.value.length:i.value[l]-t.value[l]}),r.map(function(t){return e[t.index]})}static deepCopy(e){let r=[];for(let t=0;t<e.length;t++){let i=e[t];i instanceof Array?r[t]=k.deepCopy(i):r[t]=i}return r}};var Ue=class k{constructor(e,r="-"){this.idx=null,this.element=e.length===1?e.toUpperCase():e,this.drawExplicit=!1,this.ringbonds=[],this.rings=[],this.bondType=r,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=[],this.bridgedRing=null,this.anchoredRings=[],this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=[],this.isPartOfAromaticRing=e!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1,this.class=void 0}addNeighbouringElement(e){this.neighbouringElements.push(e)}attachPseudoElement(e,r,t=0,i=0){t===null&&(t=0),i===null&&(i=0);let s=t+e+i;this.attachedPseudoElements[s]?this.attachedPseudoElements[s].count+=1:this.attachedPseudoElements[s]={element:e,count:1,hydrogenCount:t,previousElement:r,charge:i},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let e={};return Object.keys(this.attachedPseudoElements).sort().forEach(r=>{e[r]=this.attachedPseudoElements[r]}),e}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return this.element!=="C"&&this.element!=="H"}addAnchoredRing(e){pe.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}restoreRings(){this.rings=Array(this.originalRings.length);for(let e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}haveCommonRingbond(e,r){for(let t=0;t<e.ringbonds.length;t++)for(let i=0;i<r.ringbonds.length;i++)if(e.ringbonds[t].id==r.ringbonds[i].id)return!0;return!1}neighbouringElementsEqual(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(let r=0;r<this.neighbouringElements.length;r++)if(e[r]!==this.neighbouringElements[r])return!1;return!0}getAtomicNumber(){return k.atomicNumbers[this.element]}getMaxBonds(){return k.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}};var T=class k{constructor(e,r){arguments.length==0?(this.x=0,this.y=0):e instanceof k?(this.x=e.x,this.y=e.y):(this.x=e,this.y=r)}clone(){return new k(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}divide(e){return this.x/=e,this.y/=e,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}distanceSq(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}clockwise(e){let r=this.y*e.x,t=this.x*e.y;return r>t?-1:r===t?0:1}relativeClockwise(e,r){let t=(this.y-e.y)*(r.x-e.x),i=(this.x-e.x)*(r.y-e.y);return t>i?-1:t===i?0:1}rotate(e){let r=new k(0,0),t=Math.cos(e),i=Math.sin(e);return r.x=this.x*t-this.y*i,r.y=this.x*i+this.y*t,this.x=r.x,this.y=r.y,this}rotateAround(e,r){let t=Math.sin(e),i=Math.cos(e);this.x-=r.x,this.y-=r.y;let s=this.x*i-this.y*t,l=this.x*t+this.y*i;return this.x=s+r.x,this.y=l+r.y,this}rotateTo(e,r,t=0){this.x+=.001,this.y-=.001;let i=k.subtract(this,r),s=k.subtract(e,r),l=k.angle(s,i);return this.rotateAround(l+t,r),this}rotateAwayFrom(e,r,t){this.rotateAround(t,r);let i=this.distanceSq(e);this.rotateAround(-2*t,r),this.distanceSq(e)<i&&this.rotateAround(2*t,r)}getRotateAwayFromAngle(e,r,t){let i=this.clone();i.rotateAround(t,r);let s=i.distanceSq(e);return i.rotateAround(-2*t,r),i.distanceSq(e)<s?t:-t}getRotateTowardsAngle(e,r,t){let i=this.clone();i.rotateAround(t,r);let s=i.distanceSq(e);return i.rotateAround(-2*t,r),i.distanceSq(e)>s?t:-t}getRotateToAngle(e,r){let t=k.subtract(this,r),i=k.subtract(e,r),s=k.angle(i,t);return Number.isNaN(s)?0:s}isInPolygon(e){let r=!1;for(let t=0,i=e.length-1;t<e.length;i=t++){let s=e[t],l=e[i];s.y>this.y!=l.y>this.y&&this.x<(l.x-s.x)*(this.y-s.y)/(l.y-s.y)+s.x&&(r=!r)}return r}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return k.divideScalar(this,this.length())}whichSide(e,r){return(this.x-e.x)*(r.y-e.y)-(this.y-e.y)*(r.x-e.x)}sameSideAs(e,r,t){let i=this.whichSide(e,r),s=t.whichSide(e,r);return i<0&&s<0||i==0&&s==0||i>0&&s>0}static add(e,r){return new k(e.x+r.x,e.y+r.y)}static subtract(e,r){return new k(e.x-r.x,e.y-r.y)}static multiply(e,r){return new k(e.x*r.x,e.y*r.y)}static multiplyScalar(e,r){return new k(e.x,e.y).multiplyScalar(r)}static midpoint(e,r){return new k((e.x+r.x)/2,(e.y+r.y)/2)}static normals(e,r){let t=k.subtract(r,e);return[new k(-t.y,t.x),new k(t.y,-t.x)]}static units(e,r){let t=k.subtract(r,e);return[new k(-t.y,t.x).normalize(),new k(t.y,-t.x).normalize()]}static divide(e,r){return new k(e.x/r.x,e.y/r.y)}static divideScalar(e,r){return new k(e.x/r,e.y/r)}static dot(e,r){return e.x*r.x+e.y*r.y}static angle(e,r){let t=k.dot(e,r);return Math.acos(t/(e.length()*r.length()))}static threePointangle(e,r,t){let i=k.subtract(r,e),s=k.subtract(t,r),l=e.distance(r),n=r.distance(t);return Math.acos(k.dot(i,s)/(l*n))}static scalarProjection(e,r){let t=r.normalized();return k.dot(e,t)}static averageDirection(e){let r=new k(0,0);for(let t=0;t<e.length;t++){let i=e[t];r.add(i)}return r.normalize()}};var Q=class k{constructor(e=new T(0,0),r=new T(0,0),t=null,i=null,s=!1,l=!1){this.from=e,this.to=r,this.elementFrom=t,this.elementTo=i,this.chiralFrom=s,this.chiralTo=l}clone(){return new k(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){let e=this.to.x-this.from.x,r=this.to.y-this.from.y;return Math.sqrt(e*e+r*r)}getAngle(){return T.subtract(this.getRightVector(),this.getLeftVector()).angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(e,r){return this.from.x<this.to.x?(this.to.x=e,this.to.y=r):(this.from.x=e,this.from.y=r),this}setLeftVector(e,r){return this.from.x<this.to.x?(this.from.x=e,this.from.y=r):(this.to.x=e,this.to.y=r),this}rotateToXAxis(){let e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}rotate(e){let r=this.getLeftVector(),t=this.getRightVector(),i=Math.sin(e),s=Math.cos(e),l=s*(t.x-r.x)-i*(t.y-r.y)+r.x,n=i*(t.x-r.x)-s*(t.y-r.y)+r.y;return this.setRightVector(l,n),this}shortenFrom(e){let r=T.subtract(this.to,this.from);return r.normalize(),r.multiplyScalar(e),this.from.add(r),this}shortenTo(e){let r=T.subtract(this.from,this.to);return r.normalize(),r.multiplyScalar(e),this.to.add(r),this}shortenRight(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}shortenLeft(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}shorten(e){let r=T.subtract(this.from,this.to);return r.normalize(),r.multiplyScalar(e/2),this.to.add(r),this.from.subtract(r),this}};var re=class k{static round(e,r){if(r){let t=Math.pow(10,r);return Math.round(e*t)/t}else return Math.round(e)}static meanAngle(e){let r=0,t=0;for(let i=0;i<e.length;i++)r+=Math.sin(e[i]),t+=Math.cos(e[i]);return Math.atan2(r/e.length,t/e.length)}static innerAngle(e){return k.toRad((e-2)*180/e)}static polyCircumradius(e,r){return e/(2*Math.sin(Math.PI/r))}static apothem(e,r){return e*Math.cos(Math.PI/r)}static apothemFromSideLength(e,r){let t=k.polyCircumradius(e,r);return k.apothem(t,r)}static centralAngle(e){return k.toRad(360/e)}static toDeg(e){return e*k.degFactor}static toRad(e){return e*k.radFactor}static parityOfPermutation(e){let r=new Uint8Array(e.length),t=0,i=function(s,l=0){return r[s]===1?l:(l++,r[s]=1,i(e[s],l))};for(let s=0;s<e.length;s++){if(r[s]===1)continue;let l=i(s);t+=1-l%2}return t%2?-1:1}static get radFactor(){return Math.PI/180}static get degFactor(){return 180/Math.PI}static get twoPI(){return 2*Math.PI}};var lr=class k{constructor(e,r=0,t=0){this.id=null,this.value=e,this.position=new T(r||0,t||0),this.previousPosition=new T(0,0),this.parentVertexId=null,this.children=[],this.spanningTreeChildren=[],this.edges=[],this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=[],this.neighbouringElements=[],this.forcePositioned=!1}setPosition(e,r){this.position.x=e,this.position.y=r}setPositionFromVector(e){this.position.x=e.x,this.position.y=e.y}addChild(e){this.children.push(e),this.neighbours.push(e),this.neighbourCount++}addRingbondChild(e,r){if(this.children.push(e),this.value.bracket){let t=1;this.id===0&&this.value.bracket.hcount===0&&(t=0),this.value.bracket.hcount===1&&r===0&&(t=2),this.value.bracket.hcount===1&&r===1&&(this.neighbours.length<3?t=2:t=3),this.value.bracket.hcount===null&&r===0&&(t=1),this.value.bracket.hcount===null&&r===1&&(this.neighbours.length<3?t=1:t=2),this.neighbours.splice(t,0,e)}else this.neighbours.push(e);this.neighbourCount++}setParentVertexId(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e)}isTerminal(){return this.value.hasAttachedPseudoElements?!0:this.parentVertexId===null&&this.children.length<2||this.children.length===0}clone(){let e=new k(this.value,this.position.x,this.position.y);return e.id=this.id,e.previousPosition=new T(this.previousPosition.x,this.previousPosition.y),e.parentVertexId=this.parentVertexId,e.children=pe.clone(this.children),e.spanningTreeChildren=pe.clone(this.spanningTreeChildren),e.edges=pe.clone(this.edges),e.positioned=this.positioned,e.angle=this.angle,e.forcePositioned=this.forcePositioned,e}equals(e){return this.id===e.id}getAngle(e=null,r=!1){let t=null;return e?t=T.subtract(this.position,e):t=T.subtract(this.position,this.previousPosition),r?re.toDeg(t.angle()):t.angle()}getTextDirection(e,r=!1){let t=this.getDrawnNeighbours(e),i=[];if(e.length===1)return"right";for(let l=0;l<t.length;l++)i.push(this.getAngle(e[t[l]].position));let s=re.meanAngle(i);if(this.isTerminal()||r)Math.round(s*100)/100===1.57&&(s=s-.2),s=Math.round(Math.round(s/Math.PI)*Math.PI);else{let l=Math.PI/2;s=Math.round(Math.round(s/l)*l)}return s===2?"down":s===-2?"up":s===0?"right":s===3||s===-3?"left":"down"}getNeighbours(e=null){if(e===null)return this.neighbours.slice();let r=[];for(let t=0;t<this.neighbours.length;t++)this.neighbours[t]!==e&&r.push(this.neighbours[t]);return r}getDrawnNeighbours(e){let r=[];for(let t=0;t<this.neighbours.length;t++)e[this.neighbours[t]].value.isDrawn&&r.push(this.neighbours[t]);return r}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(e=null){let r=[];for(let t=0;t<this.spanningTreeChildren.length;t++)(e===void 0||e!=this.spanningTreeChildren[t])&&r.push(this.spanningTreeChildren[t]);return this.parentVertexId!=null&&(e===void 0||e!=this.parentVertexId)&&r.push(this.parentVertexId),r}getNextInRing(e,r,t){let i=this.getNeighbours();for(let s=0;s<i.length;s++)if(pe.contains(e[i[s]].value.rings,{value:r})&&i[s]!=t)return i[s];return null}};var lt=class{constructor(e,r){this.id=null,this.firstRingId=e.id,this.secondRingId=r.id,this.vertices=new Set;for(let t=0;t<e.members.length;t++){let i=e.members[t];for(let s=0;s<r.members.length;s++){let l=r.members[s];i===l&&this.addVertex(i)}}}addVertex(e){this.vertices.add(e)}updateOther(e,r){this.firstRingId===r?this.secondRingId=e:this.firstRingId=e}containsRing(e){return this.firstRingId===e||this.secondRingId===e}isBridge(e){if(this.vertices.size>2)return!0;for(let r of this.vertices)if(e[r].value.rings.length>2)return!0;return!1}static isBridge(e,r,t,i){let s=null;for(let l=0;l<e.length;l++)if(s=e[l],s.firstRingId===t&&s.secondRingId===i||s.firstRingId===i&&s.secondRingId===t)return s.isBridge(r);return!1}static getNeighbours(e,r){let t=[];for(let i=0;i<e.length;i++){let s=e[i];s.firstRingId===r?t.push(s.secondRingId):s.secondRingId===r&&t.push(s.firstRingId)}return t}static getVertices(e,r,t){for(let i=0;i<e.length;i++){let s=e[i];if(s.firstRingId===r&&s.secondRingId===t||s.firstRingId===t&&s.secondRingId===r)return[...s.vertices]}}};var Vt=class k{constructor(e){this.id=null,this.members=e,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new T(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let e=new k(this.members);return e.id=this.id,e.insiders=pe.clone(this.insiders),e.neighbours=pe.clone(this.neighbours),e.positioned=this.positioned,e.center=this.center.clone(),e.rings=pe.clone(this.rings),e.isBridged=this.isBridged,e.isPartOfBridged=this.isPartOfBridged,e.isSpiro=this.isSpiro,e.isFused=this.isFused,e.centralAngle=this.centralAngle,e.canFlip=this.canFlip,e}getSize(){return this.members.length}getPolygon(e){let r=[];for(let t=0;t<this.members.length;t++)r.push(e[this.members[t]].position);return r}getAngle(){return Math.PI-this.centralAngle}eachMember(e,r,t,i){t=t||t===0?t:this.members[0];let s=t,l=0;for(;s!=null&&l<100;){let n=s;r(n),s=e[s].getNextInRing(e,this.id,i),i=n,s==t&&(s=null),l++}}getOrderedNeighbours(e){let r=Array(this.neighbours.length);for(let t=0;t<this.neighbours.length;t++){let i=lt.getVertices(e,this.id,this.neighbours[t]);r[t]={n:i.length,neighbour:this.neighbours[t]}}return r.sort((t,i)=>i.n-t.n),r}isBenzeneLike(e){let r=this.getDoubleBondCount(e),t=this.members.length;return r===3&&t===6||r===2&&t===5}getDoubleBondCount(e){let r=0;for(let t=0;t<this.members.length;t++){let i=e[this.members[t]].value;(i.bondType==="="||i.branchBond==="=")&&r++}return r}contains(e){for(let r=0;r<this.members.length;r++)if(this.members[r]==e)return!0;return!1}};var ct=class{constructor(e,r){this.colors=e,this.theme=this.colors[r]}getColor(e){return e&&(e=e.toUpperCase(),e in this.theme)?this.theme[e]:this.theme.C}setTheme(e){e in this.colors&&(this.theme=this.colors[e])}};function jn(k){return k?k===1?"+":k===-1?"-":k>0?k+"+":k+"-":""}var or=class{constructor(e,r,t){let i=null;if(e instanceof String?i=document.getElementById(e.valueOf()):typeof e=="string"?i=document.getElementById(e):i=e,i instanceof HTMLCanvasElement)this.canvas=i;else throw Error("First argument was not a canvas or the ID of a canvas.");this.ctx=this.canvas.getContext("2d"),this.themeManager=r,this.opts=t,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(e,r){this.ratio=window.devicePixelRatio||1,this.ratio!==1?(this.canvas.width=e*this.ratio,this.canvas.height=r*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=r+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=e*this.ratio,this.canvas.height=r*this.ratio)}setTheme(e){this.colors=e}scale(e){let r=-Number.MAX_VALUE,t=-Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MAX_VALUE;for(let c=0;c<e.length;c++){if(!e[c].value.isDrawn)continue;let d=e[c].position;r<d.x&&(r=d.x),t<d.y&&(t=d.y),i>d.x&&(i=d.x),s>d.y&&(s=d.y)}let l=this.opts.padding;r+=l,t+=l,i-=l,s-=l,this.drawingWidth=r-i,this.drawingHeight=t-s;let n=this.canvas.offsetWidth/this.drawingWidth,h=this.canvas.offsetHeight/this.drawingHeight,f=n<h?n:h;this.ctx.scale(f,f),this.offsetX=-i,this.offsetY=-s,n<h?this.offsetY+=this.canvas.offsetHeight/(2*f)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*f)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}drawCircle(e,r,t,i,s=!0,l=!1,n=""){let h=this.ctx,f=this.offsetX,c=this.offsetY;h.save(),h.lineWidth=1.5,h.beginPath(),h.arc(e+f,r+c,t,0,re.twoPI,!0),h.closePath(),l?(s?(h.fillStyle="#f00",h.fill()):(h.strokeStyle="#f00",h.stroke()),this.drawDebugText(e,r,n)):s?(h.fillStyle=i,h.fill()):(h.strokeStyle=i,h.stroke()),h.restore()}drawLine(e,r=!1,t=1){let i=this.ctx,s=this.offsetX,l=this.offsetY,n=e.clone().shorten(4),h=n.getLeftVector().clone(),f=n.getRightVector().clone();h.x+=s,h.y+=l,f.x+=s,f.y+=l,r||(i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(h.x,h.y),i.lineTo(f.x,f.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness+1.2,i.strokeStyle=this.themeManager.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()),h=e.getLeftVector().clone(),f=e.getRightVector().clone(),h.x+=s,h.y+=l,f.x+=s,f.y+=l,i.save(),i.beginPath(),i.moveTo(h.x,h.y),i.lineTo(f.x,f.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness;let c=this.ctx.createLinearGradient(h.x,h.y,f.x,f.y);c.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),c.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),r&&(i.setLineDash([1,1.5]),i.lineWidth=this.opts.bondThickness/1.5),t<1&&(i.globalAlpha=t),i.strokeStyle=c,i.stroke(),i.restore()}drawWedge(e,r=1){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=this.ctx,i=this.offsetX,s=this.offsetY,l=e.clone().shorten(5),n=l.getLeftVector().clone(),h=l.getRightVector().clone();n.x+=i,n.y+=s,h.x+=i,h.y+=s,n=e.getLeftVector().clone(),h=e.getRightVector().clone(),n.x+=i,n.y+=s,h.x+=i,h.y+=s,t.save();let f=T.normals(n,h);f[0].normalize(),f[1].normalize();let c=e.getRightChiral(),d=n,b=h;c&&(d=h,b=n);let g=T.add(d,T.multiplyScalar(f[0],this.halfBondThickness)),S=T.add(b,T.multiplyScalar(f[0],1.5+this.halfBondThickness)),L=T.add(b,T.multiplyScalar(f[1],1.5+this.halfBondThickness)),E=T.add(d,T.multiplyScalar(f[1],this.halfBondThickness));t.beginPath(),t.moveTo(g.x,g.y),t.lineTo(S.x,S.y),t.lineTo(L.x,L.y),t.lineTo(E.x,E.y);let I=this.ctx.createRadialGradient(h.x,h.y,this.opts.bondLength,h.x,h.y,0);I.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),I.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),t.fillStyle=I,t.fill(),t.restore()}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let r=this.ctx,t=this.offsetX,i=this.offsetY,s=e.getLeftVector().clone(),l=e.getRightVector().clone();s.x+=t,s.y+=i,l.x+=t,l.y+=i,r.save();let n=T.normals(s,l);n[0].normalize(),n[1].normalize();let h=e.getRightChiral(),f,c,d,b,g=e.clone();h?(f=l,c=s,g.shortenRight(1),d=g.getRightVector().clone(),b=g.getLeftVector().clone()):(f=s,c=l,g.shortenLeft(1),d=g.getLeftVector().clone(),b=g.getRightVector().clone()),d.x+=t,d.y+=i,b.x+=t,b.y+=i;let S=T.subtract(c,f).normalize();r.strokeStyle=this.themeManager.getColor("C"),r.lineCap="round",r.lineWidth=this.opts.bondThickness,r.beginPath();let L=e.getLength(),E=1.25/(L/(this.opts.bondThickness*3)),I=!1;for(let F=0;F<1;F+=E){let B=T.multiplyScalar(S,F*L),A=T.add(f,B),O=1.5*F,W=T.multiplyScalar(n[0],O);!I&&F>.5&&(r.stroke(),r.beginPath(),r.strokeStyle=this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C"),I=!0),A.subtract(W),r.moveTo(A.x,A.y),A.add(T.multiplyScalar(W,2)),r.lineTo(A.x,A.y)}r.stroke(),r.restore()}drawDebugText(e,r,t){let i=this.ctx;i.save(),i.font="5px Droid Sans, sans-serif",i.textAlign="start",i.textBaseline="top",i.fillStyle="#ff0000",i.fillText(t,e+this.offsetX,r+this.offsetY),i.restore()}drawBall(e,r,t){let i=this.ctx;i.save(),i.beginPath(),i.arc(e+this.offsetX,r+this.offsetY,this.opts.bondLength/4.5,0,re.twoPI,!1),i.fillStyle=this.themeManager.getColor(t),i.fill(),i.restore()}drawPoint(e,r,t){let i=this.ctx,s=this.offsetX,l=this.offsetY;i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(e+s,r+l,1.5,0,re.twoPI,!0),i.closePath(),i.fill(),i.globalCompositeOperation="source-over",i.beginPath(),i.arc(e+this.offsetX,r+this.offsetY,.75,0,re.twoPI,!1),i.fillStyle=this.themeManager.getColor(t),i.fill(),i.restore()}drawText(e,r,t,i,s,l,n,h,f,c={}){let d=this.ctx,b=this.offsetX,g=this.offsetY;d.save(),d.textAlign="start",d.textBaseline="alphabetic";let S=!1,L="",E=0;n&&(L=jn(n),d.font=this.fontSmall,E=d.measureText(L).width);let I="0",F=0;h>0&&(I=h.toString(),d.font=this.fontSmall,F=d.measureText(I).width),n===1&&t==="N"&&"0O"in c&&"0O-1"in c&&(c={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0),d.font=this.fontLarge,d.fillStyle=this.themeManager.getColor("BACKGROUND");let B=d.measureText(t),A=B.width>this.opts.fontSizeLarge?B.width:this.opts.fontSizeLarge;A/=1.5,d.globalCompositeOperation="destination-out",d.beginPath(),d.arc(e+b,r+g,A,0,re.twoPI,!0),d.closePath(),d.fill(),d.globalCompositeOperation="source-over";let O=-B.width/2,W=-B.width/2;d.fillStyle=this.themeManager.getColor(t),d.fillText(t,e+b+O,r+this.opts.halfFontSizeLarge+g),O+=B.width,n&&(d.font=this.fontSmall,d.fillText(L,e+b+O,r-this.opts.fifthFontSizeSmall+g),O+=E),h>0&&(d.font=this.fontSmall,d.fillText(I,e+b+W-F,r-this.opts.fifthFontSizeSmall+g),W-=F),d.font=this.fontLarge;let J=0,le=0;if(i===1){let ne=e+b,Se=r+g+this.opts.halfFontSizeLarge;J=this.hydrogenWidth,W-=J,s==="left"?ne+=W:s==="right"||s==="up"&&l||s==="down"&&l?ne+=O:s==="up"&&!l?(Se-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ne-=this.halfHydrogenWidth):s==="down"&&!l&&(Se+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ne-=this.halfHydrogenWidth),d.fillText("H",ne,Se),O+=J}else if(i>1){let ne=e+b,Se=r+g+this.opts.halfFontSizeLarge;J=this.hydrogenWidth,d.font=this.fontSmall,le=d.measureText(i.toString()).width,W-=J+le,s==="left"?ne+=W:s==="right"||s==="up"&&l||s==="down"&&l?ne+=O:s==="up"&&!l?(Se-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ne-=this.halfHydrogenWidth):s==="down"&&!l&&(Se+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ne-=this.halfHydrogenWidth),d.font=this.fontLarge,d.fillText("H",ne,Se),d.font=this.fontSmall,d.fillText(i.toString(),ne+this.halfHydrogenWidth+le,Se+this.opts.fifthFontSizeSmall),O+=J+this.halfHydrogenWidth+le}if(S){d.restore();return}for(let ne of Object.keys(c)){let Se=0,Ke=0,st=c[ne].element,Te=c[ne].count,Ae=c[ne].hydrogenCount,Ye=c[ne].charge;d.font=this.fontLarge,Te>1&&Ae>0&&(Se=d.measureText("(").width,Ke=d.measureText(")").width);let He=d.measureText(st).width,at=0,je="",U=0;J=0,Ae>0&&(J=this.hydrogenWidth),d.font=this.fontSmall,Te>1&&(at=d.measureText(Te).width),Ye!==0&&(je=jn(Ye),U=d.measureText(je).width),le=0,Ae>1&&(le=d.measureText(Ae).width),d.font=this.fontLarge;let se=e+b,ve=r+g+this.opts.halfFontSizeLarge;d.fillStyle=this.themeManager.getColor(st),Te>0&&(W-=at),Te>1&&Ae>0&&(s==="left"?(W-=Ke,d.fillText(")",se+W,ve)):(d.fillText("(",se+O,ve),O+=Se)),s==="left"?(W-=He,d.fillText(st,se+W,ve)):(d.fillText(st,se+O,ve),O+=He),Ae>0&&(s==="left"?(W-=J+le,d.fillText("H",se+W,ve),Ae>1&&(d.font=this.fontSmall,d.fillText(Ae,se+W+J,ve+this.opts.fifthFontSizeSmall))):(d.fillText("H",se+O,ve),O+=J,Ae>1&&(d.font=this.fontSmall,d.fillText(Ae,se+O,ve+this.opts.fifthFontSizeSmall),O+=le))),d.font=this.fontLarge,Te>1&&Ae>0&&(s==="left"?(W-=Se,d.fillText("(",se+W,ve)):(d.fillText(")",se+O,ve),O+=Ke)),d.font=this.fontSmall,Te>1&&(s==="left"?d.fillText(Te,se+W+Se+Ke+J+le+He,ve+this.opts.fifthFontSizeSmall):(d.fillText(Te,se+O,ve+this.opts.fifthFontSizeSmall),O+=at)),Ye!==0&&(s==="left"?d.fillText(je,se+W+Se+Ke+J+le+He,r-this.opts.fifthFontSizeSmall+g):(d.fillText(je,se+O,r-this.opts.fifthFontSizeSmall+g),O+=U))}d.restore()}drawDebugPoint(e,r,t="",i="#f00"){this.drawCircle(e,r,2,i,!0,!0,t)}drawAromaticityRing(e){let r=this.ctx,t=re.apothemFromSideLength(this.opts.bondLength,e.getSize());r.save(),r.strokeStyle=this.themeManager.getColor("C"),r.lineWidth=this.opts.bondThickness,r.beginPath(),r.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,t-this.opts.bondSpacing,0,Math.PI*2,!0),r.closePath(),r.stroke(),r.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}};var Tt=class k{constructor(e,r,t=1){this.id=null,this.sourceId=e,this.targetId=r,this.weight=t,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(e){this.bondType=e,this.weight=k.bonds[e]}static get bonds(){return{".":0,"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}};var Ct=class k{constructor(e,r=!1){this.vertices=[],this.edges=[],this.atomIdxToVertexId=[],this.vertexIdsToEdgeId={},this.isomeric=r,this._atomIdx=0,this._time=0,this._init(e)}_init(e,r=0,t=null,i=!1){let s=e.atom.element?e.atom.element:e.atom,l=new Ue(s,e.bond);(s!=="H"||!e.hasNext&&t===null)&&(l.idx=this._atomIdx,this._atomIdx++),l.branchBond=e.branchBond,l.ringbonds=e.ringbonds,l.bracket=e.atom.element?e.atom:null,l.class=e.atom.class;let n=new lr(l),h=this.vertices[t];if(this.addVertex(n),l.idx!==null&&this.atomIdxToVertexId.push(n.id),t!==null){n.setParentVertexId(t),n.value.addNeighbouringElement(h.value.element),h.addChild(n.id),h.value.addNeighbouringElement(l.element),h.spanningTreeChildren.push(n.id);let d=new Tt(t,n.id,1);i?d.setBondType(n.value.branchBond||"-"):d.setBondType(h.value.bondType||"-"),this.addEdge(d)}let f=e.ringbondCount+1;l.bracket&&(f+=l.bracket.hcount);let c=0;if(l.bracket&&l.bracket.chirality){l.isStereoCenter=!0,c=l.bracket.hcount;for(let d=0;d<c;d++)this._init({atom:"H",isBracket:"false",branches:[],branchCount:0,ringbonds:[],ringbondCount:!1,next:null,hasNext:!1,bond:"-"},d,n.id,!0)}for(let d=0;d<e.branchCount;d++)this._init(e.branches[d],d+f,n.id,!0);e.hasNext&&this._init(e.next,e.branchCount+f,n.id)}clear(){this.vertices=[],this.edges=[],this.vertexIdsToEdgeId={}}addVertex(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}addEdge(e){let r=this.vertices[e.sourceId],t=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=r.value.isPartOfAromaticRing&&t.value.isPartOfAromaticRing,r.value.bondCount+=e.weight,t.value.bondCount+=e.weight,r.edges.push(e.id),t.edges.push(e.id),e.id}getEdge(e,r){let t=this.vertexIdsToEdgeId[e+"_"+r];return t===void 0?null:this.edges[t]}getEdges(e){let r=[],t=this.vertices[e];for(let i=0;i<t.neighbours.length;i++)r.push(this.vertexIdsToEdgeId[e+"_"+t.neighbours[i]]);return r}hasEdge(e,r){return this.vertexIdsToEdgeId[e+"_"+r]!==void 0}getVertexList(){let e=[this.vertices.length];for(let r=0;r<this.vertices.length;r++)e[r]=this.vertices[r].id;return e}getEdgeList(){let e=Array(this.edges.length);for(let r=0;r<this.edges.length;r++)e[r]=[this.edges[r].sourceId,this.edges[r].targetId];return e}getAdjacencyMatrix(){let e=this.vertices.length,r=Array(e);for(let t=0;t<e;t++)r[t]=new Array(e),r[t].fill(0);for(let t=0;t<this.edges.length;t++){let i=this.edges[t];r[i.sourceId][i.targetId]=1,r[i.targetId][i.sourceId]=1}return r}getComponentsAdjacencyMatrix(){let e=this.vertices.length,r=Array(e),t=this.getBridges();for(let i=0;i<e;i++)r[i]=new Array(e),r[i].fill(0);for(let i=0;i<this.edges.length;i++){let s=this.edges[i];r[s.sourceId][s.targetId]=1,r[s.targetId][s.sourceId]=1}for(let i=0;i<t.length;i++)r[t[i][0]][t[i][1]]=0,r[t[i][1]][t[i][0]]=0;return r}getSubgraphAdjacencyMatrix(e){let r=e.length,t=Array(r);for(let i=0;i<r;i++){t[i]=new Array(r),t[i].fill(0);for(let s=0;s<r;s++)i!==s&&this.hasEdge(e[i],e[s])&&(t[i][s]=1)}return t}getDistanceMatrix(){let e=this.vertices.length,r=this.getAdjacencyMatrix(),t=Array(e);for(let i=0;i<e;i++)t[i]=Array(e),t[i].fill(1/0);for(let i=0;i<e;i++)for(let s=0;s<e;s++)r[i][s]===1&&(t[i][s]=1);for(let i=0;i<e;i++)for(let s=0;s<e;s++)for(let l=0;l<e;l++)t[s][l]>t[s][i]+t[i][l]&&(t[s][l]=t[s][i]+t[i][l]);return t}getSubgraphDistanceMatrix(e){let r=e.length,t=this.getSubgraphAdjacencyMatrix(e),i=Array(r);for(let s=0;s<r;s++)i[s]=Array(r),i[s].fill(1/0);for(let s=0;s<r;s++)for(let l=0;l<r;l++)t[s][l]===1&&(i[s][l]=1);for(let s=0;s<r;s++)for(let l=0;l<r;l++)for(let n=0;n<r;n++)i[l][n]>i[l][s]+i[s][n]&&(i[l][n]=i[l][s]+i[s][n]);return i}getAdjacencyList(){let e=this.vertices.length,r=Array(e);for(let t=0;t<e;t++){r[t]=[];for(let i=0;i<e;i++)t!==i&&this.hasEdge(this.vertices[t].id,this.vertices[i].id)&&r[t].push(i)}return r}getSubgraphAdjacencyList(e){let r=e.length,t=Array(r);for(let i=0;i<r;i++){t[i]=[];for(let s=0;s<r;s++)i!==s&&this.hasEdge(e[i],e[s])&&t[i].push(s)}return t}getBridges(){let e=this.vertices.length,r=new Array(e),t=new Array(e),i=new Array(e),s=new Array(e),l=this.getAdjacencyList(),n=[];r.fill(!1),s.fill(null),this._time=0;for(let h=0;h<e;h++)r[h]||this._bridgeDfs(h,r,t,i,s,l,n);return n}traverseBF(e,r){let t=this.vertices.length,i=new Array(t);i.fill(!1);let s=[e];for(;s.length>0;){let l=s.shift(),n=this.vertices[l];r(n);for(let h=0;h<n.neighbours.length;h++){let f=n.neighbours[h];i[f]||(i[f]=!0,s.push(f))}}}getTreeDepth(e,r){if(e===null||r===null)return 0;let t=this.vertices[e].getSpanningTreeNeighbours(r),i=0;for(let s=0;s<t.length;s++){let l=t[s],n=this.getTreeDepth(l,e);n>i&&(i=n)}return i+1}traverseTree(e,r,t,i=999999,s=!1,l=1,n=null){if(n===null&&(n=new Uint8Array(this.vertices.length)),l>i+1||n[e]===1)return;n[e]=1;let h=this.vertices[e],f=h.getNeighbours(r);(!s||l>1)&&t(h);for(let c=0;c<f.length;c++)this.traverseTree(f[c],e,t,i,s,l+1,n)}kkLayout(e,r,t,i,s,l=.1,n=.1,h=2e3,f=50,c=1e9){let d=s,b=this.getSubgraphDistanceMatrix(e),g=e.length,S=re.polyCircumradius(500,g),L=re.centralAngle(g),E=0,I=new Float32Array(g),F=new Float32Array(g),B=Array(g);for(var A=g;A--;){let U=this.vertices[e[A]];U.positioned?(I[A]=U.position.x,F[A]=U.position.y):(I[A]=r.x+Math.cos(E)*S,F[A]=r.y+Math.sin(E)*S),B[A]=U.positioned,E+=L}let O=Array(g);for(A=g;A--;){O[A]=new Array(g);let U=g;for(;U--;)O[A][U]=s*b[A][U]}let W=Array(g);for(A=g;A--;){W[A]=Array(g);let U=g;for(;U--;)W[A][U]=d*Math.pow(b[A][U],-2)}let J=Array(g),le=new Float32Array(g),ne=new Float32Array(g);for(A=g;A--;)J[A]=Array(g);for(A=g;A--;){let U=I[A],se=F[A],ve=0,Re=0,we=g;for(;we--;){if(A===we)continue;let $e=I[we],xe=F[we],Le=1/Math.sqrt((U-$e)*(U-$e)+(se-xe)*(se-xe));J[A][we]=[W[A][we]*(U-$e-O[A][we]*(U-$e)*Le),W[A][we]*(se-xe-O[A][we]*(se-xe)*Le)],J[we][A]=J[A][we],ve+=J[A][we][0],Re+=J[A][we][1]}le[A]=ve,ne[A]=Re}let Se=function(U){return[le[U]*le[U]+ne[U]*ne[U],le[U],ne[U]]},Ke=function(){let U=0,se=0,ve=0,Re=0;for(A=g;A--;){let[we,$e,xe]=Se(A);we>U&&B[A]===!1&&(U=we,se=A,ve=$e,Re=xe)}return[se,U,ve,Re]},st=function(U,se,ve){let Re=0,we=0,$e=0,xe=I[U],Le=F[U],vt=O[U],xt=W[U];for(A=g;A--;){if(A===U)continue;let Pe=I[A],De=F[A],ht=vt[A],ft=xt[A],Me=(xe-Pe)*(xe-Pe),_e=1/Math.pow(Me+(Le-De)*(Le-De),1.5);Re+=ft*(1-ht*(Le-De)*(Le-De)*_e),we+=ft*(1-ht*Me*_e),$e+=ft*(ht*(xe-Pe)*(Le-De)*_e)}Re===0&&(Re=.1),we===0&&(we=.1),$e===0&&($e=.1);let Je=se/Re+ve/$e;Je/=$e/Re-we/$e;let ot=-($e*Je+se)/Re;I[U]+=ot,F[U]+=Je;let Nt=J[U];for(se=0,ve=0,xe=I[U],Le=F[U],A=g;A--;){if(U===A)continue;let Pe=I[A],De=F[A],ht=Nt[A][0],ft=Nt[A][1],Me=1/Math.sqrt((xe-Pe)*(xe-Pe)+(Le-De)*(Le-De));ot=xt[A]*(xe-Pe-vt[A]*(xe-Pe)*Me),Je=xt[A]*(Le-De-vt[A]*(Le-De)*Me),Nt[A]=[ot,Je],se+=ot,ve+=Je,le[A]+=ot-ht,ne[A]+=Je-ft}le[U]=se,ne[U]=ve},Te=0,Ae=0,Ye=0,He=0,at=0,je=0;for(;c>l&&h>at;)for(at++,[Te,c,Ae,Ye]=Ke(),He=c,je=0;He>n&&f>je;)je++,st(Te,Ae,Ye),[He,Ae,Ye]=Se(Te);for(A=g;A--;){let U=e[A],se=this.vertices[U];se.position.x=I[A],se.position.y=F[A],se.positioned=!0,se.forcePositioned=!0}}_bridgeDfs(e,r,t,i,s,l,n){r[e]=!0,t[e]=i[e]=++this._time;for(let h=0;h<l[e].length;h++){let f=l[e][h];r[f]?f!==s[e]&&(i[e]=Math.min(i[e],t[f])):(s[f]=e,this._bridgeDfs(f,r,t,i,s,l,n),i[e]=Math.min(i[e],i[f]),i[f]>t[e]&&n.push([e,f]))}}static getConnectedComponents(e){let r=e.length,t=new Array(r),i=[];t.fill(!1);for(let s=0;s<r;s++)if(!t[s]){let l=[];t[s]=!0,l.push(s),k._ccGetDfs(s,t,e,l),l.length>1&&i.push(l)}return i}static getConnectedComponentCount(e){let r=e.length,t=new Array(r),i=0;t.fill(!1);for(let s=0;s<r;s++)t[s]||(t[s]=!0,i++,k._ccCountDfs(s,t,e));return i}static _ccCountDfs(e,r,t){for(let i=0;i<t[e].length;i++)!t[e][i]||r[i]||e===i||(r[i]=!0,k._ccCountDfs(i,r,t))}static _ccGetDfs(e,r,t,i){for(let s=0;s<t[e].length;s++)!t[e][s]||r[s]||e===s||(r[s]=!0,i.push(s),k._ccGetDfs(s,r,t,i))}};var dt=class k{static extend(){let e={},r=!1,t=0,i=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(r=arguments[0],t++);let s=function(l){for(let n in l)Object.prototype.hasOwnProperty.call(l,n)&&(r&&Object.prototype.toString.call(l[n])==="[object Object]"?e[n]=k.extend(!0,e[n],l[n]):e[n]=l[n])};for(;t<i;t++){let l=arguments[t];s(l)}return e}};var hr=class k{static getRings(e,r=!1){let t=e.getComponentsAdjacencyMatrix();if(t.length===0)return null;let i=Ct.getConnectedComponents(t),s=[];for(let l=0;l<i.length;l++){let n=i[l],h=e.getSubgraphAdjacencyMatrix([...n]),f=new Uint16Array(h.length),c=new Uint16Array(h.length);for(let B=0;B<h.length;B++){c[B]=0,f[B]=0;for(let A=0;A<h[B].length;A++)f[B]+=h[B][A]}let d=0;for(let B=0;B<h.length;B++)for(let A=B+1;A<h.length;A++)d+=h[B][A];let b=d-h.length+1,g=!0;for(let B=0;B<f.length;B++)f[B]!==3&&(g=!1);if(g&&(b=2+d-h.length),b===1){s.push([...n]);continue}r&&(b=999);let{d:S,pe:L,pe_prime:E}=k.getPathIncludedDistanceMatrices(h),I=k.getRingCandidates(S,L,E),F=k.getSSSR(I,S,h,L,E,f,c,b);for(let B=0;B<F.length;B++){let A=Array(F[B].size),O=0;for(let W of F[B])A[O++]=n[W];s.push(A)}}return s}static matrixToString(e){let r="";for(let t=0;t<e.length;t++){for(let i=0;i<e[t].length;i++)r+=e[t][i]+" ";r+=`
`}return r}static getPathIncludedDistanceMatrices(e){let r=e.length,t=Array(r),i=Array(r),s=Array(r);var l=0,n=0,h=0,f=0,c=0,d=0;for(l=r;l--;)for(t[l]=Array(r),i[l]=Array(r),s[l]=Array(r),n=r;n--;)t[l][n]=l===n||e[l][n]===1?e[l][n]:Number.POSITIVE_INFINITY,t[l][n]===1?i[l][n]=[[[l,n]]]:i[l][n]=[],s[l][n]=[];for(h=r;h--;)for(l=r;l--;)for(n=r;n--;){let b=t[l][n],g=t[l][h]+t[h][n];if(b>g){if(b===g+1)for(s[l][n]=[i[l][n].length],f=i[l][n].length;f--;)for(s[l][n][f]=[i[l][n][f].length],c=i[l][n][f].length;c--;)for(s[l][n][f][c]=[i[l][n][f][c].length],d=i[l][n][f][c].length;d--;)s[l][n][f][c][d]=[i[l][n][f][c][0],i[l][n][f][c][1]];else s[l][n]=[];for(t[l][n]=g,i[l][n]=[[]],f=i[l][h][0].length;f--;)i[l][n][0].push(i[l][h][0][f]);for(f=i[h][n][0].length;f--;)i[l][n][0].push(i[h][n][0][f])}else if(b===g){if(i[l][h].length&&i[h][n].length)if(i[l][n].length){let S=[];for(f=i[l][h][0].length;f--;)S.push(i[l][h][0][f]);for(f=i[h][n][0].length;f--;)S.push(i[h][n][0][f]);i[l][n].push(S)}else{let S=[];for(f=i[l][h][0].length;f--;)S.push(i[l][h][0][f]);for(f=i[h][n][0].length;f--;)S.push(i[h][n][0][f]);i[l][n][0]=S}}else if(b===g-1)if(s[l][n].length){let S=[];for(f=i[l][h][0].length;f--;)S.push(i[l][h][0][f]);for(f=i[h][n][0].length;f--;)S.push(i[h][n][0][f]);s[l][n].push(S)}else{let S=[];for(f=i[l][h][0].length;f--;)S.push(i[l][h][0][f]);for(f=i[h][n][0].length;f--;)S.push(i[h][n][0][f]);s[l][n][0]=S}}return{d:t,pe:i,pe_prime:s}}static getRingCandidates(e,r,t){let i=e.length,s=[],l=0;for(let n=0;n<i;n++)for(let h=0;h<i;h++)e[n][h]===0||r[n][h].length===1&&t[n][h]===0||(t[n][h].length!==0?l=2*(e[n][h]+.5):l=2*e[n][h],l!==1/0&&s.push([l,r[n][h],t[n][h]]));return s.sort(function(n,h){return n[0]-h[0]}),s}static getSSSR(e,r,t,i,s,l,n,h){let f=[],c=[];for(let d=0;d<e.length;d++)if(e[d][0]%2!==0)for(let b=0;b<e[d][2].length;b++){let g=e[d][1][0].concat(e[d][2][b]);for(let L=0;L<g.length;L++)g[L][0].constructor===Array&&(g[L]=g[L][0]);let S=k.bondsToAtoms(g);if(k.getBondCount(S,t)===S.size&&!k.pathSetsContain(f,S,g,c,l,n)&&(f.push(S),c=c.concat(g)),f.length>h)return f}else for(let b=0;b<e[d][1].length-1;b++){let g=e[d][1][b].concat(e[d][1][b+1]);for(let L=0;L<g.length;L++)g[L][0].constructor===Array&&(g[L]=g[L][0]);let S=k.bondsToAtoms(g);if(k.getBondCount(S,t)===S.size&&!k.pathSetsContain(f,S,g,c,l,n)&&(f.push(S),c=c.concat(g)),f.length>h)return f}return f}static getEdgeCount(e){let r=0,t=e.length;for(var i=t-1;i--;)for(var s=t;s--;)e[i][s]===1&&r++;return r}static getEdgeList(e){let r=e.length,t=[];for(var i=r-1;i--;)for(var s=r;s--;)e[i][s]===1&&t.push([i,s]);return t}static bondsToAtoms(e){let r=new Set;for(var t=e.length;t--;)r.add(e[t][0]),r.add(e[t][1]);return r}static getBondCount(e,r){let t=0;for(let i of e)for(let s of e)i!==s&&(t+=r[i][s]);return t/2}static pathSetsContain(e,r,t,i,s,l){for(var n=e.length;n--;){if(k.isSupersetOf(r,e[n]))return!0;if(e[n].size===r.size&&k.areSetsEqual(e[n],r))return!0}let h=0,f=!1;for(n=t.length;n--;)for(var c=i.length;c--;)(t[n][0]===i[c][0]&&t[n][1]===i[c][1]||t[n][1]===i[c][0]&&t[n][0]===i[c][1])&&h++,h===t.length&&(f=!0);let d=!1;if(f){for(let b of r)if(l[b]<s[b]){d=!0;break}}if(f&&!d)return!0;for(let b of r)l[b]++;return!1}static areSetsEqual(e,r){if(e.size!==r.size)return!1;for(let t of e)if(!r.has(t))return!1;return!0}static isSupersetOf(e,r){for(let t of r)if(!e.has(t))return!1;return!0}};var fr=class{constructor(e){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,scale:0,bondThickness:1,bondLength:30,shortBondLength:.8,bondSpacing:.17*30,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontFamily:"Arial, Helvetica, sans-serif",fontSizeLarge:11,fontSizeSmall:3,padding:10,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,weights:{colormap:null,additionalPadding:20,sigma:10,interval:0,opacity:1},themes:{dark:{C:"#ffffff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#aaaaaa",BACKGROUND:"#141414"},light:{C:"#222222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666666",BACKGROUND:"#ffffff"},oldschool:{C:"#000000",O:"#000000",N:"#000000",F:"#000000",CL:"#000000",BR:"#000000",I:"#000000",P:"#000000",S:"#000000",B:"#000000",SI:"#000000",H:"#000000",BACKGROUND:"#ffffff"},solarized:{C:"#586e75",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#657b83",BACKGROUND:"#eee8d5"},"solarized-dark":{C:"#93a1a1",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#839496",BACKGROUND:"#073642"},matrix:{C:"#678c61",O:"#2fc079",N:"#4f7e7e",F:"#90d762",CL:"#82d967",BR:"#23755a",I:"#409931",P:"#c1ff8a",S:"#faff00",B:"#50b45a",SI:"#409931",H:"#426644",BACKGROUND:"#ffffff"},github:{C:"#24292f",O:"#cf222e",N:"#0969da",F:"#2da44e",CL:"#6fdd8b",BR:"#bc4c00",I:"#8250df",P:"#bf3989",S:"#d4a72c",B:"#fb8f44",SI:"#bc4c00",H:"#57606a",BACKGROUND:"#ffffff"},carbon:{C:"#161616",O:"#da1e28",N:"#0f62fe",F:"#198038",CL:"#007d79",BR:"#fa4d56",I:"#8a3ffc",P:"#ff832b",S:"#f1c21b",B:"#8a3800",SI:"#e67e22",H:"#525252",BACKGROUND:"#ffffff"},cyberpunk:{C:"#ea00d9",O:"#ff3131",N:"#0abdc6",F:"#00ff9f",CL:"#00fe00",BR:"#fe9f20",I:"#ff00ff",P:"#fe7f00",S:"#fcee0c",B:"#ff00ff",SI:"#ffffff",H:"#913cb1",BACKGROUND:"#ffffff"},gruvbox:{C:"#665c54",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#79740e",BR:"#d65d0e",I:"#b16286",P:"#af3a03",S:"#d79921",B:"#689d6a",SI:"#427b58",H:"#7c6f64",BACKGROUND:"#fbf1c7"},"gruvbox-dark":{C:"#ebdbb2",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#b8bb26",BR:"#d65d0e",I:"#b16286",P:"#fe8019",S:"#d79921",B:"#8ec07c",SI:"#83a598",H:"#bdae93",BACKGROUND:"#282828"},custom:{C:"#222222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666666",BACKGROUND:"#ffffff"}}},this.opts=dt.extend(!0,this.defaultOptions,e),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}draw(e,r,t="light",i=!1){this.initDraw(e,t,i),this.infoOnly||(this.themeManager=new ct(this.opts.themes,t),this.canvasWrapper=new or(r,this.themeManager,this.opts)),i||(this.processGraph(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&console.debug("DrawerBase::draw()",{graph:this.graph,rings:this.rings,ringConnections:this.ringConnections}))}edgeRingCount(e){let r=this.graph.edges[e],t=this.graph.vertices[r.sourceId],i=this.graph.vertices[r.targetId];return Math.min(t.value.rings.length,i.value.rings.length)}getBridgedRings(){return this.rings.filter(e=>e.isBridged)}getFusedRings(){return this.rings.filter(e=>e.isFused)}getSpiros(){return this.rings.filter(e=>e.isSpiro)}printRingInfo(){let e="";for(let r=0;r<this.rings.length;r++){let t=this.rings[r];e+=t.id+";",e+=t.members.length+";",e+=t.neighbours.length+";",e+=t.isSpiro?"true;":"false;",e+=t.isFused?"true;":"false;",e+=t.isBridged?"true;":"false;",e+=t.rings.length+";",e+=`
`}return e}rotateDrawing(){let e=0,r=0,t=0;for(let s=0;s<this.graph.vertices.length;s++){let l=this.graph.vertices[s];if(l.value.isDrawn)for(let n=s+1;n<this.graph.vertices.length;n++){let h=this.graph.vertices[n];if(!h.value.isDrawn)continue;let f=l.position.distanceSq(h.position);f>t&&(t=f,e=s,r=n)}}let i=-T.subtract(this.graph.vertices[e].position,this.graph.vertices[r].position).angle();if(!isNaN(i)){let s=i%.523599;s<.2617995?i=i-s:i+=.523599-s;for(let l=0;l<this.graph.vertices.length;l++)l!==r&&this.graph.vertices[l].position.rotateAround(i,this.graph.vertices[r].position);for(let l=0;l<this.rings.length;l++)this.rings[l].center.rotateAround(i,this.graph.vertices[r].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let e=0;for(let r=0;r<this.graph.vertices.length;r++)this.graph.vertices[r].value.element!=="H"&&e++;return e}getMolecularFormula(e=null){let r="",t=new Map,i=e===null?this.graph:new Ct(e,this.opts.isomeric);for(let l=0;l<i.vertices.length;l++){let n=i.vertices[l].value;if(t.has(n.element)?t.set(n.element,t.get(n.element)+1):t.set(n.element,1),n.bracket&&!n.bracket.chirality&&(t.has("H")?t.set("H",t.get("H")+n.bracket.hcount):t.set("H",n.bracket.hcount)),!n.bracket){let h=Ue.maxBonds[n.element]-n.bondCount;n.isPartOfAromaticRing&&h--,t.has("H")?t.set("H",t.get("H")+h):t.set("H",h)}}if(t.has("C")){let l=t.get("C");r+="C"+(l>1?l:""),t.delete("C")}if(t.has("H")){let l=t.get("H");r+="H"+(l>1?l:""),t.delete("H")}return Object.keys(Ue.atomicNumbers).sort().map(l=>{if(t.has(l)){let n=t.get(l);r+=l+(n>1?n:"")}}),r}getRingbondType(e,r){if(e.value.getRingbondCount()<1||r.value.getRingbondCount()<1)return null;for(let t=0;t<e.value.ringbonds.length;t++)for(let i=0;i<r.value.ringbonds.length;i++)if(e.value.ringbonds[t].id===r.value.ringbonds[i].id)return e.value.ringbonds[t].bondType==="-"?r.value.ringbonds[i].bond:e.value.ringbonds[t].bond;return null}initDraw(e,r,t,i){this.data=e,this.infoOnly=t,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new Ct(e,this.opts.isomeric),this.rings=[],this.ringConnections=[],this.originalRings=[],this.originalRingConnections=[],this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.highlight_atoms=i,this.initRings(),this.initHydrogens()}processGraph(){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(let r=0;r<this.opts.overlapResolutionIterations;r++)for(let t=0;t<this.graph.edges.length;t++){let i=this.graph.edges[t];if(this.isEdgeRotatable(i)){let s=this.graph.getTreeDepth(i.sourceId,i.targetId),l=this.graph.getTreeDepth(i.targetId,i.sourceId),n=i.targetId,h=i.sourceId;if(s>l&&(n=i.sourceId,h=i.targetId),this.getSubtreeOverlapScore(h,n,e.vertexScores).value>this.opts.overlapSensitivity){let c=this.graph.vertices[n],d=this.graph.vertices[h],b=d.getNeighbours(n);if(b.length===1){let g=this.graph.vertices[b[0]],S=g.position.getRotateAwayFromAngle(c.position,d.position,re.toRad(120));this.rotateSubtree(g.id,d.id,S,d.position);let L=this.getOverlapScore().total;L>this.totalOverlapScore?this.rotateSubtree(g.id,d.id,-S,d.position):this.totalOverlapScore=L}else if(b.length===2){if(d.value.rings.length!==0&&c.value.rings.length!==0)continue;let g=this.graph.vertices[b[0]],S=this.graph.vertices[b[1]];if(g.value.rings.length===1&&S.value.rings.length===1){if(g.value.rings[0]!==S.value.rings[0])continue}else{if(g.value.rings.length!==0||S.value.rings.length!==0)continue;{let L=g.position.getRotateAwayFromAngle(c.position,d.position,re.toRad(120)),E=S.position.getRotateAwayFromAngle(c.position,d.position,re.toRad(120));this.rotateSubtree(g.id,d.id,L,d.position),this.rotateSubtree(S.id,d.id,E,d.position);let I=this.getOverlapScore().total;I>this.totalOverlapScore?(this.rotateSubtree(g.id,d.id,-L,d.position),this.rotateSubtree(S.id,d.id,-E,d.position)):this.totalOverlapScore=I}}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&this.opts.atomVisualization==="default"&&this.initPseudoElements(),this.rotateDrawing()}initRings(){let e=new Map;for(let t=this.graph.vertices.length-1;t>=0;t--){let i=this.graph.vertices[t];if(i.value.ringbonds.length!==0)for(let s=0;s<i.value.ringbonds.length;s++){let l=i.value.ringbonds[s].id,n=i.value.ringbonds[s].bond;if(!e.has(l))e.set(l,[i.id,n]);else{let h=i.id,f=e.get(l)[0],c=e.get(l)[1],d=new Tt(h,f,1);d.setBondType(c||n||"-");let b=this.graph.addEdge(d),g=this.graph.vertices[f];i.addRingbondChild(f,s),i.value.addNeighbouringElement(g.value.element),g.addRingbondChild(h,s),g.value.addNeighbouringElement(i.value.element),i.edges.push(b),g.edges.push(b),e.delete(l)}}}let r=hr.getRings(this.graph,this.opts.experimentalSSSR);if(r!==null){for(let t=0;t<r.length;t++){let i=[...r[t]],s=this.addRing(new Vt(i));for(let l=0;l<i.length;l++)this.graph.vertices[i[l]].value.rings.push(s)}for(let t=0;t<this.rings.length-1;t++)for(let i=t+1;i<this.rings.length;i++){let s=this.rings[t],l=this.rings[i],n=new lt(s,l);n.vertices.size>0&&this.addRingConnection(n)}for(let t=0;t<this.rings.length;t++){let i=this.rings[t];i.neighbours=lt.getNeighbours(this.ringConnections,i.id)}for(let t=0;t<this.rings.length;t++){let i=this.rings[t];this.graph.vertices[i.members[0]].value.addAnchoredRing(i.id)}for(this.backupRingInformation();this.rings.length>0;){let t=-1;for(let l=0;l<this.rings.length;l++){let n=this.rings[l];this.isPartOfBridgedRing(n.id)&&!n.isBridged&&(t=n.id)}if(t===-1)break;let i=this.getRing(t),s=this.getBridgedRingRings(i.id);this.bridgedRing=!0,this.createBridgedRing(s,i.members[0]),this.bridgedRing=!1;for(let l=0;l<s.length;l++)this.removeRing(s[l])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(let e=0;e<this.graph.vertices.length;e++){let r=this.graph.vertices[e];if(r.value.element!=="H")continue;let t=this.graph.vertices[r.neighbours[0]];t.value.hasHydrogen=!0,(!t.value.isStereoCenter||t.value.rings.length<2&&!t.value.bridgedRing||t.value.bridgedRing&&t.value.originalRings.length<2)&&(r.value.isDrawn=!1)}}getBridgedRingRings(e){let r=[],t=i=>{let s=this.getRing(i);r.push(i);for(let l=0;l<s.neighbours.length;l++){let n=s.neighbours[l];r.indexOf(n)===-1&&n!==i&&lt.isBridge(this.ringConnections,this.graph.vertices,i,n)&&t(n)}};return t(e),pe.unique(r)}isPartOfBridgedRing(e){for(let r=0;r<this.ringConnections.length;r++)if(this.ringConnections[r].containsRing(e)&&this.ringConnections[r].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(e,r){let t=new Set,i=new Set,s=new Set;for(let f=0;f<e.length;f++){let c=this.getRing(e[f]);c.isPartOfBridged=!0;for(let d=0;d<c.members.length;d++)i.add(c.members[d]);for(let d=0;d<c.neighbours.length;d++){let b=c.neighbours[d];e.indexOf(b)===-1&&s.add(c.neighbours[d])}}let l=new Set;for(let f of i){let c=this.graph.vertices[f],d=pe.intersection(e,c.value.rings);c.value.rings.length===1||d.length===1?t.add(c.id):l.add(c.id)}let n=[];for(let f of l){let c=this.graph.vertices[f],d=!1;for(let b=0;b<c.edges.length;b++)this.edgeRingCount(c.edges[b])===1&&(d=!0);d?(c.value.isBridgeNode=!0,t.add(c.id)):(c.value.isBridge=!0,t.add(c.id))}let h=new Vt([...t]);this.addRing(h),h.isBridged=!0,h.neighbours=[...s];for(let f=0;f<e.length;f++)h.rings.push(this.getRing(e[f]).clone());for(let f=0;f<h.members.length;f++)this.graph.vertices[h.members[f]].value.bridgedRing=h.id;for(let f=0;f<n.length;f++){let c=this.graph.vertices[n[f]];c.value.rings=[]}for(let f of t){let c=this.graph.vertices[f];c.value.rings=pe.removeAll(c.value.rings,e),c.value.rings.push(h.id)}for(let f=0;f<e.length;f++)for(let c=f+1;c<e.length;c++)this.removeRingConnectionsBetween(e[f],e[c]);for(let f of s){let c=this.getRingConnections(f,e);for(let d=0;d<c.length;d++)this.getRingConnection(c[d]).updateOther(h.id,f);this.getRing(f).neighbours.push(h.id)}return h}areVerticesInSameRing(e,r){for(let t=0;t<e.value.rings.length;t++)for(let i=0;i<r.value.rings.length;i++)if(e.value.rings[t]===r.value.rings[i])return!0;return!1}getCommonRings(e,r){let t=[];for(let i=0;i<e.value.rings.length;i++)for(let s=0;s<r.value.rings.length;s++)e.value.rings[i]==r.value.rings[s]&&t.push(e.value.rings[i]);return t}getLargestOrAromaticCommonRing(e,r){let t=this.getCommonRings(e,r),i=0,s=null;for(let l=0;l<t.length;l++){let n=this.getRing(t[l]),h=n.getSize();if(n.isBenzeneLike(this.graph.vertices))return n;h>i&&(i=h,s=n)}return s}getVerticesAt(e,r,t){let i=[];for(let s=0;s<this.graph.vertices.length;s++){let l=this.graph.vertices[s];if(l.id===t||!l.positioned)continue;e.distanceSq(l.position)<=r*r&&i.push(l.id)}return i}getClosestVertex(e){let r=99999,t=null;for(let i=0;i<this.graph.vertices.length;i++){let s=this.graph.vertices[i];if(s.id===e.id)continue;let l=e.position.distanceSq(s.position);l<r&&(r=l,t=s)}return t}addRing(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}removeRing(e){this.rings=this.rings.filter(function(r){return r.id!==e}),this.ringConnections=this.ringConnections.filter(function(r){return r.firstRingId!==e&&r.secondRingId!==e});for(let r=0;r<this.rings.length;r++){let t=this.rings[r];t.neighbours=t.neighbours.filter(function(i){return i!==e})}}getRing(e){for(let r=0;r<this.rings.length;r++)if(this.rings[r].id==e)return this.rings[r]}addRingConnection(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}removeRingConnection(e){this.ringConnections=this.ringConnections.filter(function(r){return r.id!==e})}removeRingConnectionsBetween(e,r){let t=[];for(let i=0;i<this.ringConnections.length;i++){let s=this.ringConnections[i];(s.firstRingId===e&&s.secondRingId===r||s.firstRingId===r&&s.secondRingId===e)&&t.push(s.id)}for(let i=0;i<t.length;i++)this.removeRingConnection(t[i])}getRingConnection(e){for(let r=0;r<this.ringConnections.length;r++)if(this.ringConnections[r].id==e)return this.ringConnections[r]}getRingConnections(e,r){let t=[];for(let i=0;i<this.ringConnections.length;i++){let s=this.ringConnections[i];for(let l=0;l<r.length;l++){let n=r[l];(s.firstRingId===e&&s.secondRingId===n||s.firstRingId===n&&s.secondRingId===e)&&t.push(s.id)}}return t}getOverlapScore(){let e=0,r=new Float32Array(this.graph.vertices.length);for(let i=0;i<this.graph.vertices.length;i++)r[i]=0;for(let i=0;i<this.graph.vertices.length;i++){let s=this.graph.vertices.length;for(;--s>i;){let l=this.graph.vertices[i],n=this.graph.vertices[s];if(!l.value.isDrawn||!n.value.isDrawn)continue;let h=T.subtract(l.position,n.position).lengthSq();if(h<this.opts.bondLengthSq){let f=(this.opts.bondLength-Math.sqrt(h))/this.opts.bondLength;e+=f,r[i]+=f,r[s]+=f}}}let t=[];for(let i=0;i<this.graph.vertices.length;i++)t.push({id:i,score:r[i]});return t.sort(function(i,s){return s.score-i.score}),{total:e,scores:t,vertexScores:r}}chooseSide(e,r,t){let i=e.getNeighbours(r.id),s=r.getNeighbours(e.id),l=i.length,n=s.length,h=pe.merge(i,s),f=[0,0];for(let d=0;d<h.length;d++)this.graph.vertices[h[d]].position.sameSideAs(e.position,r.position,t[0])?f[0]++:f[1]++;let c=[0,0];for(let d=0;d<this.graph.vertices.length;d++)this.graph.vertices[d].position.sameSideAs(e.position,r.position,t[0])?c[0]++:c[1]++;return{totalSideCount:c,totalPosition:c[0]>c[1]?0:1,sideCount:f,position:f[0]>f[1]?0:1,anCount:l,bnCount:n}}setRingCenter(e){let r=e.getSize(),t=new T(0,0);for(let i=0;i<r;i++)t.add(this.graph.vertices[e.members[i]].position);e.center=t.divide(r)}getSubringCenter(e,r){let t=r.value.originalRings,i=e.center,s=Number.MAX_VALUE;for(let l=0;l<t.length;l++)for(let n=0;n<e.rings.length;n++)t[l]===e.rings[n].id&&e.rings[n].getSize()<s&&(i=e.rings[n].center,s=e.rings[n].getSize());return i}drawEdges(e){let r=Array(this.graph.edges.length);if(r.fill(!1),this.graph.traverseBF(0,t=>{let i=this.graph.getEdges(t.id);for(let s=0;s<i.length;s++){let l=i[s];r[l]||(r[l]=!0,this.drawEdge(l,e))}}),!this.bridgedRing)for(let t=0;t<this.rings.length;t++){let i=this.rings[t];this.isRingAromatic(i)&&this.canvasWrapper.drawAromaticityRing(i)}}drawEdge(e,r){let t=this.graph.edges[e],i=this.graph.vertices[t.sourceId],s=this.graph.vertices[t.targetId],l=i.value.element,n=s.value.element;if((!i.value.isDrawn||!s.value.isDrawn)&&this.opts.atomVisualization==="default")return;let h=i.position,f=s.position,c=this.getEdgeNormals(t),d=pe.clone(c);if(d[0].multiplyScalar(10).add(h),d[1].multiplyScalar(10).add(h),t.bondType==="="||this.getRingbondType(i,s)==="="||t.isPartOfAromaticRing&&this.bridgedRing){let b=this.areVerticesInSameRing(i,s),g=this.chooseSide(i,s,d);if(b){let L=this.getLargestOrAromaticCommonRing(i,s).center;c[0].multiplyScalar(this.opts.bondSpacing),c[1].multiplyScalar(this.opts.bondSpacing);let E=null;L.sameSideAs(i.position,s.position,T.add(h,c[0]))?E=new Q(T.add(h,c[0]),T.add(f,c[0]),l,n):E=new Q(T.add(h,c[1]),T.add(f,c[1]),l,n),E.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),t.isPartOfAromaticRing?this.canvasWrapper.drawLine(E,!0):this.canvasWrapper.drawLine(E),this.canvasWrapper.drawLine(new Q(h,f,l,n))}else if(t.center||i.isTerminal()&&s.isTerminal()){c[0].multiplyScalar(this.opts.halfBondSpacing),c[1].multiplyScalar(this.opts.halfBondSpacing);let S=new Q(T.add(h,c[0]),T.add(f,c[0]),l,n),L=new Q(T.add(h,c[1]),T.add(f,c[1]),l,n);this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(L)}else if(g.anCount==0&&g.bnCount>1||g.bnCount==0&&g.anCount>1){c[0].multiplyScalar(this.opts.halfBondSpacing),c[1].multiplyScalar(this.opts.halfBondSpacing);let S=new Q(T.add(h,c[0]),T.add(f,c[0]),l,n),L=new Q(T.add(h,c[1]),T.add(f,c[1]),l,n);this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(L)}else if(g.sideCount[0]>g.sideCount[1]){c[0].multiplyScalar(this.opts.bondSpacing),c[1].multiplyScalar(this.opts.bondSpacing);let S=new Q(T.add(h,c[0]),T.add(f,c[0]),l,n);S.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new Q(h,f,l,n))}else if(g.sideCount[0]<g.sideCount[1]){c[0].multiplyScalar(this.opts.bondSpacing),c[1].multiplyScalar(this.opts.bondSpacing);let S=new Q(T.add(h,c[1]),T.add(f,c[1]),l,n);S.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new Q(h,f,l,n))}else if(g.totalSideCount[0]>g.totalSideCount[1]){c[0].multiplyScalar(this.opts.bondSpacing),c[1].multiplyScalar(this.opts.bondSpacing);let S=new Q(T.add(h,c[0]),T.add(f,c[0]),l,n);S.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new Q(h,f,l,n))}else if(g.totalSideCount[0]<=g.totalSideCount[1]){c[0].multiplyScalar(this.opts.bondSpacing),c[1].multiplyScalar(this.opts.bondSpacing);let S=new Q(T.add(h,c[1]),T.add(f,c[1]),l,n);S.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new Q(h,f,l,n))}}else if(t.bondType==="#"){c[0].multiplyScalar(this.opts.bondSpacing/1.5),c[1].multiplyScalar(this.opts.bondSpacing/1.5);let b=new Q(T.add(h,c[0]),T.add(f,c[0]),l,n),g=new Q(T.add(h,c[1]),T.add(f,c[1]),l,n);this.canvasWrapper.drawLine(b),this.canvasWrapper.drawLine(g),this.canvasWrapper.drawLine(new Q(h,f,l,n))}else if(t.bondType!=="."){let b=i.value.isStereoCenter,g=s.value.isStereoCenter;t.wedge==="up"?this.canvasWrapper.drawWedge(new Q(h,f,l,n,b,g)):t.wedge==="down"?this.canvasWrapper.drawDashedWedge(new Q(h,f,l,n,b,g)):this.canvasWrapper.drawLine(new Q(h,f,l,n,b,g))}if(r){let b=T.midpoint(h,f);this.canvasWrapper.drawDebugText(b.x,b.y,"e: "+e)}}drawVertices(e){for(let r=0;r<this.graph.vertices.length;r++){let t=this.graph.vertices[r],i=t.value,s=0,l=0,n=t.value.bondCount,h=i.element,f=Ue.maxBonds[h]-n,c=t.getTextDirection(this.graph.vertices),d=this.opts.terminalCarbons||h!=="C"||i.hasAttachedPseudoElements?t.isTerminal():!1,b=i.element==="C";if(i.element==="N"&&i.isPartOfAromaticRing&&(f=0),i.bracket&&(f=i.bracket.hcount,s=i.bracket.charge,l=i.bracket.isotope),(s||l||this.graph.vertices.length<3)&&(b=!1),this.opts.atomVisualization==="allballs")this.canvasWrapper.drawBall(t.position.x,t.position.y,h);else if(i.isDrawn&&(!b||i.drawExplicit||d||i.hasAttachedPseudoElements)||this.graph.vertices.length===1)this.opts.atomVisualization==="default"?this.canvasWrapper.drawText(t.position.x,t.position.y,h,f,c,d,s,l,this.graph.vertices.length,i.getAttachedPseudoElements()):this.opts.atomVisualization==="balls"&&this.canvasWrapper.drawBall(t.position.x,t.position.y,h);else if(t.getNeighbourCount()===2&&t.forcePositioned==!0){let g=this.graph.vertices[t.neighbours[0]].position,S=this.graph.vertices[t.neighbours[1]].position,L=T.threePointangle(t.position,g,S);Math.abs(Math.PI-L)<.1&&this.canvasWrapper.drawPoint(t.position.x,t.position.y,h)}if(e){let g="v: "+t.id+" "+pe.print(i.ringbonds);this.canvasWrapper.drawDebugText(t.position.x,t.position.y,g)}}if(this.opts.debug)for(let r=0;r<this.rings.length;r++){let t=this.rings[r].center;this.canvasWrapper.drawDebugPoint(t.x,t.y,"r: "+this.rings[r].id)}}position(){let e=null;for(let r=0;r<this.graph.vertices.length;r++)if(this.graph.vertices[r].value.bridgedRing!==null){e=this.graph.vertices[r];break}for(let r=0;r<this.rings.length;r++)this.rings[r].isBridged&&(e=this.graph.vertices[this.rings[r].members[0]]);this.rings.length>0&&e===null&&(e=this.graph.vertices[this.rings[0].members[0]]),e===null&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}backupRingInformation(){this.originalRings=[],this.originalRingConnections=[];for(let e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(let e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(let e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}restoreRingInformation(){let e=this.getBridgedRings();this.rings=[],this.ringConnections=[];for(let r=0;r<e.length;r++){let t=e[r];for(let i=0;i<t.rings.length;i++){let s=t.rings[i];this.originalRings[s.id].center=s.center}}for(let r=0;r<this.originalRings.length;r++)this.rings.push(this.originalRings[r]);for(let r=0;r<this.originalRingConnections.length;r++)this.ringConnections.push(this.originalRingConnections[r]);for(let r=0;r<this.graph.vertices.length;r++)this.graph.vertices[r].value.restoreRings()}createRing(e,r=null,t=null,i=null){if(e.positioned)return;r=r||new T(0,0);let s=e.getOrderedNeighbours(this.ringConnections),l=t?T.subtract(t.position,r).angle():0,n=re.polyCircumradius(this.opts.bondLength,e.getSize()),h=re.centralAngle(e.getSize());e.centralAngle=h;let f=l,c=t?t.id:null;if(e.members.indexOf(c)===-1&&(t&&(t.positioned=!1),c=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),r,t.id,e,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),e.positioned=!0,this.setRingCenter(e),r=e.center;for(let d=0;d<e.rings.length;d++)this.setRingCenter(e.rings[d])}else e.eachMember(this.graph.vertices,d=>{let b=this.graph.vertices[d];b.positioned||b.setPosition(r.x+Math.cos(f)*n,r.y+Math.sin(f)*n),f+=h,(!e.isBridged||e.rings.length<3)&&(b.angle=f,b.positioned=!0)},c,i?i.id:null);e.positioned=!0,e.center=r;for(let d=0;d<s.length;d++){let b=this.getRing(s[d].neighbour);if(b.positioned)continue;let g=lt.getVertices(this.ringConnections,e.id,b.id);if(g.length===2){e.isFused=!0,b.isFused=!0;let S=this.graph.vertices[g[0]],L=this.graph.vertices[g[1]],E=T.midpoint(S.position,L.position),I=T.normals(S.position,L.position);I[0].normalize(),I[1].normalize();let F=re.polyCircumradius(this.opts.bondLength,b.getSize()),B=re.apothem(F,b.getSize());I[0].multiplyScalar(B).add(E),I[1].multiplyScalar(B).add(E);let A=I[0];T.subtract(r,I[1]).lengthSq()>T.subtract(r,I[0]).lengthSq()&&(A=I[1]);let O=T.subtract(S.position,A),W=T.subtract(L.position,A);O.clockwise(W)===-1?b.positioned||this.createRing(b,A,S,L):b.positioned||this.createRing(b,A,L,S)}else if(g.length===1){e.isSpiro=!0,b.isSpiro=!0;let S=this.graph.vertices[g[0]],L=T.subtract(r,S.position);L.invert(),L.normalize();let E=re.polyCircumradius(this.opts.bondLength,b.getSize());L.multiplyScalar(E),L.add(S.position),b.positioned||this.createRing(b,L,S)}}for(let d=0;d<e.members.length;d++){let b=this.graph.vertices[e.members[d]],g=b.neighbours;for(let S=0;S<g.length;S++){let L=this.graph.vertices[g[S]];L.positioned||(L.value.isConnectedToRing=!0,this.createNextBond(L,b,0))}}}rotateSubtree(e,r,t,i){this.graph.traverseTree(e,r,s=>{s.position.rotateAround(t,i);for(let l=0;l<s.value.anchoredRings.length;l++){let n=this.rings[s.value.anchoredRings[l]];n&&n.center.rotateAround(t,i)}})}getSubtreeOverlapScore(e,r,t){let i=0,s=new T(0,0),l=0;return this.graph.traverseTree(e,r,n=>{if(!n.value.isDrawn)return;let h=t[n.id];h>this.opts.overlapSensitivity&&(i+=h,l++);let f=this.graph.vertices[n.id].position.clone();f.multiplyScalar(h),s.add(f)}),s.divide(i),{value:i/l,center:s}}getCurrentCenterOfMass(){let e=new T(0,0),r=0;for(let t=0;t<this.graph.vertices.length;t++){let i=this.graph.vertices[t];i.positioned&&(e.add(i.position),r++)}return e.divide(r)}getCurrentCenterOfMassInNeigbourhood(e,r=this.opts.bondLength*2){let t=new T(0,0),i=0,s=r*r;for(let l=0;l<this.graph.vertices.length;l++){let n=this.graph.vertices[l];n.positioned&&e.distanceSq(n.position)<s&&(t.add(n.position),i++)}return t.divide(i)}resolvePrimaryOverlaps(){let e=[],r=Array(this.graph.vertices.length);for(let t=0;t<this.rings.length;t++){let i=this.rings[t];for(let s=0;s<i.members.length;s++){let l=this.graph.vertices[i.members[s]];if(r[l.id])continue;r[l.id]=!0;let n=this.getNonRingNeighbours(l.id);if(n.length>1){let h=[];for(let f=0;f<l.value.rings.length;f++)h.push(l.value.rings[f]);e.push({common:l,rings:h,vertices:n})}else if(n.length===1&&l.value.rings.length===2){let h=[];for(let f=0;f<l.value.rings.length;f++)h.push(l.value.rings[f]);e.push({common:l,rings:h,vertices:n})}}}for(let t=0;t<e.length;t++){let i=e[t];if(i.vertices.length===2){let s=i.vertices[0],l=i.vertices[1];if(!s.value.isDrawn||!l.value.isDrawn)continue;let n=(2*Math.PI-this.getRing(i.rings[0]).getAngle())/6;this.rotateSubtree(s.id,i.common.id,n,i.common.position),this.rotateSubtree(l.id,i.common.id,-n,i.common.position);let h=this.getOverlapScore(),f=this.getSubtreeOverlapScore(s.id,i.common.id,h.vertexScores),c=this.getSubtreeOverlapScore(l.id,i.common.id,h.vertexScores),d=f.value+c.value;this.rotateSubtree(s.id,i.common.id,-2*n,i.common.position),this.rotateSubtree(l.id,i.common.id,2*n,i.common.position),h=this.getOverlapScore(),f=this.getSubtreeOverlapScore(s.id,i.common.id,h.vertexScores),c=this.getSubtreeOverlapScore(l.id,i.common.id,h.vertexScores),f.value+c.value>d&&(this.rotateSubtree(s.id,i.common.id,2*n,i.common.position),this.rotateSubtree(l.id,i.common.id,-2*n,i.common.position))}else i.vertices.length===1&&i.rings.length}}resolveSecondaryOverlaps(e){for(let r=0;r<e.length;r++)if(e[r].score>this.opts.overlapSensitivity){let t=this.graph.vertices[e[r].id];if(t.isTerminal()){let i=this.getClosestVertex(t);if(i){let s=null;i.isTerminal()?s=i.id===0?this.graph.vertices[1].position:i.previousPosition:s=i.id===0?this.graph.vertices[1].position:i.position;let l=t.id===0?this.graph.vertices[1].position:t.previousPosition;t.position.rotateAwayFrom(s,l,re.toRad(20))}}}}getLastAngle(e){for(;e;){let r=this.graph.vertices[e];if(r.value.rings.length>0)return 0;if(r.angle)return r.angle;e=r.parentVertexId}return 0}createNextBond(e,r=null,t=0,i=!1,s=!1){if(e.positioned&&!s)return;let l=!1;if(r){let n=this.graph.getEdge(e.id,r.id);(n.bondType==="/"||n.bondType==="\\")&&++this.doubleBondConfigCount%2===1&&this.doubleBondConfig===null&&(this.doubleBondConfig=n.bondType,l=!0,r.parentVertexId===null&&e.value.branchBond&&(this.doubleBondConfig==="/"?this.doubleBondConfig="\\":this.doubleBondConfig==="\\"&&(this.doubleBondConfig="/")))}if(!s)if(r)if(r.value.rings.length>0){let n=r.neighbours,h=null,f=new T(0,0);if(r.value.bridgedRing===null&&r.value.rings.length>1)for(let c=0;c<n.length;c++){let d=this.graph.vertices[n[c]];if(pe.containsAll(d.value.rings,r.value.rings)){h=d;break}}if(h===null){for(let c=0;c<n.length;c++){let d=this.graph.vertices[n[c]];d.positioned&&this.areVerticesInSameRing(d,r)&&f.add(T.subtract(d.position,r.position))}f.invert().normalize().multiplyScalar(this.opts.bondLength).add(r.position)}else f=h.position.clone().rotateAround(Math.PI,r.position);e.previousPosition=r.position,e.setPositionFromVector(f),e.positioned=!0}else{let n=new T(this.opts.bondLength,0);n.rotate(t),n.add(r.position),e.setPositionFromVector(n),e.previousPosition=r.position,e.positioned=!0}else{let n=new T(this.opts.bondLength,0);n.rotate(re.toRad(-60)),e.previousPosition=n,e.setPosition(this.opts.bondLength,0),e.angle=re.toRad(-60),e.value.bridgedRing===null&&(e.positioned=!0)}if(e.value.bridgedRing!==null){let n=this.getRing(e.value.bridgedRing);if(!n.positioned){let h=T.subtract(e.previousPosition,e.position);h.invert(),h.normalize();let f=re.polyCircumradius(this.opts.bondLength,n.members.length);h.multiplyScalar(f),h.add(e.position),this.createRing(n,h,e)}}else if(e.value.rings.length>0){let n=this.getRing(e.value.rings[0]);if(!n.positioned){let h=T.subtract(e.previousPosition,e.position);h.invert(),h.normalize();let f=re.polyCircumradius(this.opts.bondLength,n.getSize());h.multiplyScalar(f),h.add(e.position),this.createRing(n,h,e)}}else{let n=e.getNeighbours(),h=[];for(let c=0;c<n.length;c++)this.graph.vertices[n[c]].value.isDrawn&&h.push(n[c]);r&&(h=pe.remove(h,r.id));let f=e.getAngle();if(h.length===1){let c=this.graph.vertices[h[0]],d=r?this.graph.getEdge(e.id,r.id):null,b=this.graph.getEdge(e.id,c.id);if(d&&b&&d.weight+b.weight>=4)d.center=!0,b.center=!0,e.value.drawExplicit=!1,c.drawExplicit=!0,c.angle=0,this.createNextBond(c,e,f+c.angle);else if(r&&r.value.rings.length>0){let g=re.toRad(60),S=-g,L=new T(this.opts.bondLength,0),E=new T(this.opts.bondLength,0);L.rotate(g).add(e.position),E.rotate(S).add(e.position);let I=this.getCurrentCenterOfMass(),F=L.distanceSq(I),B=E.distanceSq(I);c.angle=F<B?S:g,this.createNextBond(c,e,f+c.angle)}else{let g=this.getLastAngle(e.id);if(g=g>=0?1.0472:-1.0472,r&&!l){let S=this.graph.getEdge(e.id,c.id).bondType;S==="/"?(this.doubleBondConfig==="/"||this.doubleBondConfig==="\\"&&(g=-g),this.doubleBondConfig=null):S==="\\"&&(this.doubleBondConfig==="/"?g=-g:this.doubleBondConfig,this.doubleBondConfig=null)}i?c.angle=g:c.angle=-g,this.createNextBond(c,e,f+c.angle)}}else if(h.length===2){let c=e.angle;c||(c=1.0472);let d=this.graph.getTreeDepth(h[0],e.id),b=this.graph.getTreeDepth(h[1],e.id),g=this.graph.vertices[h[0]],S=this.graph.vertices[h[1]];g.value.subtreeDepth=d,S.value.subtreeDepth=b;let L=this.graph.getTreeDepth(r?r.id:null,e.id);r&&(r.value.subtreeDepth=L);let E=0,I=1;S.value.element==="C"&&g.value.element!=="C"&&b>1&&d<5?(E=1,I=0):S.value.element!=="C"&&g.value.element==="C"&&d>1&&b<5?(E=0,I=1):b>d&&(E=1,I=0);let F=this.graph.vertices[h[E]],B=this.graph.vertices[h[I]],A=L<d&&L<b;B.angle=c,F.angle=-c,this.doubleBondConfig==="\\"?B.value.branchBond==="\\"&&(B.angle=-c,F.angle=c):this.doubleBondConfig==="/"&&B.value.branchBond==="/"&&(B.angle=-c,F.angle=c),this.createNextBond(B,e,f+B.angle,A),this.createNextBond(F,e,f+F.angle,A)}else if(h.length>0){let c=h.map(d=>{let b=this.graph.vertices[d],g=this.graph.getTreeDepth(d,e.id);return b.value.subtreeDepth=g,b});if(c.sort((d,b)=>b.value.subtreeDepth-d.value.subtreeDepth),h.length===3&&r&&r.value.rings.length<1&&c[2].value.rings.length<1&&c[1].value.rings.length<1&&c[0].value.rings.length<1&&c[2].value.subtreeDepth===1&&c[1].value.subtreeDepth===1&&c[0].value.subtreeDepth>1)e.angle>=0?(c[0].angle=-1.0472,c[1].angle=re.toRad(30),c[2].angle=re.toRad(90)):(c[0].angle=1.0472,c[1].angle=-re.toRad(30),c[2].angle=-re.toRad(90)),this.createNextBond(c[0],e,f+c[0].angle),this.createNextBond(c[1],e,f+c[1].angle),this.createNextBond(c[2],e,f+c[2].angle);else{let d=h.length+(r?1:0),b=2*Math.PI/d,g=b,S=0;for(h.length%2!==0?(this.createNextBond(c[0],e,f),S=1):g/=2;S<h.length;)this.createNextBond(c[S+0],e,f+g),this.createNextBond(c[S+1],e,f-g),g+=b,S+=2}}}}getCommonRingbondNeighbour(e){let r=e.neighbours;for(let t=0;t<r.length;t++){let i=this.graph.vertices[r[t]];if(pe.containsAll(i.value.rings,e.value.rings))return i}return null}isPointInRing(e){for(let r=0;r<this.rings.length;r++){let t=this.rings[r];if(!t.positioned)continue;let i=re.polyCircumradius(this.opts.bondLength,t.getSize()),s=i*i;if(e.distanceSq(t.center)<s)return!0}return!1}isEdgeInRing(e){let r=this.graph.vertices[e.sourceId],t=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(r,t)}isEdgeRotatable(e){let r=this.graph.vertices[e.sourceId],t=this.graph.vertices[e.targetId];return!(e.bondType!=="-"||r.isTerminal()||t.isTerminal()||r.value.rings.length>0&&t.value.rings.length>0&&this.areVerticesInSameRing(r,t))}isRingAromatic(e){for(let r=0;r<e.members.length;r++)if(!this.graph.vertices[e.members[r]].value.isPartOfAromaticRing)return!1;return!0}getEdgeNormals(e){let r=this.graph.vertices[e.sourceId].position,t=this.graph.vertices[e.targetId].position;return T.units(r,t)}getNonRingNeighbours(e){let r=[],t=this.graph.vertices[e],i=t.neighbours;for(let s=0;s<i.length;s++){let l=this.graph.vertices[i[s]];pe.intersection(t.value.rings,l.value.rings).length===0&&l.value.isBridge==!1&&r.push(l)}return r}annotateStereochemistry(){let e=10;for(let r=0;r<this.graph.vertices.length;r++){let t=this.graph.vertices[r];if(!t.value.isStereoCenter)continue;let i=t.getNeighbours(),s=i.length,l=Array(s);for(let O=0;O<s;O++){let W=new Uint8Array(this.graph.vertices.length),J=Array([]);W[t.id]=1,this.visitStereochemistry(i[O],t.id,W,J,e,0);for(let le=0;le<J.length;le++)J[le].sort((ne,Se)=>Se-ne);l[O]=[O,J]}let n=0,h=0;for(let O=0;O<l.length;O++){l[O][1].length>n&&(n=l[O][1].length);for(let W=0;W<l[O][1].length;W++)l[O][1][W].length>h&&(h=l[O][1][W].length)}for(let O=0;O<l.length;O++){let W=n-l[O][1].length;for(let J=0;J<W;J++)l[O][1].push([]);l[O][1].push([i[O]]);for(let J=0;J<l[O][1].length;J++){let le=h-l[O][1][J].length;for(let ne=0;ne<le;ne++)l[O][1][J].push(0)}}l.sort(function(O,W){for(let J=0;J<O[1].length;J++)for(let le=0;le<O[1][J].length;le++){if(O[1][J][le]>W[1][J][le])return-1;if(O[1][J][le]<W[1][J][le])return 1}return 0});let f=new Uint8Array(s);for(let O=0;O<s;O++)f[O]=l[O][0],t.value.priority=O;let c=this.graph.vertices[i[f[0]]].position,d=this.graph.vertices[i[f[1]]].position,g=c.relativeClockwise(d,t.position)===-1,S=t.value.bracket.chirality==="@"?-1:1,L=re.parityOfPermutation(f)*S===1?"R":"S",E="down",I="up";(g&&L!=="R"||!g&&L!=="S")&&(t.value.hydrogenDirection="up",E="up",I="down"),t.value.hasHydrogen&&(this.graph.getEdge(t.id,i[f[f.length-1]]).wedge=E);let F=new Array(i.length-1),B=t.value.rings.length>1&&t.value.hasHydrogen,A=t.value.hasHydrogen?1:0;for(let O=0;O<f.length-A;O++){F[O]=new Uint32Array(2);let W=this.graph.vertices[i[f[O]]];F[O][0]+=W.value.isStereoCenter?0:1e5,F[O][0]+=this.areVerticesInSameRing(W,t)?0:1e4,F[O][0]+=W.value.isHeteroAtom()?1e3:0,F[O][0]-=W.value.subtreeDepth===0?1e3:0,F[O][0]+=1e3-W.value.subtreeDepth,F[O][1]=i[f[O]]}if(F.sort(function(O,W){return O[0]>W[0]?-1:O[0]<W[0]?1:0}),!B){let O=F[0][1];if(t.value.hasHydrogen)this.graph.getEdge(t.id,O).wedge=I;else{let W=I;for(let J=f.length-1;J>=0&&(W===E?W=I:W=E,i[f[J]]!==O);J--);this.graph.getEdge(t.id,O).wedge=W}}t.value.chirality=L}}visitStereochemistry(e,r,t,i,s,l,n=0){t[e]=1;let h=this.graph.vertices[e],f=h.value.getAtomicNumber();i.length<=l&&i.push([]);for(let d=0;d<this.graph.getEdge(e,r).weight;d++)i[l].push(n*1e3+f);let c=this.graph.vertices[e].neighbours;for(let d=0;d<c.length;d++)t[c[d]]!==1&&l<s-1&&this.visitStereochemistry(c[d],e,t.slice(),i,s,l+1,f);if(l<s-1){let d=0;for(let b=0;b<c.length;b++)d+=this.graph.getEdge(e,c[b]).weight;for(let b=0;b<h.value.getMaxBonds()-d;b++)i.length<=l+1&&i.push([]),i[l+1].push(f*1e3+1)}}initPseudoElements(){for(let e=0;e<this.graph.vertices.length;e++){let r=this.graph.vertices[e],t=r.neighbours,i=Array(t.length);for(let h=0;h<t.length;h++)i[h]=this.graph.vertices[t[h]];if(r.getNeighbourCount()<3||r.value.rings.length>0||r.value.element==="P"||r.value.element==="C"&&i.length===3&&i[0].value.element==="N"&&i[1].value.element==="N"&&i[2].value.element==="N")continue;let s=0,l=0;for(let h=0;h<i.length;h++){let f=i[h],c=f.value.element,d=f.getNeighbourCount();c!=="C"&&c!=="H"&&d===1&&s++,d>1&&l++}if(l>1||s<2)continue;let n=null;for(let h=0;h<i.length;h++){let f=i[h];f.getNeighbourCount()>1&&(n=f)}for(let h=0;h<i.length;h++){let f=i[h];if(f.getNeighbourCount()>1)continue;f.value.isDrawn=!1;let c=Ue.maxBonds[f.value.element]-f.value.bondCount,d="";f.value.bracket&&(c=f.value.bracket.hcount,d=f.value.bracket.charge||0),r.value.attachPseudoElement(f.value.element,n?n.value.element:null,c,d)}}}};function Di(k){"use strict";function e(b,g){let S=b.length;if(S===0||S>0&&S-1 in b)for(let E=0;E<S&&g.call(b[E],E,b[E])!==!1;E++);else for(let E in b)if(g.call(b[E],E,b[E])===!1)break}function r(b){let g=parseInt(b).toString(16);return g.length==1?"0"+g:g}function t(b,g,S,L){return L=parseInt(L),L===void 0||L===255?"#"+r(b)+r(g)+r(S):L===0?!1:"rgba("+b+","+g+","+S+","+L/255+")"}function i(b,g,S){return"M"+b+" "+g+"h"+S}function s(b,g){return'<path stroke="'+b+'" d="'+g+`" />
`}function l(b){let g="";return e(b,function(S,L){if(S=t.apply(null,S.split(",")),S===!1)return;let E=[],I,F=1;e(L,function(B,A){I&&A[1]===I[1]&&A[0]===I[0]+F?F++:(I&&(E.push(i(I[0],I[1],F)),F=1),I=A)}),E.push(i(I[0],I[1],F)),g+=s(S,E.join(""))}),g}function n(b){let g={},S=b.data,L=S.length,E=b.width,I=0,F=0,B;for(let A=0;A<L;A+=4)S[A+3]>0&&(B=S[A]+","+S[A+1]+","+S[A+2]+","+S[A+3],g[B]=g[B]||[],I=A/4%E,F=Math.floor(A/4/E),g[B].push([I,F]));return g}let h=n(k),f=l(h),c='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -0.5 '+k.width+" "+k.height+'" shape-rendering="crispEdges"><g shape-rendering="crispEdges">'+f+"</g></svg>",d=document.createElement("div");return d.innerHTML=c,d.firstChild}var Gn=io(qn()),Lt=class{constructor(e,r,t,i,s=.3,l=0,n=null,h=1,f=!1){this.points=e,this.weights=r,this.width=t,this.height=i,this.sigma=s,this.interval=l,this.opacity=h,this.normalized=f,n===null&&(n=["#c51b7d","#de77ae","#f1b6da","#fde0ef","#ffffff","#e6f5d0","#b8e186","#7fbc41","#4d9221"]),this.colormap=n,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height}setFromArray(e,r){this.points=[],e.forEach(t=>{this.points.push(new T(t[0],t[1]))}),this.weights=[],r.forEach(t=>{this.weights.push(t)})}draw(){let e=[];for(let s=0;s<this.width;s++){let l=[];for(let n=0;n<this.height;n++)l.push(0);e.push(l)}let r=1/(2*this.sigma*this.sigma);for(let s=0;s<this.points.length;s++){let l=this.points[s],n=this.weights[s];for(let h=0;h<this.width;h++)for(let f=0;f<this.height;f++){let c=h-l.x,d=f-l.y,b=(c*c+d*d)*r,g=n*Math.exp(-b);e[h][f]+=g}}let t=1;if(!this.normalized){let s=-Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;for(let n=0;n<this.width;n++)for(let h=0;h<this.height;h++)e[n][h]<l&&(l=e[n][h]),e[n][h]>s&&(s=e[n][h]);t=Math.max(Math.abs(l),Math.abs(s))}let i=Gn.default.scale(this.colormap).domain([-1,1]);for(let s=0;s<this.width;s++)for(let l=0;l<this.height;l++){this.normalized||(e[s][l]=e[s][l]/t),this.interval!==0&&(e[s][l]=Math.round(e[s][l]/this.interval)*this.interval);let[n,h,f]=i(e[s][l]).rgb();this.setPixel(new T(s,l),n,h,f)}}getImage(e){let r=new Image;r.onload=()=>{this.context.imageSmoothingEnabled=!1,this.context.drawImage(r,0,0,this.width,this.height),e&&e(r)},r.onerror=t=>{console.log(t)},r.src=this.canvas.toDataURL()}getSVG(){return Di(this.context.getImageData(0,0,this.width,this.height))}setPixel(e,r,t,i){this.context.fillStyle="rgba("+r+","+t+","+i+","+this.opacity+")",this.context.fillRect(e.x,e.y,1,1)}};function no(k){let e="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=r.length;for(let i=0;i<k;i++)e+=r.charAt(Math.floor(Math.random()*t));return e}var Ze=class k{constructor(e,r,t,i=!0){if(typeof r=="string"||r instanceof String?this.svg=document.getElementById(r):this.svg=r,this.container=null,this.opts=t,this.uid=no(5),this.gradientId=0,this.backgroundItems=[],this.paths=[],this.vertices=[],this.gradients=[],this.highlights=[],this.drawingWidth=0,this.drawingHeight=0,this.halfBondThickness=this.opts.bondThickness/2,this.themeManager=e,this.maskElements=[],this.maxX=-Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE,this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,i)for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.style=document.createElementNS("http://www.w3.org/2000/svg","style"),this.style.appendChild(document.createTextNode(`
                .element {
                    font: ${this.opts.fontSizeLarge}pt ${this.opts.fontFamily};
                }
                .sub {
                    font: ${this.opts.fontSizeSmall}pt ${this.opts.fontFamily};
                }
            `)),this.svg?this.svg.appendChild(this.style):(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.appendChild(this.style))}constructSvg(){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),r=document.createElementNS("http://www.w3.org/2000/svg","mask"),t=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","g"),n=this.paths;{let h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttributeNS(null,"x",this.minX),h.setAttributeNS(null,"y",this.minY),h.setAttributeNS(null,"width",this.maxX-this.minX),h.setAttributeNS(null,"height",this.maxY-this.minY),h.setAttributeNS(null,"fill","white"),r.appendChild(h)}r.setAttributeNS(null,"id",this.uid+"-text-mask");for(let h of n)s.appendChild(h);for(let h of this.backgroundItems)t.appendChild(h);for(let h of this.highlights)i.appendChild(h);for(let h of this.vertices)l.appendChild(h);for(let h of this.maskElements)r.appendChild(h);for(let h of this.gradients)e.appendChild(h);if(s.setAttributeNS(null,"mask","url(#"+this.uid+"-text-mask)"),this.updateViewbox(this.opts.scale),t.setAttributeNS(null,"style",`transform: translateX(${this.minX}px) translateY(${this.minY}px)`),this.svg)this.svg.appendChild(e),this.svg.appendChild(r),this.svg.appendChild(t),this.svg.appendChild(i),this.svg.appendChild(s),this.svg.appendChild(l);else return this.container.appendChild(e),this.container.appendChild(r),this.container.appendChild(t),this.container.appendChild(s),this.container.appendChild(l),this.container}addLayer(e){this.backgroundItems.push(e.firstChild)}createGradient(e){let r=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),t=this.uid+`-line-${this.gradientId++}`,i=e.getLeftVector(),s=e.getRightVector(),l=i.x,n=i.y,h=s.x,f=s.y;r.setAttributeNS(null,"id",t),r.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),r.setAttributeNS(null,"x1",l),r.setAttributeNS(null,"y1",n),r.setAttributeNS(null,"x2",h),r.setAttributeNS(null,"y2",f);let c=document.createElementNS("http://www.w3.org/2000/svg","stop");c.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),c.setAttributeNS(null,"offset","20%");let d=document.createElementNS("http://www.w3.org/2000/svg","stop");return d.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getRightElement()||this.themeManager.getColor("C"))),d.setAttributeNS(null,"offset","100%"),r.appendChild(c),r.appendChild(d),this.gradients.push(r),t}createSubSuperScripts(e,r){let t=document.createElementNS("http://www.w3.org/2000/svg","tspan");return t.setAttributeNS(null,"baseline-shift",r),t.appendChild(document.createTextNode(e)),t.setAttributeNS(null,"class","sub"),t}static createUnicodeCharge(e){return e===1?"\u207A":e===-1?"\u207B":e>1?k.createUnicodeSuperscript(e)+"\u207A":e<-1?k.createUnicodeSuperscript(e)+"\u207B":""}determineDimensions(e){for(let t=0;t<e.length;t++){if(!e[t].value.isDrawn)continue;let i=e[t].position;this.maxX<i.x&&(this.maxX=i.x),this.maxY<i.y&&(this.maxY=i.y),this.minX>i.x&&(this.minX=i.x),this.minY>i.y&&(this.minY=i.y)}let r=this.opts.padding;this.maxX+=r,this.maxY+=r,this.minX-=r,this.minY-=r,this.drawingWidth=this.maxX-this.minX,this.drawingHeight=this.maxY-this.minY}updateViewbox(e){let r=this.minX,t=this.minY,i=this.maxX-this.minX,s=this.maxY-this.minY;if(e<=0)if(i>s){let l=i-s;s=i,t-=l/2}else{let l=s-i;i=s,r-=l/2}else this.svg&&(this.svg.style.width=e*i+"px",this.svg.style.height=e*s+"px");this.svg.setAttributeNS(null,"viewBox",`${r} ${t} ${i} ${s}`)}drawBall(e,r,t){let i=this.opts.bondLength/4.5;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),r-i<this.minY&&(this.minY=r-i),r+i>this.maxY&&(this.maxY=r+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",r),s.setAttributeNS(null,"r",i),s.setAttributeNS(null,"fill",this.themeManager.getColor(t)),this.vertices.push(s)}drawWedge(e){let r=e.getLeftVector().clone(),t=e.getRightVector().clone(),i=T.normals(r,t);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),l=r,n=t;s&&(l=t,n=r);let h=T.add(l,T.multiplyScalar(i[0],this.halfBondThickness)),f=T.add(n,T.multiplyScalar(i[0],3+this.opts.fontSizeLarge/4)),c=T.add(n,T.multiplyScalar(i[1],3+this.opts.fontSizeLarge/4)),d=T.add(l,T.multiplyScalar(i[1],this.halfBondThickness)),b=document.createElementNS("http://www.w3.org/2000/svg","polygon"),g=this.createGradient(e,r.x,r.y,t.x,t.y);b.setAttributeNS(null,"points",`${h.x},${h.y} ${f.x},${f.y} ${c.x},${c.y} ${d.x},${d.y}`),b.setAttributeNS(null,"fill",`url('#${g}')`),this.paths.push(b)}drawAtomHighlight(e,r,t="#03fc9d"){let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",r),i.setAttributeNS(null,"r",this.opts.bondLength/3),i.setAttributeNS(null,"fill",t),this.highlights.push(i)}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let r=e.getLeftVector().clone(),t=e.getRightVector().clone(),i=T.normals(r,t);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),l,n;s?(l=t,n=r):(l=r,n=t);let h=T.subtract(n,l).normalize(),f=e.getLength(),c=1.25/(f/(this.opts.bondLength/10)),d=this.createGradient(e);for(let b=0;b<1;b+=c){let g=T.multiplyScalar(h,b*f),S=T.add(l,g),L=this.opts.fontSizeLarge/2*b,E=T.multiplyScalar(i[0],L);S.subtract(E);let I=S.clone();I.add(T.multiplyScalar(E,2)),this.drawLine(new Q(S,I),null,d)}}drawDebugPoint(e,r,t="",i="#f00"){let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",r),s.setAttributeNS(null,"r","2"),s.setAttributeNS(null,"fill",i),this.vertices.push(s),this.drawDebugText(e,r,t)}drawDebugText(e,r,t){let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttributeNS(null,"x",e),i.setAttributeNS(null,"y",r),i.setAttributeNS(null,"class","debug"),i.setAttributeNS(null,"fill","#ff0000"),i.setAttributeNS(null,"style",`
                font: 5px Droid Sans, sans-serif;
            `),i.appendChild(document.createTextNode(t)),this.vertices.push(i)}drawRing(e,r,t){let i=document.createElementNS("http://www.w3.org/2000/svg","circle"),s=re.apothemFromSideLength(this.opts.bondLength,t);i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",r),i.setAttributeNS(null,"r",s-this.opts.bondSpacing),i.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),i.setAttributeNS(null,"stroke-width",this.opts.bondThickness),i.setAttributeNS(null,"fill","none"),this.paths.push(i)}drawLine(e,r=!1,t=null,i="round"){let s=[["stroke-width",this.opts.bondThickness],["stroke-linecap",i],["stroke-dasharray",r?"5, 5":"none"]],l=e.getLeftVector(),n=e.getRightVector(),h=l.x,f=l.y,c=n.x,d=n.y,b=s.map(S=>S.join(":")).join(";"),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttributeNS(null,"x1",h),g.setAttributeNS(null,"y1",f),g.setAttributeNS(null,"x2",c),g.setAttributeNS(null,"y2",d),g.setAttributeNS(null,"style",b),this.paths.push(g),t==null&&(t=this.createGradient(e,h,f,c,d)),g.setAttributeNS(null,"stroke",`url('#${t}')`)}drawPoint(e,r,t){let i=.75;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),r-i<this.minY&&(this.minY=r-i),r+i>this.maxY&&(this.maxY=r+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",r),s.setAttributeNS(null,"r","1.5"),s.setAttributeNS(null,"fill","black"),this.maskElements.push(s);let l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttributeNS(null,"cx",e),l.setAttributeNS(null,"cy",r),l.setAttributeNS(null,"r",i),l.setAttributeNS(null,"fill",this.themeManager.getColor(t)),this.vertices.push(l)}drawText(e,r,t,i,s,l,n,h,f,c={}){let d=[],b=t;n!==0&&n!==null&&(b+=k.createUnicodeCharge(n)),h!==0&&h!==null&&(b=k.createUnicodeSuperscript(h)+b),d.push([b,t]),i===1?d.push(["H","H"]):i>1&&d.push(["H"+k.createUnicodeSubscript(i),"H"]),n===1&&t==="N"&&"0O"in c&&"0O-1"in c&&(c={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0);for(let g in Object.keys(c)){let S=c[g],L=S.element;S.count>1&&(L+=k.createUnicodeSubscript(S.count)),S.charge!==""&&(L+=k.createUnicodeCharge(n)),d.push([L,S.element]),S.hydrogenCount===1?d.push(["H","H"]):S.hydrogenCount>1&&d.push(["H"+k.createUnicodeSubscript(S.hydrogenCount),"H"])}this.write(d,s,e,r,f===1)}write(e,r,t,i,s){let l=k.measureText(e[0][1],this.opts.fontSizeLarge,this.opts.fontFamily);r==="left"&&e[0][0]!==e[0][1]&&(l.width*=2),s?(t+l.width*e.length>this.maxX&&(this.maxX=t+l.width*e.length),t-l.width/2<this.minX&&(this.minX=t-l.width/2),i-l.height<this.minY&&(this.minY=i-l.height),i+l.height>this.maxY&&(this.maxY=i+l.height)):(r!=="right"?(t+l.width*e.length>this.maxX&&(this.maxX=t+l.width*e.length),t-l.width*e.length<this.minX&&(this.minX=t-l.width*e.length)):r!=="left"&&(t+l.width*e.length>this.maxX&&(this.maxX=t+l.width*e.length),t-l.width/2<this.minX&&(this.minX=t-l.width/2)),i-l.height<this.minY&&(this.minY=i-l.height),i+l.height>this.maxY&&(this.maxY=i+l.height),r==="down"&&i+.8*l.height*e.length>this.maxY&&(this.maxY=i+.8*l.height*e.length),r==="up"&&i-.8*l.height*e.length<this.minY&&(this.minY=i-.8*l.height*e.length));let n=t,h=i,f=document.createElementNS("http://www.w3.org/2000/svg","text");f.setAttributeNS(null,"class","element");let c=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill","#ffffff"),r==="left"&&(e=e.reverse()),(r==="right"||r==="down"||r==="up")&&(t-=l.width/2),r==="left"&&(t+=l.width/2),e.forEach((g,S)=>{let L=g[0],E=g[1],I=document.createElementNS("http://www.w3.org/2000/svg","tspan");I.setAttributeNS(null,"fill",this.themeManager.getColor(E)),I.textContent=L,(r==="up"||r==="down")&&(I.setAttributeNS(null,"x","0px"),r==="up"?I.setAttributeNS(null,"y",`-${.9*S}em`):I.setAttributeNS(null,"y",`${.9*S}em`)),f.appendChild(I)}),f.setAttributeNS(null,"data-direction",r),r==="left"||r==="right"?(f.setAttributeNS(null,"dominant-baseline","alphabetic"),f.setAttributeNS(null,"y","0.36em")):f.setAttributeNS(null,"dominant-baseline","central"),r==="left"&&f.setAttributeNS(null,"text-anchor","end"),c.appendChild(f),c.setAttributeNS(null,"style",`transform: translateX(${t}px) translateY(${i}px)`);let d=this.opts.fontSizeLarge*.75;e[0][1].length>1&&(d=this.opts.fontSizeLarge*1.1);let b=document.createElementNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"cx",n),b.setAttributeNS(null,"cy",h),b.setAttributeNS(null,"r",d),b.setAttributeNS(null,"fill","black"),this.maskElements.push(b),this.vertices.push(c)}toCanvas(e,r,t){(typeof e=="string"||e instanceof String)&&(e=document.getElementById(e));let i=new Image;i.onload=function(){e.width=r,e.height=t,e.getContext("2d").drawImage(i,0,0,r,t)},i.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(this.svg.outerHTML)}static createUnicodeSubscript(e){let r="";return e.toString().split("").forEach(t=>{r+=["\u2080","\u2081","\u2082","\u2083","\u2084","\u2085","\u2086","\u2087","\u2088","\u2089"][parseInt(t)]}),r}static createUnicodeSuperscript(e){let r="";return e.toString().split("").forEach(t=>{let i=parseInt(t);Number.isFinite(i)&&(r+=["\u2070","\xB9","\xB2","\xB3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"][i])}),r}static replaceNumbersWithSubscript(e){let r={0:"\u2080",1:"\u2081",2:"\u2082",3:"\u2083",4:"\u2084",5:"\u2085",6:"\u2086",7:"\u2087",8:"\u2088",9:"\u2089"};for(let[t,i]of Object.entries(r))e=e.replaceAll(t,i);return e}static measureText(e,r,t,i=.9){let l=document.createElement("canvas").getContext("2d");l.font=`${r}pt ${t}`;let n=l.measureText(e),h=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight);return{width:n.width>h?n.width:h,height:(Math.abs(n.actualBoundingBoxAscent)+Math.abs(n.actualBoundingBoxAscent))*i}}static svgToCanvas(e,r,t,i,s=null){e.setAttributeNS(null,"width",t),e.setAttributeNS(null,"height",i);let l=new Image;return l.onload=function(){r.width=t,r.height=i;let n=r.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(l,0,0,t,i),s&&s(r)},l.onerror=function(n){console.log(n)},l.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(e.outerHTML),r}static svgToImg(e,r,t,i){let s=document.createElement("canvas");this.svgToCanvas(e,s,t,i,()=>{r.src=s.toDataURL("image/png")})}static writeText(e,r,t,i,s=Number.MAX_SAFE_INTEGER){let l=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","style");n.appendChild(document.createTextNode(`
        .text {
            font: ${t}pt ${i};
            dominant-baseline: ideographic;
        }
    `)),l.appendChild(n);let h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttributeNS(null,"class","text");let f=0,c=0,d=[];return e.split(`
`).forEach(b=>{let g=k.measureText(b,t,i,1);if(g.width>=s){let S=0,L=0,E=b.split(" "),I=0;for(let F=0;F<E.length;F++){let B=k.measureText(E[F],t,i,1);S+B.width>s&&(d.push({text:E.slice(I,F).join(" "),width:S,height:L}),S=0,L=0,I=F),B.height>L&&(L=B.height),S+=B.width}I<E.length&&d.push({text:E.slice(I,E.length).join(" "),width:S,height:L})}else d.push({text:b,width:g.width,height:g.height})}),d.forEach(b=>{c+=b.height;let g=document.createElementNS("http://www.w3.org/2000/svg","tspan");g.setAttributeNS(null,"fill",r.getColor("C")),g.textContent=b.text,g.setAttributeNS(null,"x","0px"),g.setAttributeNS(null,"y",`${c}px`),h.appendChild(g),b.width>f&&(f=b.width)}),l.appendChild(h),{svg:l,width:f,height:c}}};var nt=class{constructor(e,r=!0){this.preprocessor=new fr(e),this.opts=this.preprocessor.opts,this.clear=r,this.svgWrapper=null}draw(e,r,t="light",i=null,s=!1,l=[],n=!1){r===null||r==="svg"?(r=document.createElementNS("http://www.w3.org/2000/svg","svg"),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttributeNS(null,"width",this.opts.width),r.setAttributeNS(null,"height",this.opts.height)):r instanceof String&&(r=document.getElementById(r));let h={padding:this.opts.padding,compactDrawing:this.opts.compactDrawing};i!==null&&(this.opts.padding+=this.opts.weights.additionalPadding,this.opts.compactDrawing=!1);let f=this.preprocessor;return f.initDraw(e,t,s,l),s||(this.themeManager=new ct(this.opts.themes,t),(this.svgWrapper===null||this.clear)&&(this.svgWrapper=new Ze(this.themeManager,r,this.opts,this.clear))),f.processGraph(),this.svgWrapper.determineDimensions(f.graph.vertices),this.drawAtomHighlights(f.opts.debug),this.drawEdges(f.opts.debug),this.drawVertices(f.opts.debug),i!==null&&this.drawWeights(i,n),f.opts.debug&&console.debug("SvgDrawer::draw()",{graph:f.graph,rings:f.rings,ringConnections:f.ringConnections}),this.svgWrapper.constructSvg(),i!==null&&(this.opts.padding=h.padding,this.opts.compactDrawing=h.padding),r}drawCanvas(e,r,t="light",i=!1){let s=null;typeof r=="string"||r instanceof String?s=document.getElementById(r):s=r;let l=document.createElementNS("http://www.w3.org/2000/svg","svg");return l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttributeNS(null,"viewBox","0 0 500 500"),l.setAttributeNS(null,"width","500"),l.setAttributeNS(null,"height","500"),l.setAttributeNS(null,"style","visibility: hidden: position: absolute; left: -1000px"),document.body.appendChild(l),this.draw(e,l,t,i),this.svgWrapper.toCanvas(s,this.opts.width,this.opts.height),document.body.removeChild(l),r}drawAromaticityRing(e){this.svgWrapper.drawRing(e.center.x,e.center.y,e.getSize())}drawEdges(e){let r=this.preprocessor,t=r.graph,i=r.rings,s=Array(this.preprocessor.graph.edges.length);if(s.fill(!1),t.traverseBF(0,l=>{let n=t.getEdges(l.id);for(let h=0;h<n.length;h++){let f=n[h];s[f]||(s[f]=!0,this.drawEdge(f,e))}}),!this.bridgedRing)for(let l=0;l<i.length;l++){let n=i[l];r.isRingAromatic(n)&&this.drawAromaticityRing(n)}}drawEdge(e,r){let t=this.preprocessor,i=t.opts,s=this.svgWrapper,l=t.graph.edges[e],n=t.graph.vertices[l.sourceId],h=t.graph.vertices[l.targetId],f=n.value.element,c=h.value.element;if((!n.value.isDrawn||!h.value.isDrawn)&&t.opts.atomVisualization==="default")return;let d=n.position,b=h.position,g=t.getEdgeNormals(l),S=pe.clone(g);if(S[0].multiplyScalar(10).add(d),S[1].multiplyScalar(10).add(d),l.bondType==="="||t.getRingbondType(n,h)==="="||l.isPartOfAromaticRing&&t.bridgedRing){let L=t.areVerticesInSameRing(n,h),E=t.chooseSide(n,h,S);if(L){let F=t.getLargestOrAromaticCommonRing(n,h).center;g[0].multiplyScalar(i.bondSpacing),g[1].multiplyScalar(i.bondSpacing);let B=null;F.sameSideAs(n.position,h.position,T.add(d,g[0]))?B=new Q(T.add(d,g[0]),T.add(b,g[0]),f,c):B=new Q(T.add(d,g[1]),T.add(b,g[1]),f,c),B.shorten(i.bondLength-i.shortBondLength*i.bondLength),l.isPartOfAromaticRing?s.drawLine(B,!0):s.drawLine(B),s.drawLine(new Q(d,b,f,c))}else if(l.center||n.isTerminal()&&h.isTerminal()||E.anCount==0&&E.bnCount>1||E.bnCount==0&&E.anCount>1){this.multiplyNormals(g,i.halfBondSpacing);let I=new Q(T.add(d,g[0]),T.add(b,g[0]),f,c),F=new Q(T.add(d,g[1]),T.add(b,g[1]),f,c);s.drawLine(I),s.drawLine(F)}else if(E.sideCount[0]>E.sideCount[1]||E.totalSideCount[0]>E.totalSideCount[1]){this.multiplyNormals(g,i.bondSpacing);let I=new Q(T.add(d,g[0]),T.add(b,g[0]),f,c);I.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(I),s.drawLine(new Q(d,b,f,c))}else if(E.sideCount[0]<E.sideCount[1]||E.totalSideCount[0]<=E.totalSideCount[1]){this.multiplyNormals(g,i.bondSpacing);let I=new Q(T.add(d,g[1]),T.add(b,g[1]),f,c);I.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(I),s.drawLine(new Q(d,b,f,c))}}else if(l.bondType==="#"){g[0].multiplyScalar(i.bondSpacing/1.5),g[1].multiplyScalar(i.bondSpacing/1.5);let L=new Q(T.add(d,g[0]),T.add(b,g[0]),f,c),E=new Q(T.add(d,g[1]),T.add(b,g[1]),f,c);s.drawLine(L),s.drawLine(E),s.drawLine(new Q(d,b,f,c))}else if(l.bondType!=="."){let L=n.value.isStereoCenter,E=h.value.isStereoCenter;l.wedge==="up"?s.drawWedge(new Q(d,b,f,c,L,E)):l.wedge==="down"?s.drawDashedWedge(new Q(d,b,f,c,L,E)):s.drawLine(new Q(d,b,f,c,L,E))}if(r){let L=T.midpoint(d,b);s.drawDebugText(L.x,L.y,"e: "+e)}}drawAtomHighlights(e){let r=this.preprocessor,t=r.graph,i=this.svgWrapper;for(let s=0;s<t.vertices.length;s++){let l=t.vertices[s],n=l.value;for(let h=0;h<r.highlight_atoms.length;h++){let f=r.highlight_atoms[h];n.class===f[0]&&i.drawAtomHighlight(l.position.x,l.position.y,f[1])}}}drawVertices(e){let r=this.preprocessor,t=r.opts,i=r.graph,s=r.rings,l=this.svgWrapper;for(let n=0;n<i.vertices.length;n++){let h=i.vertices[n],f=h.value,c=0,d=0,b=h.value.bondCount,g=f.element,S=Ue.maxBonds[g]-b,L=h.getTextDirection(i.vertices,f.hasAttachedPseudoElements),E=t.terminalCarbons||g!=="C"||f.hasAttachedPseudoElements?h.isTerminal():!1,I=f.element==="C";if(f.element==="N"&&f.isPartOfAromaticRing&&(S=0),f.bracket&&(S=f.bracket.hcount,c=f.bracket.charge,d=f.bracket.isotope),(c||d||i.vertices.length<3)&&(I=!1),t.atomVisualization==="allballs")l.drawBall(h.position.x,h.position.y,g);else if(f.isDrawn&&(!I||f.drawExplicit||E||f.hasAttachedPseudoElements)||i.vertices.length===1)if(t.atomVisualization==="default"){let F=f.getAttachedPseudoElements();f.hasAttachedPseudoElements&&i.vertices.length===Object.keys(F).length+1&&(L="right"),l.drawText(h.position.x,h.position.y,g,S,L,E,c,d,i.vertices.length,F)}else t.atomVisualization==="balls"&&l.drawBall(h.position.x,h.position.y,g);else if(h.getNeighbourCount()===2&&h.forcePositioned==!0){let F=i.vertices[h.neighbours[0]].position,B=i.vertices[h.neighbours[1]].position,A=T.threePointangle(h.position,F,B);Math.abs(Math.PI-A)<.1&&l.drawPoint(h.position.x,h.position.y,g)}if(e){let F="v: "+h.id+" "+pe.print(f.ringbonds);l.drawDebugText(h.position.x,h.position.y,F)}}if(t.debug)for(let n=0;n<s.length;n++){let h=s[n].center;l.drawDebugPoint(h.x,h.y,"r: "+s[n].id)}}drawWeights(e,r){if(!e||e.every(s=>s===0))return;if(e.length!==this.preprocessor.graph.atomIdxToVertexId.length)throw new Error("The number of weights supplied must be equal to the number of (heavy) atoms in the molecule.");let t=[];for(let s of this.preprocessor.graph.atomIdxToVertexId){let l=this.preprocessor.graph.vertices[s];t.push(new T(l.position.x-this.svgWrapper.minX,l.position.y-this.svgWrapper.minY))}let i=new Lt(t,e,this.svgWrapper.drawingWidth,this.svgWrapper.drawingHeight,this.opts.weights.sigma,this.opts.weights.interval,this.opts.weights.colormap,this.opts.weights.opacity,r);i.draw(),this.svgWrapper.addLayer(i.getSVG())}getTotalOverlapScore(){return this.preprocessor.getTotalOverlapScore()}getMolecularFormula(e=null){return this.preprocessor.getMolecularFormula(e)}multiplyNormals(e,r){e[0].multiplyScalar(r),e[1].multiplyScalar(r)}};var Yt=class{constructor(e){this.svgDrawer=new nt(e)}draw(e,r,t="light",i=!1,s=[]){let l=null,n=null;if(r instanceof String?l=document.getElementById(r.valueOf()):typeof r=="string"?l=document.getElementById(r):l=r,l instanceof HTMLCanvasElement)n=l;else throw Error("First argument was not a canvas or the ID of a canvas.");let h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.setAttributeNS(null,"viewBox","0 0 "+this.svgDrawer.opts.width+" "+this.svgDrawer.opts.height),h.setAttributeNS(null,"width",this.svgDrawer.opts.width+""),h.setAttributeNS(null,"height",this.svgDrawer.opts.height+""),this.svgDrawer.draw(e,h,t,null,i,s),this.svgDrawer.svgWrapper.toCanvas(n,this.svgDrawer.opts.width,this.svgDrawer.opts.height)}getTotalOverlapScore(){return this.svgDrawer.getTotalOverlapScore()}getMolecularFormula(){return this.svgDrawer.getMolecularFormula()}};var pt=function(){"use strict";function k(t,i){function s(){this.constructor=t}s.prototype=i.prototype,t.prototype=new s}function e(t,i,s,l){this.message=t,this.expected=i,this.found=s,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}k(e,Error),e.buildMessage=function(t,i){var s={literal:function(b){return'"'+n(b.text)+'"'},class:function(b){var g="",S;for(S=0;S<b.parts.length;S++)g+=b.parts[S]instanceof Array?h(b.parts[S][0])+"-"+h(b.parts[S][1]):h(b.parts[S]);return"["+(b.inverted?"^":"")+g+"]"},any:function(b){return"any character"},end:function(b){return"end of input"},other:function(b){return b.description}};function l(b){return b.charCodeAt(0).toString(16).toUpperCase()}function n(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+l(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+l(g)})}function h(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+l(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+l(g)})}function f(b){return s[b.type](b)}function c(b){var g=new Array(b.length),S,L;for(S=0;S<b.length;S++)g[S]=f(b[S]);if(g.sort(),g.length>0){for(S=1,L=1;S<g.length;S++)g[S-1]!==g[S]&&(g[L]=g[S],L++);g.length=L}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function d(b){return b?'"'+n(b)+'"':"end of input"}return"Expected "+c(t)+" but "+d(i)+" found."};function r(t,i){i=i!==void 0?i:{};var s=t.split("(").length-1,l=t.split(")").length-1;if(s!==l)throw tr("The number of opening parentheses does not match the number of closing parentheses.",0);var n={},h={chain:mt},f=mt,c=function(x){for(var v=[],P=[],R=0;R<x[1].length;R++)v.push(x[1][R]);for(var R=0;R<x[2].length;R++){var H=x[2][R][0]?x[2][R][0]:"-";P.push({bond:H,id:x[2][R][1]})}for(var R=0;R<x[3].length;R++)v.push(x[3][R]);for(var R=0;R<x[6].length;R++)v.push(x[6][R]);return{atom:x[0],isBracket:!!x[0].element,branches:v,branchCount:v.length,ringbonds:P,ringbondCount:P.length,bond:x[4]?x[4]:"-",next:x[5],hasNext:!!x[5]}},d="(",b=ye("(",!1),g=")",S=ye(")",!1),L=function(x){var v=x[1]?x[1]:"-";return x[2].branchBond=v,x[2]},E=function(x){return x},I=/^[\-=#$:\/\\.]/,F=qe(["-","=","#","$",":","/","\\","."],!1,!1),B=function(x){return x},A="[",O=ye("[",!1),W="se",J=ye("se",!1),le="as",ne=ye("as",!1),Se="]",Ke=ye("]",!1),st=function(x){return{isotope:x[1],element:x[2],chirality:x[3],hcount:x[4],charge:x[5],class:x[6]}},Te="B",Ae=ye("B",!1),Ye="r",He=ye("r",!1),at="C",je=ye("C",!1),U="l",se=ye("l",!1),ve=/^[NOPSFI]/,Re=qe(["N","O","P","S","F","I"],!1,!1),we=function(x){return x.length>1?x.join(""):x},$e=/^[bcnops]/,xe=qe(["b","c","n","o","p","s"],!1,!1),Le="*",vt=ye("*",!1),xt=function(x){return x},Je=/^[A-Z]/,ot=qe([["A","Z"]],!1,!1),Nt=/^[a-z]/,Pe=qe([["a","z"]],!1,!1),De=function(x){return x.join("")},ht="%",ft=ye("%",!1),Me=/^[1-9]/,_e=qe([["1","9"]],!1,!1),Oe=/^[0-9]/,Fe=qe([["0","9"]],!1,!1),gr=function(x){return x.length==1?Number(x):Number(x.join("").replace("%",""))},qt="@",Gt=ye("@",!1),Ut="TH",cr=ye("TH",!1),Zt=/^[12]/,Kt=qe(["1","2"],!1,!1),Jt="AL",dr=ye("AL",!1),pr="SP",Wr=ye("SP",!1),vr=/^[1-3]/,mr=qe([["1","3"]],!1,!1),br="TB",Xr=ye("TB",!1),Qt="OH",wr=ye("OH",!1),Vr=function(x){return x[1]?x[1]=="@"?"@@":x[1].join("").replace(",",""):"@"},Yr=function(x){return x},yr="+",Sr=ye("+",!1),jr=function(x){return x[1]?x[1]!="+"?Number(x[1].join("")):2:1},Cr="-",Ar=ye("-",!1),qr=function(x){return x[1]?x[1]!="-"?-Number(x[1].join("")):-2:-1},Gr="H",Ur=ye("H",!1),Zr=function(x){return x[1]?Number(x[1]):1},Kr=":",Jr=ye(":",!1),xr=/^[0]/,Nr=qe(["0"],!1,!1),Qr=function(x){return Number(x[1][0]+x[1][1].join(""))},ei=function(x){return Number(x.join(""))},m=0,me=0,It=[{line:1,column:1}],We=0,er=[],q=0,Pt;if("startRule"in i){if(!(i.startRule in h))throw new Error(`Can't start parsing from rule "`+i.startRule+'".');f=h[i.startRule]}function ti(){return t.substring(me,m)}function Hi(){return Rt(me,m)}function ri(x,v){throw v=v!==void 0?v:Rt(me,m),kr([ii(x)],t.substring(me,m),v)}function _i(x,v){throw v=v!==void 0?v:Rt(me,m),tr(x,v)}function ye(x,v){return{type:"literal",text:x,ignoreCase:v}}function qe(x,v,P){return{type:"class",parts:x,inverted:v,ignoreCase:P}}function Wi(){return{type:"any"}}function Rr(){return{type:"end"}}function ii(x){return{type:"other",description:x}}function $r(x){var v=It[x],P;if(v)return v;for(P=x-1;!It[P];)P--;for(v=It[P],v={line:v.line,column:v.column};P<x;)t.charCodeAt(P)===10?(v.line++,v.column=1):v.column++,P++;return It[x]=v,v}function Rt(x,v){var P=$r(x),R=$r(v);return{start:{offset:x,line:P.line,column:P.column},end:{offset:v,line:R.line,column:R.column}}}function G(x){m<We||(m>We&&(We=m,er=[]),er.push(x))}function tr(x,v){return new e(x,null,null,v)}function kr(x,v,P){return new e(e.buildMessage(x,v),x,v,P)}function mt(){var x,v,P,R,H,V,Z,Ne,Ge,et;if(x=m,v=m,P=rr(),P!==n){for(R=[],H=Xe();H!==n;)R.push(H),H=Xe();if(R!==n){for(H=[],V=m,Z=Qe(),Z===n&&(Z=null),Z!==n?(Ne=ir(),Ne!==n?(Z=[Z,Ne],V=Z):(m=V,V=n)):(m=V,V=n);V!==n;)H.push(V),V=m,Z=Qe(),Z===n&&(Z=null),Z!==n?(Ne=ir(),Ne!==n?(Z=[Z,Ne],V=Z):(m=V,V=n)):(m=V,V=n);if(H!==n){for(V=[],Z=Xe();Z!==n;)V.push(Z),Z=Xe();if(V!==n)if(Z=Qe(),Z===n&&(Z=null),Z!==n)if(Ne=mt(),Ne===n&&(Ne=null),Ne!==n){for(Ge=[],et=Xe();et!==n;)Ge.push(et),et=Xe();Ge!==n?(P=[P,R,H,V,Z,Ne,Ge],v=P):(m=v,v=n)}else m=v,v=n;else m=v,v=n;else m=v,v=n}else m=v,v=n}else m=v,v=n}else m=v,v=n;return v!==n&&(me=x,v=c(v)),x=v,x}function Xe(){var x,v,P,R,H,V;return x=m,v=m,t.charCodeAt(m)===40?(P=d,m++):(P=n,q===0&&G(b)),P!==n?(R=Qe(),R===n&&(R=null),R!==n?(H=mt(),H!==n?(t.charCodeAt(m)===41?(V=g,m++):(V=n,q===0&&G(S)),V!==n?(P=[P,R,H,V],v=P):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(me=x,v=L(v)),x=v,x}function rr(){var x,v;return x=m,v=si(),v===n&&(v=Er(),v===n&&(v=ni(),v===n&&(v=Tr()))),v!==n&&(me=x,v=E(v)),x=v,x}function Qe(){var x,v;if(x=m,I.test(t.charAt(m))){if(v=t.charAt(m),v===t.charAt(m+1)&&(v=n,q===0))throw tr("The parser encountered a bond repetition.",m+1);m++}else v=n,q===0&&G(F);return v!==n&&(me=x,v=B(v)),x=v,x}function ni(){var x,v,P,R,H,V,Z,Ne,Ge,et;return x=m,v=m,t.charCodeAt(m)===91?(P=A,m++):(P=n,q===0&&G(O)),P!==n?(R=Br(),R===n&&(R=null),R!==n?(t.substr(m,2)===W?(H=W,m+=2):(H=n,q===0&&G(J)),H===n&&(t.substr(m,2)===le?(H=le,m+=2):(H=n,q===0&&G(ne)),H===n&&(H=Er(),H===n&&(H=ai(),H===n&&(H=Tr())))),H!==n?(V=Lr(),V===n&&(V=null),V!==n?(Z=fi(),Z===n&&(Z=null),Z!==n?(Ne=li(),Ne===n&&(Ne=null),Ne!==n?(Ge=Mr(),Ge===n&&(Ge=null),Ge!==n?(t.charCodeAt(m)===93?(et=Se,m++):(et=n,q===0&&G(Ke)),et!==n?(P=[P,R,H,V,Z,Ne,Ge,et],v=P):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(me=x,v=st(v)),x=v,x}function si(){var x,v,P,R;return x=m,v=m,t.charCodeAt(m)===66?(P=Te,m++):(P=n,q===0&&G(Ae)),P!==n?(t.charCodeAt(m)===114?(R=Ye,m++):(R=n,q===0&&G(He)),R===n&&(R=null),R!==n?(P=[P,R],v=P):(m=v,v=n)):(m=v,v=n),v===n&&(v=m,t.charCodeAt(m)===67?(P=at,m++):(P=n,q===0&&G(je)),P!==n?(t.charCodeAt(m)===108?(R=U,m++):(R=n,q===0&&G(se)),R===n&&(R=null),R!==n?(P=[P,R],v=P):(m=v,v=n)):(m=v,v=n),v===n&&(ve.test(t.charAt(m))?(v=t.charAt(m),m++):(v=n,q===0&&G(Re)))),v!==n&&(me=x,v=we(v)),x=v,x}function Er(){var x,v;return x=m,$e.test(t.charAt(m))?(v=t.charAt(m),m++):(v=n,q===0&&G(xe)),v!==n&&(me=x,v=E(v)),x=v,x}function Tr(){var x,v;return x=m,t.charCodeAt(m)===42?(v=Le,m++):(v=n,q===0&&G(vt)),v!==n&&(me=x,v=xt(v)),x=v,x}function ai(){var x,v,P,R;return x=m,v=m,Je.test(t.charAt(m))?(P=t.charAt(m),m++):(P=n,q===0&&G(ot)),P!==n?(Nt.test(t.charAt(m))?(R=t.charAt(m),m++):(R=n,q===0&&G(Pe)),R===n&&(R=null),R!==n?(P=[P,R],v=P):(m=v,v=n)):(m=v,v=n),v!==n&&(me=x,v=De(v)),x=v,x}function ir(){var x,v,P,R,H;return x=m,v=m,t.charCodeAt(m)===37?(P=ht,m++):(P=n,q===0&&G(ft)),P!==n?(Me.test(t.charAt(m))?(R=t.charAt(m),m++):(R=n,q===0&&G(_e)),R!==n?(Oe.test(t.charAt(m))?(H=t.charAt(m),m++):(H=n,q===0&&G(Fe)),H!==n?(P=[P,R,H],v=P):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v===n&&(Oe.test(t.charAt(m))?(v=t.charAt(m),m++):(v=n,q===0&&G(Fe))),v!==n&&(me=x,v=gr(v)),x=v,x}function Lr(){var x,v,P,R,H,V,Z;return x=m,v=m,t.charCodeAt(m)===64?(P=qt,m++):(P=n,q===0&&G(Gt)),P!==n?(t.charCodeAt(m)===64?(R=qt,m++):(R=n,q===0&&G(Gt)),R===n&&(R=m,t.substr(m,2)===Ut?(H=Ut,m+=2):(H=n,q===0&&G(cr)),H!==n?(Zt.test(t.charAt(m))?(V=t.charAt(m),m++):(V=n,q===0&&G(Kt)),V!==n?(H=[H,V],R=H):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,t.substr(m,2)===Jt?(H=Jt,m+=2):(H=n,q===0&&G(dr)),H!==n?(Zt.test(t.charAt(m))?(V=t.charAt(m),m++):(V=n,q===0&&G(Kt)),V!==n?(H=[H,V],R=H):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,t.substr(m,2)===pr?(H=pr,m+=2):(H=n,q===0&&G(Wr)),H!==n?(vr.test(t.charAt(m))?(V=t.charAt(m),m++):(V=n,q===0&&G(mr)),V!==n?(H=[H,V],R=H):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,t.substr(m,2)===br?(H=br,m+=2):(H=n,q===0&&G(Xr)),H!==n?(Me.test(t.charAt(m))?(V=t.charAt(m),m++):(V=n,q===0&&G(_e)),V!==n?(Oe.test(t.charAt(m))?(Z=t.charAt(m),m++):(Z=n,q===0&&G(Fe)),Z===n&&(Z=null),Z!==n?(H=[H,V,Z],R=H):(m=R,R=n)):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,t.substr(m,2)===Qt?(H=Qt,m+=2):(H=n,q===0&&G(wr)),H!==n?(Me.test(t.charAt(m))?(V=t.charAt(m),m++):(V=n,q===0&&G(_e)),V!==n?(Oe.test(t.charAt(m))?(Z=t.charAt(m),m++):(Z=n,q===0&&G(Fe)),Z===n&&(Z=null),Z!==n?(H=[H,V,Z],R=H):(m=R,R=n)):(m=R,R=n)):(m=R,R=n)))))),R===n&&(R=null),R!==n?(P=[P,R],v=P):(m=v,v=n)):(m=v,v=n),v!==n&&(me=x,v=Vr(v)),x=v,x}function li(){var x,v;return x=m,v=oi(),v===n&&(v=hi()),v!==n&&(me=x,v=Yr(v)),x=v,x}function oi(){var x,v,P,R,H,V;return x=m,v=m,t.charCodeAt(m)===43?(P=yr,m++):(P=n,q===0&&G(Sr)),P!==n?(t.charCodeAt(m)===43?(R=yr,m++):(R=n,q===0&&G(Sr)),R===n&&(R=m,Me.test(t.charAt(m))?(H=t.charAt(m),m++):(H=n,q===0&&G(_e)),H!==n?(Oe.test(t.charAt(m))?(V=t.charAt(m),m++):(V=n,q===0&&G(Fe)),V===n&&(V=null),V!==n?(H=[H,V],R=H):(m=R,R=n)):(m=R,R=n)),R===n&&(R=null),R!==n?(P=[P,R],v=P):(m=v,v=n)):(m=v,v=n),v!==n&&(me=x,v=jr(v)),x=v,x}function hi(){var x,v,P,R,H,V;return x=m,v=m,t.charCodeAt(m)===45?(P=Cr,m++):(P=n,q===0&&G(Ar)),P!==n?(t.charCodeAt(m)===45?(R=Cr,m++):(R=n,q===0&&G(Ar)),R===n&&(R=m,Me.test(t.charAt(m))?(H=t.charAt(m),m++):(H=n,q===0&&G(_e)),H!==n?(Oe.test(t.charAt(m))?(V=t.charAt(m),m++):(V=n,q===0&&G(Fe)),V===n&&(V=null),V!==n?(H=[H,V],R=H):(m=R,R=n)):(m=R,R=n)),R===n&&(R=null),R!==n?(P=[P,R],v=P):(m=v,v=n)):(m=v,v=n),v!==n&&(me=x,v=qr(v)),x=v,x}function fi(){var x,v,P,R;return x=m,v=m,t.charCodeAt(m)===72?(P=Gr,m++):(P=n,q===0&&G(Ur)),P!==n?(Oe.test(t.charAt(m))?(R=t.charAt(m),m++):(R=n,q===0&&G(Fe)),R===n&&(R=null),R!==n?(P=[P,R],v=P):(m=v,v=n)):(m=v,v=n),v!==n&&(me=x,v=Zr(v)),x=v,x}function Mr(){var x,v,P,R,H,V,Z;if(x=m,v=m,t.charCodeAt(m)===58?(P=Kr,m++):(P=n,q===0&&G(Jr)),P!==n){if(R=m,Me.test(t.charAt(m))?(H=t.charAt(m),m++):(H=n,q===0&&G(_e)),H!==n){for(V=[],Oe.test(t.charAt(m))?(Z=t.charAt(m),m++):(Z=n,q===0&&G(Fe));Z!==n;)V.push(Z),Oe.test(t.charAt(m))?(Z=t.charAt(m),m++):(Z=n,q===0&&G(Fe));V!==n?(H=[H,V],R=H):(m=R,R=n)}else m=R,R=n;R===n&&(xr.test(t.charAt(m))?(R=t.charAt(m),m++):(R=n,q===0&&G(Nr))),R!==n?(P=[P,R],v=P):(m=v,v=n)}else m=v,v=n;return v!==n&&(me=x,v=Qr(v)),x=v,x}function Br(){var x,v,P,R,H;return x=m,v=m,Me.test(t.charAt(m))?(P=t.charAt(m),m++):(P=n,q===0&&G(_e)),P!==n?(Oe.test(t.charAt(m))?(R=t.charAt(m),m++):(R=n,q===0&&G(Fe)),R===n&&(R=null),R!==n?(Oe.test(t.charAt(m))?(H=t.charAt(m),m++):(H=n,q===0&&G(Fe)),H===n&&(H=null),H!==n?(P=[P,R,H],v=P):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(me=x,v=ei(v)),x=v,x}if(Pt=f(),Pt!==n&&m===t.length)return Pt;throw Pt!==n&&m<t.length&&G(Rr()),kr(er,We<t.length?t.charAt(We):null,We<t.length?Rt(We,We+1):Rt(We,We))}return{SyntaxError:e,parse:r}}();var zi={C2H4O2:"acetic acid",C3H6O:"acetone",C2H3N:"acetonitrile",C6H6:"benzene",CCl4:"carbon tetrachloride",C6H5Cl:"chlorobenzene",CHCl3:"chloroform",C6H12:"cyclohexane",C2H4Cl2:"1,2-dichloroethane",C4H10O3:"diethylene glycol",C6H14O3:"diglyme",C4H10O2:"DME",C3H7NO:"DMF",C2H6OS:"DMSO",C2H6O:"ethanol",C2H6O2:"ethylene glycol",C3H8O3:"glycerin",C7H16:"heptane",C6H18N3OP:"HMPA",C6H18N3P:"HMPT",C6H14:"hexane",CH4O:"methanol",C5H12O:"MTBE",CH2Cl2:"methylene chloride",CH5H9NO:"NMP",CH3NO2:"nitromethane",C5H12:"pentane",C5H5N:"pyridine",C7H8:"toluene",C6H15N:"triethyl amine",H2O:"water"};var Mt=class{constructor(e,r){this.defaultOptions={scale:r.scale>0?r.scale:1,fontSize:r.fontSizeLarge*.8,fontFamily:"Arial, Helvetica, sans-serif",spacing:10,plus:{size:9,thickness:1},arrow:{length:r.bondLength*4,headSize:6,thickness:1,margin:3},weights:{normalize:!1}},this.opts=dt.extend(!0,this.defaultOptions,e),this.drawer=new nt(r),this.molOpts=this.drawer.opts}draw(e,r,t="light",i=null,s="{reagents}",l="",n=!1){if(this.themeManager=new ct(this.molOpts.themes,t),this.opts.weights.normalize){let E=-Number.MAX_SAFE_INTEGER,I=Number.MAX_SAFE_INTEGER;if("reactants"in i)for(let B=0;B<i.reactants.length;B++)for(let A=0;A<i.reactants[B].length;A++)i.reactants[B][A]<I&&(I=i.reactants[B][A]),i.reactants[B][A]>E&&(E=i.reactants[B][A]);if("reagents"in i)for(let B=0;B<i.reagents.length;B++)for(let A=0;A<i.reagents[B].length;A++)i.reagents[B][A]<I&&(I=i.reagents[B][A]),i.reagents[B][A]>E&&(E=i.reagents[B][A]);if("products"in i)for(let B=0;B<i.products.length;B++)for(let A=0;A<i.products[B].length;A++)i.products[B][A]<I&&(I=i.products[B][A]),i.products[B][A]>E&&(E=i.products[B][A]);let F=Math.max(Math.abs(I),Math.abs(E));if(F===0&&(F=1),"reactants"in i)for(let B=0;B<i.reactants.length;B++)for(let A=0;A<i.reactants[B].length;A++)i.reactants[B][A]/=F;if("reagents"in i)for(let B=0;B<i.reagents.length;B++)for(let A=0;A<i.reagents[B].length;A++)i.reagents[B][A]/=F;if("products"in i)for(let B=0;B<i.products.length;B++)for(let A=0;A<i.products[B].length;A++)i.products[B][A]/=F}let h=null;for(r===null||r==="svg"?(h=document.createElementNS("http://www.w3.org/2000/svg","svg"),h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.setAttributeNS(null,"width","500"),h.setAttributeNS(null,"height","500")):typeof r=="string"||r instanceof String?h=document.getElementById(r):h=r;h.firstChild;)h.removeChild(h.firstChild);let f=[],c=0;for(let E=0;E<e.reactants.length;E++){E>0&&f.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let I=null;i&&"reactants"in i&&i.reactants.length>E&&(I=i.reactants[E]);let F=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.reactants[E],F,t,I,n,[],this.opts.weights.normalize);let B={width:F.viewBox.baseVal.width*this.opts.scale,height:F.viewBox.baseVal.height*this.opts.scale,svg:F};f.push(B),B.height>c&&(c=B.height)}f.push({width:this.opts.arrow.length*this.opts.scale,height:this.opts.arrow.headSize*this.opts.scale*2,svg:this.getArrow()});let d="";for(let E=0;E<e.reagents.length;E++){E>0&&(d+=", ");let I=this.drawer.getMolecularFormula(e.reagents[E]);I in zi&&(I=zi[I]),d+=Ze.replaceNumbersWithSubscript(I)}s=s.replace("{reagents}",d);let b=Ze.writeText(s,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale),g=(this.opts.arrow.length*this.opts.scale-b.width)/2;f.push({svg:b.svg,height:b.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+g,offsetY:-(b.height/2)-this.opts.arrow.margin,position:"relative"});let S=Ze.writeText(l,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale);g=(this.opts.arrow.length*this.opts.scale-S.width)/2,f.push({svg:S.svg,height:S.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+g,offsetY:S.height/2+this.opts.arrow.margin,position:"relative"});for(let E=0;E<e.products.length;E++){E>0&&f.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let I=null;i&&"products"in i&&i.products.length>E&&(I=i.products[E]);let F=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.products[E],F,t,I,n,[],this.opts.weights.normalize);let B={width:F.viewBox.baseVal.width*this.opts.scale,height:F.viewBox.baseVal.height*this.opts.scale,svg:F};f.push(B),B.height>c&&(c=B.height)}let L=0;return f.forEach(E=>{let I=E.offsetX||0,F=E.offsetY||0;E.svg.setAttributeNS(null,"x",Math.round(L+I)),E.svg.setAttributeNS(null,"y",Math.round((c-E.height)/2+F)),E.svg.setAttributeNS(null,"width",Math.round(E.width)),E.svg.setAttributeNS(null,"height",Math.round(E.height)),h.appendChild(E.svg),E.position!=="relative"&&(L+=Math.round(E.width+this.opts.spacing+I))}),h.setAttributeNS(null,"viewBox",`0 0 ${L} ${c}`),h.style.width=L+"px",h.style.height=c+"px",h}getPlus(){let e=this.opts.plus.size,r=this.opts.plus.thickness,t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttributeNS(null,"id","plus"),i.setAttributeNS(null,"x",0),i.setAttributeNS(null,"y",e/2-r/2),i.setAttributeNS(null,"width",e),i.setAttributeNS(null,"height",r),i.setAttributeNS(null,"fill",this.themeManager.getColor("C")),s.setAttributeNS(null,"x",e/2-r/2),s.setAttributeNS(null,"y",0),s.setAttributeNS(null,"width",r),s.setAttributeNS(null,"height",e),s.setAttributeNS(null,"fill",this.themeManager.getColor("C")),t.appendChild(i),t.appendChild(s),t.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),t}getArrowhead(){let e=this.opts.arrow.headSize,r=document.createElementNS("http://www.w3.org/2000/svg","marker"),t=document.createElementNS("http://www.w3.org/2000/svg","polygon");return r.setAttributeNS(null,"id","arrowhead"),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),r.setAttributeNS(null,"markerUnits","userSpaceOnUse"),r.setAttributeNS(null,"markerWidth",e),r.setAttributeNS(null,"markerHeight",e),r.setAttributeNS(null,"refX",0),r.setAttributeNS(null,"refY",e/2),r.setAttributeNS(null,"orient","auto"),r.setAttributeNS(null,"fill",this.themeManager.getColor("C")),t.setAttributeNS(null,"points",`0 0, ${e} ${e/2}, 0 ${e}`),r.appendChild(t),r}getCDArrowhead(){let e=this.opts.arrow.headSize,r=e*(7/4.5),t=document.createElementNS("http://www.w3.org/2000/svg","marker"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttributeNS(null,"id","arrowhead"),t.setAttributeNS(null,"viewBox",`0 0 ${r} ${e}`),t.setAttributeNS(null,"markerUnits","userSpaceOnUse"),t.setAttributeNS(null,"markerWidth",r*2),t.setAttributeNS(null,"markerHeight",e*2),t.setAttributeNS(null,"refX",2.2),t.setAttributeNS(null,"refY",2.2),t.setAttributeNS(null,"orient","auto"),t.setAttributeNS(null,"fill",this.themeManager.getColor("C")),i.setAttributeNS(null,"style","fill-rule:nonzero;"),i.setAttributeNS(null,"d","m 0 0 l 7 2.25 l -7 2.25 c 0 0 0.735 -1.084 0.735 -2.28 c 0 -1.196 -0.735 -2.22 -0.735 -2.22 z"),t.appendChild(i),t}getArrow(){let e=this.opts.arrow.headSize,r=this.opts.arrow.length,t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","defs"),s=document.createElementNS("http://www.w3.org/2000/svg","line");return i.appendChild(this.getCDArrowhead()),t.appendChild(i),t.setAttributeNS(null,"id","arrow"),s.setAttributeNS(null,"x1",0),s.setAttributeNS(null,"y1",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"x2",r),s.setAttributeNS(null,"y2",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"stroke-width",this.opts.arrow.thickness),s.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),s.setAttributeNS(null,"marker-end","url(#arrowhead)"),t.appendChild(s),t.setAttributeNS(null,"viewBox",`0 ${-e/2} ${r+e*(7/4.5)} ${e}`),t}};var ur=class{constructor(e){this.reactantsSmiles=[],this.reagentsSmiles=[],this.productsSmiles=[],this.reactantsWeights=[],this.reagentsWeights=[],this.productsWeights=[],this.reactants=[],this.reagents=[],this.products=[];let r=e.split(">");if(r.length!==3)throw new Error('Invalid reaction SMILES: Expected exactly two ">" symbols.');r[0]!==""&&(this.reactantsSmiles=r[0].split(".")),r[1]!==""&&(this.reagentsSmiles=r[1].split(".")),r[2]!==""&&(this.productsSmiles=r[2].split("."));for(let t=0;t<this.reactantsSmiles.length;t++)this.reactants.push(pt.parse(this.reactantsSmiles[t]));for(let t=0;t<this.reagentsSmiles.length;t++)this.reagents.push(pt.parse(this.reagentsSmiles[t]));for(let t=0;t<this.productsSmiles.length;t++)this.products.push(pt.parse(this.productsSmiles[t]))}};var At=class{static parse(e){return new ur(e)}};var jt=class k{constructor(e={},r={}){this.drawer=new nt(e),this.reactionDrawer=new Mt(r,JSON.parse(JSON.stringify(this.drawer.opts)))}static apply(e={},r={},t="data-smiles",i="light",s=null,l=null){new k(e,r).apply(t,i,s,l)}apply(e="data-smiles",r="light",t=null,i=null){document.querySelectorAll(`[${e}]`).forEach(l=>{let n=l.getAttribute(e);if(n===null)throw Error("No SMILES provided.");let h=r,f=null;if(l.hasAttribute("data-smiles-theme")&&(h=l.getAttribute("data-smiles-theme")),l.hasAttribute("data-smiles-weights")&&(f=l.getAttribute("data-smiles-weights").split(",").map(parseFloat)),(l.hasAttribute("data-smiles-reactant-weights")||l.hasAttribute("data-smiles-reagent-weights")||l.hasAttribute("data-smiles-product-weights"))&&(f={reactants:[],reagents:[],products:[]},l.hasAttribute("data-smiles-reactant-weights")&&(f.reactants=l.getAttribute("data-smiles-reactant-weights").split(";").map(c=>c.split(",").map(parseFloat))),l.hasAttribute("data-smiles-reagent-weights")&&(f.reagents=l.getAttribute("data-smiles-reagent-weights").split(";").map(c=>c.split(",").map(parseFloat))),l.hasAttribute("data-smiles-product-weights")&&(f.products=l.getAttribute("data-smiles-product-weights").split(";").map(c=>c.split(",").map(parseFloat)))),l.hasAttribute("data-smiles-options")||l.hasAttribute("data-smiles-reaction-options")){let c={};l.hasAttribute("data-smiles-options")&&(c=JSON.parse(l.getAttribute("data-smiles-options").replace(/'/g,'"')));let d={};l.hasAttribute("data-smiles-reaction-options")&&(d=JSON.parse(l.getAttribute("data-smiles-reaction-options").replace(/'/g,'"'))),new k(c,d).draw(n,l,h,t,i,f)}else this.draw(n,l,h,t,i,f)})}draw(e,r,t="light",i=null,s=null,l=null){let n=[];[e,...n]=e.split(" ");let h=n.join(" "),f={};if(h.includes("__")){let d=h.substring(h.indexOf("__")+2,h.lastIndexOf("__"));f=JSON.parse(d.replace(/'/g,'"'))}let c={textAboveArrow:"{reagents}",textBelowArrow:""};if(f=dt.extend(!0,c,f),e.includes(">"))try{this.drawReaction(e,r,t,f,l,i)}catch(d){s?s(d):console.error(d)}else try{this.drawMolecule(e,r,t,l,i)}catch(d){s?s(d):console.error(d)}}drawMolecule(e,r,t,i,s){let l=pt.parse(e);if(r===null||r==="svg"){let n=this.drawer.draw(l,null,t,i),h=this.getDimensions(n);n.setAttributeNS(null,"width",""+h.w),n.setAttributeNS(null,"height",""+h.h),s&&s(n)}else if(r==="canvas"){let n=this.svgToCanvas(this.drawer.draw(l,null,t,i));s&&s(n)}else if(r==="img"){let n=this.svgToImg(this.drawer.draw(l,null,t,i));s&&s(n)}else r instanceof HTMLImageElement?(this.svgToImg(this.drawer.draw(l,null,t,i),r),s&&s(r)):r instanceof SVGElement?(this.drawer.draw(l,r,t,i),s&&s(r)):document.querySelectorAll(r).forEach(h=>{let f=h.nodeName.toLowerCase();f==="svg"?(this.drawer.draw(l,h,t,i),s&&s(h)):f==="canvas"?(this.svgToCanvas(this.drawer.draw(l,null,t,i),h),s&&s(h)):f==="img"&&(this.svgToImg(this.drawer.draw(l,null,t,i),h),s&&s(h))})}drawReaction(e,r,t,i,s,l){let n=At.parse(e);if(r===null||r==="svg"){let h=this.reactionDrawer.draw(n,null,t),f=this.getDimensions(h);h.setAttributeNS(null,"width",""+f.w),h.setAttributeNS(null,"height",""+f.h),l&&l(h)}else if(r==="canvas"){let h=this.svgToCanvas(this.reactionDrawer.draw(n,null,t,s,i.textAboveArrow,i.textBelowArrow));l&&l(h)}else if(r==="img"){let h=this.svgToImg(this.reactionDrawer.draw(n,null,t,s,i.textAboveArrow,i.textBelowArrow));l&&l(h)}else r instanceof HTMLImageElement?(this.svgToImg(this.reactionDrawer.draw(n,null,t,s,i.textAboveArrow,i.textBelowArrow),r),l&&l(r)):r instanceof SVGElement?(this.reactionDrawer.draw(n,r,t,s,i.textAboveArrow,i.textBelowArrow),l&&l(r)):document.querySelectorAll(r).forEach(f=>{let c=f.nodeName.toLowerCase();c==="svg"?(this.reactionDrawer.draw(n,f,t,s,i.textAboveArrow,i.textBelowArrow),this.reactionDrawer.opts.scale<=0&&(f.style.width=null,f.style.height=null),l&&l(f)):c==="canvas"?(this.svgToCanvas(this.reactionDrawer.draw(n,null,t,s,i.textAboveArrow,i.textBelowArrow),f),l&&l(f)):c==="img"&&(this.svgToImg(this.reactionDrawer.draw(n,null,t,s,i.textAboveArrow,i.textBelowArrow),f),l&&l(f))})}svgToCanvas(e,r=null){r===null&&(r=document.createElement("canvas"));let t=this.getDimensions(r,e);return Ze.svgToCanvas(e,r,t.w,t.h),r}svgToImg(e,r=null){r===null&&(r=document.createElement("img"));let t=this.getDimensions(r,e);return Ze.svgToImg(e,r,t.w,t.h),r}getDimensions(e,r=null){let t=this.drawer.opts.width,i=this.drawer.opts.height;return this.drawer.opts.scale<=0?(e instanceof SVGElement||(t===null&&(t=e.width),i===null&&(i=e.height)),e.style.width!==""&&(t=parseInt(e.style.width)),e.style.height!==""&&(i=parseInt(e.style.height))):r&&(t=parseFloat(r.style.width),i=parseFloat(r.style.height)),{w:t,h:i}}};var Bt={Version:"2.2.0",Drawer:Yt,GaussDrawer:Lt,Parser:pt,ReactionDrawer:Mt,ReactionParser:At,SmiDrawer:jt,SvgDrawer:nt};Bt.clean=function(k){return k.replace(/[^A-Za-z0-9@.+\-?!()[\]{}/\\=#$:*]/g,"")};Bt.apply=function(k,e="canvas[data-smiles]",r="light",t=null){let i=new Yt(k),s=document.querySelectorAll(e);for(var l=0;l<s.length;l++){let n=s[l];Bt.parse(n.getAttribute("data-smiles"),function(h){i.draw(h,n,r,!1)},function(h){t&&t(h)})}};Bt.parse=function(k,e,r){try{e&&e(pt.parse(k))}catch(t){r&&r(t)}};Bt.parseReaction=function(k,e,r){try{e&&e(At.parse(k))}catch(t){r&&r(t)}};if(!Array.prototype.fill){let k=function(e){if(this==null)throw new TypeError("this is null or not defined");for(var r=Object(this),t=r.length>>>0,i=arguments[1],s=i>>0,l=s<0?Math.max(t+s,0):Math.min(s,t),n=arguments[2],h=n===void 0?t:n>>0,f=h<0?Math.max(t+h,0):Math.min(h,t);l<f;)r[l]=e,l++;return r};Object.defineProperty(Array.prototype,"fill",{value:k,writeable:!1})}typeof window<"u"&&window.document&&window.document.createElement&&(window.SmilesDrawer=Bt,window.SmiDrawer=jt);var gf=Bt;})();
/*! Bundled license information:

chroma-js/chroma.js:
  (**
   * chroma.js - JavaScript library for color conversions
   *
   * Copyright (c) 2011-2019, Gregor Aisch
   * All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   *
   * 1. Redistributions of source code must retain the above copyright notice, this
   * list of conditions and the following disclaimer.
   *
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   * this list of conditions and the following disclaimer in the documentation
   * and/or other materials provided with the distribution.
   *
   * 3. The name Gregor Aisch may not be used to endorse or promote products
   * derived from this software without specific prior written permission.
   *
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
   * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
   * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   *
   * -------------------------------------------------------
   *
   * chroma.js includes colors from colorbrewer2.org, which are released under
   * the following license:
   *
   * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
   * and The Pennsylvania State University.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing,
   * software distributed under the License is distributed on an
   * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
   * either express or implied. See the License for the specific
   * language governing permissions and limitations under the License.
   *
   * ------------------------------------------------------
   *
   * Named colors are taken from X11 Color Names.
   * http://www.w3.org/TR/css3-color/#svg-color
   *
   * @preserve
   *)
*/
//# sourceMappingURL=smiles-drawer.min.js.map
